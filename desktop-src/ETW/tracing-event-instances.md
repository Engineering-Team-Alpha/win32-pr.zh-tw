---
description: 傳統提供者會使用 TraceEventInstance 函數來追蹤屬於單一交易一部分的事件。 您也可以使用此函數來追蹤父/子事件。
ms.assetid: 246e9443-3120-49bf-a6e3-64dddba348fa
title: 在傳統提供者中撰寫相關的事件
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 771b08a66625d5cd6e723fbc2e12eed87bd1d434
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "104321107"
---
# <a name="writing-related-events-in-a-classic-provider"></a><span data-ttu-id="2daa2-104">在傳統提供者中撰寫相關的事件</span><span class="sxs-lookup"><span data-stu-id="2daa2-104">Writing Related Events in a Classic Provider</span></span>

<span data-ttu-id="2daa2-105">[傳統](about-event-tracing.md) 提供者會使用 [**TraceEventInstance**](/windows/win32/api/evntrace/nf-evntrace-traceeventinstance) 函數來追蹤屬於單一交易一部分的事件。</span><span class="sxs-lookup"><span data-stu-id="2daa2-105">[Classic](about-event-tracing.md) providers use the [**TraceEventInstance**](/windows/win32/api/evntrace/nf-evntrace-traceeventinstance) function to trace events that are part of a single transaction.</span></span> <span data-ttu-id="2daa2-106">您也可以使用此函數來追蹤父/子事件。</span><span class="sxs-lookup"><span data-stu-id="2daa2-106">You can also use this function to trace parent/child events.</span></span>

<span data-ttu-id="2daa2-107">在呼叫 [**TraceEventInstance**](/windows/win32/api/evntrace/nf-evntrace-traceeventinstance) 函數之前，您必須先呼叫 [**CreateTraceInstanceId**](/windows/win32/api/evntrace/nf-evntrace-createtraceinstanceid) 函數來取得交易識別碼。</span><span class="sxs-lookup"><span data-stu-id="2daa2-107">Before calling the [**TraceEventInstance**](/windows/win32/api/evntrace/nf-evntrace-traceeventinstance) function, you must first call the [**CreateTraceInstanceId**](/windows/win32/api/evntrace/nf-evntrace-createtraceinstanceid) function to obtain a transaction identifier.</span></span> <span data-ttu-id="2daa2-108">此函式會產生唯一的交易識別碼，並將其對應至已註冊的類別 GUID 控制碼。</span><span class="sxs-lookup"><span data-stu-id="2daa2-108">This function generates a unique transaction identifier, and maps it to a registered class GUID handle.</span></span> <span data-ttu-id="2daa2-109">在呼叫 [**RegisterTraceGuids**](/windows/win32/api/evntrace/nf-evntrace-registertraceguidsa)函數之後，已註冊之類別 guid 的控制碼可在 [**追蹤 \_ GUID \_ 註冊**](/windows/win32/api/evntrace/ns-evntrace-trace_guid_registration)結構的 **RegHandle** 成員中使用。</span><span class="sxs-lookup"><span data-stu-id="2daa2-109">The handles for registered class GUIDs are available in the **RegHandle** members of [**TRACE\_GUID\_REGISTRATION**](/windows/win32/api/evntrace/ns-evntrace-trace_guid_registration) structures, after calling the [**RegisterTraceGuids**](/windows/win32/api/evntrace/nf-evntrace-registertraceguidsa) function.</span></span> <span data-ttu-id="2daa2-110">交易識別碼會放置在您傳遞給 **CreateTraceInstanceId** 函數的 [**事件 \_ 實例 \_ 資訊**](/windows/win32/api/evntrace/ns-evntrace-event_instance_info)結構的 **InstanceId** 成員中。</span><span class="sxs-lookup"><span data-stu-id="2daa2-110">The transaction identifier is placed in the **InstanceId** member of an [**EVENT\_INSTANCE\_INFO**](/windows/win32/api/evntrace/ns-evntrace-event_instance_info) structure that you pass to the **CreateTraceInstanceId** function.</span></span>

<span data-ttu-id="2daa2-111">傳遞至 [**TraceEventInstance**](/windows/win32/api/evntrace/nf-evntrace-traceeventinstance)函式的 [**事件 \_ 實例 \_ 標頭**](/windows/win32/api/evntrace/ns-evntrace-event_instance_header)結構類似于 [**事件 \_ 追蹤 \_ 標頭**](/windows/win32/api/evntrace/ns-evntrace-event_trace_header)結構 (查看) 的 [追蹤事件](tracing-events.md)，但它包含與實例相關的其他資訊，而且不包含 **Guid** 成員。</span><span class="sxs-lookup"><span data-stu-id="2daa2-111">The [**EVENT\_INSTANCE\_HEADER**](/windows/win32/api/evntrace/ns-evntrace-event_instance_header) structure that is passed to the [**TraceEventInstance**](/windows/win32/api/evntrace/nf-evntrace-traceeventinstance) function is similar to the [**EVENT\_TRACE\_HEADER**](/windows/win32/api/evntrace/ns-evntrace-event_trace_header) structure (see [Tracing Events](tracing-events.md)), except that it contains additional information relating to instances, and does not contain a **Guid** member.</span></span>

<span data-ttu-id="2daa2-112">事件實例可以用來建立事件之間的階層式關聯性。</span><span class="sxs-lookup"><span data-stu-id="2daa2-112">Event instances can be used to establish a hierarchical relationship between events.</span></span> <span data-ttu-id="2daa2-113">[**TraceEventInstance**](/windows/win32/api/evntrace/nf-evntrace-traceeventinstance)函式會接受來自兩個事件實例的實例特定資訊。</span><span class="sxs-lookup"><span data-stu-id="2daa2-113">The [**TraceEventInstance**](/windows/win32/api/evntrace/nf-evntrace-traceeventinstance) function accepts instance-specific information from two event instances.</span></span> <span data-ttu-id="2daa2-114">*PInstInfo* 參數指向事件實例的 [**事件 \_ 實例 \_ 資訊**](/windows/win32/api/evntrace/ns-evntrace-event_instance_info)結構，而 *PParentInstInfo* 參數指向父事件實例的 **事件 \_ 實例 \_ 資訊** 結構。</span><span class="sxs-lookup"><span data-stu-id="2daa2-114">The *pInstInfo* parameter points to the [**EVENT\_INSTANCE\_INFO**](/windows/win32/api/evntrace/ns-evntrace-event_instance_info) structure of the event instance, and the *pParentInstInfo* parameter points to the **EVENT\_INSTANCE\_INFO** structure of a parent event instance.</span></span> <span data-ttu-id="2daa2-115">"Parent" 事件實例的定義為應用程式定義;父系可以是已經產生的任何實例。</span><span class="sxs-lookup"><span data-stu-id="2daa2-115">The definition of a "parent" event instance is application-defined; the parent can be any instance that has already been generated.</span></span>

 

 
