---
title: 磚資源 Api
description: 本節所述的 Api 適用于磚化的資源和磚集區。
ms.assetid: 02DCF9BA-F9EA-4176-AD6F-AA620CE968BA
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8a0d97f5272f4f96db56e6e89b871951de035105
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/16/2019
ms.locfileid: "104371912"
---
# <a name="tiled-resource-apis"></a><span data-ttu-id="099ef-103">磚資源 Api</span><span class="sxs-lookup"><span data-stu-id="099ef-103">Tiled Resource APIs</span></span>

<span data-ttu-id="099ef-104">本節所述的 Api 適用于磚化的資源和磚集區。</span><span class="sxs-lookup"><span data-stu-id="099ef-104">The APIs described in this section work with tiled resources and tile pool.</span></span>

-   [<span data-ttu-id="099ef-105">將磚從磚集區指派給資源</span><span class="sxs-lookup"><span data-stu-id="099ef-105">Assigning tiles from a tile pool to a resource</span></span>](#assigning-tiles-from-a-tile-pool-to-a-resource)
-   [<span data-ttu-id="099ef-106">查詢資源平鋪和支援</span><span class="sxs-lookup"><span data-stu-id="099ef-106">Querying resource tiling and support</span></span>](#querying-resource-tiling-and-support)
-   [<span data-ttu-id="099ef-107">複製磚資料</span><span class="sxs-lookup"><span data-stu-id="099ef-107">Copying tiled data</span></span>](#copying-tiled-data)
-   [<span data-ttu-id="099ef-108">調整磚集區的大小</span><span class="sxs-lookup"><span data-stu-id="099ef-108">Resizing tile pool</span></span>](#resizing-tile-pool)
-   [<span data-ttu-id="099ef-109">磚資源關卡</span><span class="sxs-lookup"><span data-stu-id="099ef-109">Tiled resource barrier</span></span>](#tiled-resource-barrier)
-   [<span data-ttu-id="099ef-110">相關主題</span><span class="sxs-lookup"><span data-stu-id="099ef-110">Related topics</span></span>](#related-topics)

## <a name="assigning-tiles-from-a-tile-pool-to-a-resource"></a><span data-ttu-id="099ef-111">將磚從磚集區指派給資源</span><span class="sxs-lookup"><span data-stu-id="099ef-111">Assigning tiles from a tile pool to a resource</span></span>

<span data-ttu-id="099ef-112">[**ID3D11DeviceCoNtext2：： UpdateTileMappings**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-updatetilemappings)和 [**ID3D11DeviceCoNtext2：： CopyTileMappings**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-copytilemappings) api 會操作和查詢磚對應。</span><span class="sxs-lookup"><span data-stu-id="099ef-112">The [**ID3D11DeviceContext2::UpdateTileMappings**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-updatetilemappings) and [**ID3D11DeviceContext2::CopyTileMappings**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-copytilemappings) APIs manipulate and query tile mappings.</span></span> <span data-ttu-id="099ef-113">更新呼叫只會影響呼叫中所識別的圖格，而其他則會保留先前的定義。</span><span class="sxs-lookup"><span data-stu-id="099ef-113">Update calls only affect the tiles identified in the call, and others are left as defined previously.</span></span>

<span data-ttu-id="099ef-114">磚集區中的任何指定磚都可以對應到資源中的多個位置，甚至是多個資源。</span><span class="sxs-lookup"><span data-stu-id="099ef-114">Any given tile from a tile pool can be mapped to multiple locations in a resource and even multiple resources.</span></span> <span data-ttu-id="099ef-115">這項對應包含資源中的圖格，其具有所選的版面配置 ([Mipmap 封裝](mipmap-packing.md)) 其中多個 mipmap 會一起封裝成單一磚。</span><span class="sxs-lookup"><span data-stu-id="099ef-115">This mapping includes tiles in a resource that have an implementation-chosen layout ([Mipmap packing](mipmap-packing.md)) where multiple mipmaps are packed together into a single tile.</span></span> <span data-ttu-id="099ef-116">捕捉的原因是，如果資料透過一個對應寫入至磚，但透過不同設定的對應來讀取，則結果為未定義。</span><span class="sxs-lookup"><span data-stu-id="099ef-116">The catch is that if data is written to the tile via one mapping, but read via a differently configured mapping, the results are undefined.</span></span> <span data-ttu-id="099ef-117">不過，若要謹慎使用這種彈性，您仍然可以對應用程式有所説明，像是在不會同時使用的資源之間共用磚，其中磚的內容一律會透過相同的資源對應來初始化，因為這些內容會後續讀取。</span><span class="sxs-lookup"><span data-stu-id="099ef-117">Careful use of this flexibility can still be useful for an application though, like sharing a tile between resources that will not be used simultaneously, where the contents of the tile are always initialized through the same resource mapping as they will be subsequently read from.</span></span> <span data-ttu-id="099ef-118">同樣地，對應來保存多個具有相同 surface 維度之不同資源之壓縮 mipmap 的圖格將會正常運作，這兩個對應中的資料會顯示相同。</span><span class="sxs-lookup"><span data-stu-id="099ef-118">Similarly, a tile mapped to hold the packed mipmaps of multiple different resources with the same surface dimensions will work fine - the data will appear the same in both mappings.</span></span>

<span data-ttu-id="099ef-119">您可以隨時在立即或延遲的內容中，對資源的圖格指派進行變更。</span><span class="sxs-lookup"><span data-stu-id="099ef-119">Changes to tile assignments for a resource can be made at any time in an immediate or deferred context.</span></span>

## <a name="querying-resource-tiling-and-support"></a><span data-ttu-id="099ef-120">查詢資源平鋪和支援</span><span class="sxs-lookup"><span data-stu-id="099ef-120">Querying resource tiling and support</span></span>

<span data-ttu-id="099ef-121">若要查詢資源平鋪，請使用 [**ID3D11Device2：： GetResourceTiling**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11device2-getresourcetiling)。</span><span class="sxs-lookup"><span data-stu-id="099ef-121">To query resource tiling, use [**ID3D11Device2::GetResourceTiling**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11device2-getresourcetiling).</span></span>

<span data-ttu-id="099ef-122">如需其他資源平鋪支援，請使用 [**ID3D11Device2：： CheckMultisampleQualityLevels1**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11device2-checkmultisamplequalitylevels1)。</span><span class="sxs-lookup"><span data-stu-id="099ef-122">For other resource tiling support, use [**ID3D11Device2::CheckMultisampleQualityLevels1**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11device2-checkmultisamplequalitylevels1).</span></span>

## <a name="copying-tiled-data"></a><span data-ttu-id="099ef-123">複製磚資料</span><span class="sxs-lookup"><span data-stu-id="099ef-123">Copying tiled data</span></span>

<span data-ttu-id="099ef-124">Direct3D 中用來移動資料的任何方法，與並排顯示的資源相同，不同之處在于會捨棄未對應區域的寫入，而從未對應的區域讀取會產生0。</span><span class="sxs-lookup"><span data-stu-id="099ef-124">Any methods in Direct3D for moving data around work with tiled resources just as if they are not tiled, except that writes to unmapped areas are dropped and reads from unmapped areas produce 0.</span></span> <span data-ttu-id="099ef-125">如果複製作業牽涉到多次寫入相同的記憶體位置，因為目的地資源中有多個位置對應到相同的磚記憶體，則對多對應磚所產生的寫入將不具決定性且不可重複。</span><span class="sxs-lookup"><span data-stu-id="099ef-125">If a copy operation involves writing to the same memory location multiple times because multiple locations in the destination resource are mapped to the same tile memory, the resulting writes to multi-mapped tiles are non-deterministic and non-repeatable.</span></span> <span data-ttu-id="099ef-126">也就是說，存取會依照硬體執行複製的任何順序進行。</span><span class="sxs-lookup"><span data-stu-id="099ef-126">That is, accesses happen in whatever order the hardware happens to execute the copy.</span></span>

<span data-ttu-id="099ef-127">Direct3D 11.2 引進了下列其他複製方式的方法：</span><span class="sxs-lookup"><span data-stu-id="099ef-127">Direct3D 11.2 introduces methods for these additional ways to copy:</span></span>

-   <span data-ttu-id="099ef-128">在並排顯示的資源中的圖格之間進行複製 (以64KB 的圖格細微性) ，以及 (移入/移出圖形處理器中的緩衝區) 圖形處理單元中的緩衝區 (記憶體) 或預備資源 (- [ **ID3D11DeviceCoNtext2：： CopyTiles**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-copytiles)</span><span class="sxs-lookup"><span data-stu-id="099ef-128">Copy between tiles in a tiled resource (at 64KB tile granularity) and (to/from) a buffer in graphics processing unit (GPU) memory (or staging resource) - [**ID3D11DeviceContext2::CopyTiles**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-copytiles)</span></span>
-   <span data-ttu-id="099ef-129">從應用程式提供的記憶體複製到磚資源中的磚- [ **ID3D11DeviceCoNtext2：： UpdateTiles**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-updatetiles)</span><span class="sxs-lookup"><span data-stu-id="099ef-129">Copy from application-provided memory to tiles in a tiled resource - [**ID3D11DeviceContext2::UpdateTiles**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-updatetiles)</span></span>

<span data-ttu-id="099ef-130">這些方法會視需要 swizzle/deswizzle，並在執行 \_ \_ \_ \_ 中的 GPU 工作未參考呼叫端保證目的地記憶體時，允許 D3D11 圖格複製沒有覆寫旗標。</span><span class="sxs-lookup"><span data-stu-id="099ef-130">These methods swizzle/deswizzle as needed, and allow a D3D11\_TILE\_COPY\_NO\_OVERWRITE flag when the caller promises the destination memory is not referenced by GPU work that is in flight.</span></span>

<span data-ttu-id="099ef-131">複製中的圖格無法包含包含已封裝 mipmap 或具有未定義結果的磚。</span><span class="sxs-lookup"><span data-stu-id="099ef-131">The tiles involved in the copy can't include tiles that contain packed mipmaps or that have results that are undefined.</span></span> <span data-ttu-id="099ef-132">若要將硬體套件的 mipmap 傳輸至/傳出，您必須針對整個 mip 鏈使用標準 (非磚專屬) 複製/更新 Api 或 [**>id3d11devicecoNtext：： GenerateMips**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-generatemips) 。</span><span class="sxs-lookup"><span data-stu-id="099ef-132">To transfer data to/from mipmaps that the hardware packs into one tile, you must use the standard (non-tile specific) Copy/Update APIs or [**ID3D11DeviceContext::GenerateMips**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-generatemips) for the whole mip chain.</span></span>

<span data-ttu-id="099ef-133">**注意：在 [**GenerateMips**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-generatemips)** 上，針對具有部分對應磚的資源使用 [**>id3d11devicecoNtext：： GenerateMips**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-generatemips) ，將會產生只遵循讀取 **和寫入結果** 的結果，而這些規則會套用至硬體和顯示器驅動程式用來 **GenerateMips** 的任何演算法。</span><span class="sxs-lookup"><span data-stu-id="099ef-133">**Note on [**GenerateMips**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-generatemips):** Using [**ID3D11DeviceContext::GenerateMips**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-generatemips) on a resource with partially mapped tiles will produce results that simply follow the rules for reading and writing **NULL** applied to whatever algorithm the hardware and display driver happen to use to **GenerateMips**.</span></span> <span data-ttu-id="099ef-134">因此，應用程式不會特別有用，除非有某些區域具有 **Null** 對應 (，且在產生階段期間其對其他 mips 的影響) 不會對應用程式所關注的介面部分產生影響。</span><span class="sxs-lookup"><span data-stu-id="099ef-134">So, it is not particularly useful for an application to bother doing this unless somehow the areas with **NULL** mappings (and their effect on other mips during the generation phase) will have no consequence on the parts of the surface the application does care about.</span></span>

<span data-ttu-id="099ef-135">例如，從暫存介面或應用程式記憶體複製磚資料，是上傳可能已從磁片串流處理之磚的方式。</span><span class="sxs-lookup"><span data-stu-id="099ef-135">Copying tile data from a staging surface or from application memory would be the way to upload tiles that may have been streamed off disk, for example.</span></span> <span data-ttu-id="099ef-136">串流處理磁片時的變化是將某種壓縮資料上傳至 GPU 記憶體，然後在 GPU 上進行解碼。</span><span class="sxs-lookup"><span data-stu-id="099ef-136">A variation when streaming off disk is uploading some sort of compressed data to GPU memory and then decoding on the GPU.</span></span> <span data-ttu-id="099ef-137">解碼目標可能是 GPU 記憶體中的緩衝區資源， [**CopyTiles**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-copytiles) 接著會將它複製到實際的磚資源。</span><span class="sxs-lookup"><span data-stu-id="099ef-137">The decode target could be a buffer resource in GPU memory, from which [**CopyTiles**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-copytiles) then copies to the actual tiled resource.</span></span> <span data-ttu-id="099ef-138">當 swizzle 模式未知時，此複製步驟可讓 GPU swizzle。</span><span class="sxs-lookup"><span data-stu-id="099ef-138">This copy step allows the GPU to swizzle when the swizzle pattern is not known.</span></span> <span data-ttu-id="099ef-139">如果並排顯示的資源本身是緩衝區資源 (例如，而不是材質) ，則不需要 Swizzling。</span><span class="sxs-lookup"><span data-stu-id="099ef-139">Swizzling is not needed if the tiled resource itself is a buffer resource (for example, as opposed to a Texture).</span></span>

<span data-ttu-id="099ef-140">複本之非並排緩衝資源端的磚記憶體配置，在64KB 的磚中，是在記憶體中的線性，而硬體和顯示驅動程式會在每個磚傳送至/從並排顯示的資源時適當地 swizzle/deswizzle。</span><span class="sxs-lookup"><span data-stu-id="099ef-140">The memory layout of the tiles in the non-tiled buffer resource side of the copy is simply linear in memory within 64KB tiles, which the hardware and display driver would swizzle/deswizzle per tile as appropriate when transferring to/from a tiled resource.</span></span> <span data-ttu-id="099ef-141">若為多重取樣消除鋸齒 (MSAA) 介面，則會在移至下一個圖元之前，以樣本索引順序來遍歷每個圖元的樣本。</span><span class="sxs-lookup"><span data-stu-id="099ef-141">For multisample antialiasing (MSAA) surfaces, each pixel's samples are traversed in sample-index order before moving to the next pixel.</span></span> <span data-ttu-id="099ef-142">針對部分填滿于右邊的圖格，如果表面的寬度不是圖格寬度的倍數（以圖元) 為單位） (，則向下移動資料列的音調/stride 就是在磚填滿時，圖格可容納的圖元數（以位元組為單位）的完整大小（以位元組為單位）。</span><span class="sxs-lookup"><span data-stu-id="099ef-142">For tiles that are partially filled on the right side (for a surface that has a width not a multiple of tile width in pixels), the pitch/stride to move down a row is the full size in bytes of the number pixels that would fit across the tile if the tile was full.</span></span> <span data-ttu-id="099ef-143">因此，記憶體中的每個圖元資料列之間可能會有間距。</span><span class="sxs-lookup"><span data-stu-id="099ef-143">So, there can be a gap between each row of pixels in memory.</span></span> <span data-ttu-id="099ef-144">為了簡化規格，mipmap 小於磚的大小不會一起封裝線上性版面配置中。</span><span class="sxs-lookup"><span data-stu-id="099ef-144">For specification simplicity, mipmaps smaller than a tile are not packed together in the linear layout.</span></span> <span data-ttu-id="099ef-145">這似乎是浪費記憶體空間，但如前所述，將硬體套件複製到 mips 之後，不允許透過 [**CopyTiles**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-copytiles) 或 [**UpdateTiles**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-updatetiles)。</span><span class="sxs-lookup"><span data-stu-id="099ef-145">This seems to be a waste of memory space, but as mentioned copying to mips that the hardware packs together is not allowed via [**CopyTiles**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-copytiles) or [**UpdateTiles**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-updatetiles).</span></span> <span data-ttu-id="099ef-146">應用程式可以直接使用泛型 UpdateSubresource \* () 或 CopySubresource \* () api 來個別複製 small mips，但在 CopySubresource () 中， \* 這表示線性記憶體必須與並排顯示的資源 CopySubresource 相同的維度， \* () 無法從緩衝區資源複製到 Texture2D 實例。</span><span class="sxs-lookup"><span data-stu-id="099ef-146">The application can just use generic UpdateSubresource\*() or CopySubresource\*() APIs to copy small mips individually, though in the case of CopySubresource\*() that means the linear memory has to be the same dimension as the tiled resource - CopySubresource\*() can't copy from a buffer resource to a Texture2D for instance.</span></span>

<span data-ttu-id="099ef-147">如果已定義硬體標準 swizzle，則可以新增旗標，以表示緩衝區中的資料會以該格式來解讀 (傳送) 不需要任何 swizzle，不過在這種情況下上傳資料的替代方法可能也有意義，例如允許應用程式直接存取磚集區記憶體。</span><span class="sxs-lookup"><span data-stu-id="099ef-147">If a hardware standard swizzle is defined, flags could be added to indicate that the data in the buffer is to be interpreted in that format (no swizzle necessary on transfer), though alternative approaches to uploading data may also make sense in that case such as allowing applications direct access to tile pool memory.</span></span>

<span data-ttu-id="099ef-148">複製作業可以在立即或延遲的內容上完成。</span><span class="sxs-lookup"><span data-stu-id="099ef-148">Copying operations can be done on an immediate or deferred context.</span></span>

## <a name="resizing-tile-pool"></a><span data-ttu-id="099ef-149">調整磚集區的大小</span><span class="sxs-lookup"><span data-stu-id="099ef-149">Resizing tile pool</span></span>

<span data-ttu-id="099ef-150">若要調整磚集區的大小，請使用 [**ID3D11DeviceCoNtext2：： ResizeTilePool**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-resizetilepool)。</span><span class="sxs-lookup"><span data-stu-id="099ef-150">To resize a tile pool, use [**ID3D11DeviceContext2::ResizeTilePool**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-resizetilepool).</span></span>

## <a name="tiled-resource-barrier"></a><span data-ttu-id="099ef-151">磚資源關卡</span><span class="sxs-lookup"><span data-stu-id="099ef-151">Tiled resource barrier</span></span>

<span data-ttu-id="099ef-152">若要指定多個磚資源之間的資料存取順序條件約束，請使用 [**ID3D11DeviceCoNtext2：： TiledResourceBarrier**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-tiledresourcebarrier)。</span><span class="sxs-lookup"><span data-stu-id="099ef-152">To specify a data access ordering constraint between multiple tiled resources, use [**ID3D11DeviceContext2::TiledResourceBarrier**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-tiledresourcebarrier).</span></span>

## <a name="related-topics"></a><span data-ttu-id="099ef-153">相關主題</span><span class="sxs-lookup"><span data-stu-id="099ef-153">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="099ef-154">磚資源</span><span class="sxs-lookup"><span data-stu-id="099ef-154">Tiled resources</span></span>](tiled-resources.md)
</dt> </dl>

 

 




