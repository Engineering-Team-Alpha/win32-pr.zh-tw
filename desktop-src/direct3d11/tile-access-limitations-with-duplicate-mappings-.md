---
title: 重複對應的磚存取限制
description: 本節說明重複對應的磚存取限制。
ms.assetid: 7A498E0D-9151-4A89-B7C3-C4F476457D17
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0909b0d10e286e5f774f6893b692abdeb19d3ef7
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/16/2019
ms.locfileid: "104020970"
---
# <a name="tile-access-limitations-with-duplicate-mappings"></a><span data-ttu-id="1712c-103">重複對應的磚存取限制</span><span class="sxs-lookup"><span data-stu-id="1712c-103">Tile access limitations with duplicate mappings</span></span>

<span data-ttu-id="1712c-104">本節說明重複對應的磚存取限制。</span><span class="sxs-lookup"><span data-stu-id="1712c-104">This section describes tile access limitations with duplicate mappings.</span></span>

## <a name="copying-tiled-resources-with-overlapping-source-and-destination"></a><span data-ttu-id="1712c-105">使用重迭的來源和目的地複製並排顯示的資源</span><span class="sxs-lookup"><span data-stu-id="1712c-105">Copying tiled resources with overlapping source and destination</span></span>

<span data-ttu-id="1712c-106">如果複製作業的 [來源] 和 [目的地] 區域中的圖格在 \* 複製區域中有重複的對應，即使這兩個資源並未並排顯示資源，而複製作業 \* 支援重迭的複本，複製作業的 \* 行為會 (，就像是在進入目的地) 之前，將來源複製到暫存位置一樣。</span><span class="sxs-lookup"><span data-stu-id="1712c-106">If tiles in the source and destination area of a Copy\* operation have duplicated mappings in the copy area that would have overlapped even if both resources were not tiled resources and the Copy\* operation supports overlapping copies, the Copy\* operation will behave fine (as if the source is copied to a temporary location before going to the destination).</span></span> <span data-ttu-id="1712c-107">但如果重疊不明顯 (例如來源和目的地資源不同，但給定表面上的共用對應或對應重複)，則不會定義共用磚上複製作業的結果。</span><span class="sxs-lookup"><span data-stu-id="1712c-107">But if the overlap is not obvious (like the source and destination resources are different but share mappings or mappings are duplicated over a given surface), results of the copy operation on the tiles that are shared are undefined.</span></span>

## <a name="copying-to-tiled-resource-with-duplicated-tiles-in-destination-area"></a><span data-ttu-id="1712c-108">複製到具有重複磚的已並排資源，目的區域中有重複的磚</span><span class="sxs-lookup"><span data-stu-id="1712c-108">Copying to tiled resource with duplicated tiles in destination area</span></span>

<span data-ttu-id="1712c-109">除非資料本身相同，否則複製到目的區域中具有重複磚的磚資源會在這些磚中產生未定義的結果;不同的磚可能會以不同的順序來撰寫磚。</span><span class="sxs-lookup"><span data-stu-id="1712c-109">Copying to a tiled resource with duplicated tiles in the destination area produces undefined results in these tiles unless the data itself is identical; different tiles might write the tiles in different orders.</span></span>

## <a name="uav-accesses-to-duplicate-tiles-mappings"></a><span data-ttu-id="1712c-110">UAV 對重複磚對應的存取</span><span class="sxs-lookup"><span data-stu-id="1712c-110">UAV accesses to duplicate tiles mappings</span></span>

<span data-ttu-id="1712c-111">假設未排序的存取視圖 (磚上的 UAV) 在其區域中有重複的磚對應，或與其他系結至管線的資源相同。</span><span class="sxs-lookup"><span data-stu-id="1712c-111">Suppose an unordered access view (UAV) on a tiled resource has duplicate tile mappings in its area or with other resources bound to the pipeline.</span></span> <span data-ttu-id="1712c-112">若由不同執行緒則執行，則不會定義這些重複磚的存取順序，就像任何 UAV 記憶體存取的順序通常都未排序。</span><span class="sxs-lookup"><span data-stu-id="1712c-112">Ordering of accesses to these duplicated tiles is undefined if performed by different threads, just as any ordering of memory access to UAVs in general is unordered.</span></span>

## <a name="rendering-after-tile-mapping-changes-or-content-updates-from-outside-mappings"></a><span data-ttu-id="1712c-113">磚對應變更或內容從對應外部更新後轉譯</span><span class="sxs-lookup"><span data-stu-id="1712c-113">Rendering after tile mapping changes or content updates from outside mappings</span></span>

<span data-ttu-id="1712c-114">如果並排顯示的資源圖格對應已變更，或已對應的磚化集區磚中的內容已透過另一個已並排的資源對應變更，而並排顯示的資源將會透過轉譯目標視圖或深度樣板視圖來呈現，應用程式必須使用固定的函式 Clear Api 來清除 (，) 或使用複製/Update api 完整複製已在轉譯 \* \* 的區域中變更的磚 (對應或不) 。</span><span class="sxs-lookup"><span data-stu-id="1712c-114">If a tiled resource's tile mappings have changed or content in mapped tiled pool tiles have changed via another tiled resource's mappings, and the tiled resource is going to be rendered via render target view or depth stencil view, the application must Clear (using the fixed function Clear APIs) or fully copy over using Copy\*/Update\* APIs the tiles that have changed within the area being rendered (mapped or not).</span></span> <span data-ttu-id="1712c-115">在這些情況下，如果應用程式無法清除或複製，會導致指定的轉譯目標視圖或深度樣板視圖的硬體優化結構過時，並且會導致在不同硬體上的一些硬體和不一致的情況下產生垃圾收集結果。</span><span class="sxs-lookup"><span data-stu-id="1712c-115">Failure of an application to clear or copy in these cases results in hardware optimization structures for the given render target view or depth stencil view being stale and will result in garbage rendering results on some hardware and inconsistency across different hardware.</span></span> <span data-ttu-id="1712c-116">硬體所使用的這些隱藏的最佳化資料結構可能對個別對應而言為本機項目，而不會對其他記憶體相同的對應顯示。</span><span class="sxs-lookup"><span data-stu-id="1712c-116">These hidden optimization data structures used by hardware might be local to individual mappings and not visible to other mappings to the same memory.</span></span>

<span data-ttu-id="1712c-117">[**ID3D11DeviceCoNtext1：： ClearView**](/windows/desktop/api/D3D11_1/nf-d3d11_1-id3d11devicecontext1-clearview)作業支援清除具有矩形的呈現目標視圖。</span><span class="sxs-lookup"><span data-stu-id="1712c-117">The [**ID3D11DeviceContext1::ClearView**](/windows/desktop/api/D3D11_1/nf-d3d11_1-id3d11devicecontext1-clearview) operation supports clearing render target views with rectangles.</span></span> <span data-ttu-id="1712c-118">針對支援並排顯示資源的硬體， **ClearView** 也必須支援清除具有矩形的深度樣板視圖，以取得沒有樣板) 的深度 (表面。</span><span class="sxs-lookup"><span data-stu-id="1712c-118">For hardware that supports tiled resources, **ClearView** must also support clearing of depth stencil views with rectangles, for depth only surfaces (without stencil).</span></span> <span data-ttu-id="1712c-119">這項作業可讓應用程式只清除表面的必要區域。</span><span class="sxs-lookup"><span data-stu-id="1712c-119">This operation allows applications to clear only the necessary area of a surface.</span></span>

<span data-ttu-id="1712c-120">如果應用程式需要在對應已變更的磚資源中保留區域的現有記憶體內容，則該應用程式必須解決清楚的需求。</span><span class="sxs-lookup"><span data-stu-id="1712c-120">If an application needs to preserve existing memory contents of areas in a tiled resource where mappings have changed, that application must work around the clear requirement.</span></span> <span data-ttu-id="1712c-121">應用程式可以藉由將圖格對應變更 (的內容（例如，使用 [**ID3D11DeviceCoNtext2：： CopyTiles**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-copytiles)) 、發出必要的 clear 命令，然後將內容複寫回來），來完成這項工作。</span><span class="sxs-lookup"><span data-stu-id="1712c-121">The application can accomplish this work-around by first saving the contents where tile mappings have changed (by copying them to a temporary surface, for example, by using [**ID3D11DeviceContext2::CopyTiles**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-copytiles)), issuing the required clear command and then copying the contents back.</span></span> <span data-ttu-id="1712c-122">雖然這可完成為遞增轉譯保存表面內容的工作，但缺點是表面的後續轉譯效能可能效能降低，因為轉譯最佳化可能遺失。</span><span class="sxs-lookup"><span data-stu-id="1712c-122">While this would accomplish the task of preserving surface contents for incremental rendering, the downside is that subsequent rendering performance on the surface might suffer because rendering optimizations might be lost.</span></span>

<span data-ttu-id="1712c-123">如果圖格同時對應到多個並排顯示的資源，並透過任何方式來操作磚內容， (透過其中一個並排顯示的資源轉譯、複製等) ，而且如果相同磚是透過任何其他並排顯示的資源轉譯，則必須先清除磚，如先前所述。</span><span class="sxs-lookup"><span data-stu-id="1712c-123">If a tile is mapped into multiple tiled resources at the same time and tile contents are manipulated by any means (render, copy, and so on) via one of the tiled resources, if the same tile is to be rendered via any other tiled resource, the tile must be cleared first as previously described.</span></span>

## <a name="rendering-to-tiles-shared-outside-render-area"></a><span data-ttu-id="1712c-124">轉譯至在轉譯區域以外共用的磚</span><span class="sxs-lookup"><span data-stu-id="1712c-124">Rendering to tiles shared outside render area</span></span>

<span data-ttu-id="1712c-125">假設正在將並排顯示的資源中的某個區域轉譯為，而且轉譯區域所參考的磚集區磚也會從呈現區域外對應到， (包括透過其他並排顯示的資源，而不是) 。</span><span class="sxs-lookup"><span data-stu-id="1712c-125">Suppose an area in a tiled resource is being rendered to and the tile pool tiles referenced by the render area are also mapped to from outside the render area (including via other tiled resources, at the same time or not).</span></span> <span data-ttu-id="1712c-126">透過其他對應檢視時，轉譯至這些磚的資料並不保證會正確顯示，即使基礎記憶體配置相容也一樣。</span><span class="sxs-lookup"><span data-stu-id="1712c-126">Data rendered to these tiles isn't guaranteed to appear correctly when viewed through the other mappings, even though the underlying memory layout is compatible.</span></span> <span data-ttu-id="1712c-127">這是因為某些硬體所使用的最佳化資料結構對可轉譯表面的個別對應而言可能為本機，但不會對記憶體位置相同的其他對應顯示。</span><span class="sxs-lookup"><span data-stu-id="1712c-127">This fact is due to optimization data structures some hardware use that can be local to individual mappings for renderable surfaces and not visible to other mappings to the same memory location.</span></span> <span data-ttu-id="1712c-128">您可以從轉譯對應複製到所有其他可能存取之記憶體相同的對應 (或者若不再需要舊的內容，即可清除該記憶體或將其他資料複製到其中) 來因應這項限制。</span><span class="sxs-lookup"><span data-stu-id="1712c-128">You can work around this restriction by copying from the rendered mapping to all the other mappings to the same memory that might be accessed (or clearing that memory or copying other data to it if the old contents are no longer needed).</span></span> <span data-ttu-id="1712c-129">雖然這項因應措施看起來很冗餘，但可讓所有其他記憶體相同的對應正確了解如何存取其內容，且至少因為只有單一實體記憶體備份保持不變而節省記憶體。</span><span class="sxs-lookup"><span data-stu-id="1712c-129">While this work-around seems redundant, it makes all other mappings to the same memory correctly understand how to access its contents, and at least the memory savings of having only a single physical memory backing remains intact.</span></span> <span data-ttu-id="1712c-130">此外，當您在使用 (共用對應的不同並排顯示資源之間切換時，除非唯讀取) ，否則您必須在參數之間呼叫 [**ID3D11DeviceCoNtext2：： TiledResourceBarrier**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-tiledresourcebarrier) API。</span><span class="sxs-lookup"><span data-stu-id="1712c-130">Also, when you switch between using different tiled resources that share mappings (unless only reading), you must call the [**ID3D11DeviceContext2::TiledResourceBarrier**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-tiledresourcebarrier) API in between the switches.</span></span>

## <a name="rendering-to-tiles-shared-within-render-area"></a><span data-ttu-id="1712c-131">轉譯至在轉譯區域以內共用的磚</span><span class="sxs-lookup"><span data-stu-id="1712c-131">Rendering to tiles shared within render area</span></span>

<span data-ttu-id="1712c-132">如果並排顯示資源中的區域正在轉譯，且在轉譯區域內有多個圖格對應到相同的磚集區位置，則轉譯結果在這些磚上不會定義。</span><span class="sxs-lookup"><span data-stu-id="1712c-132">If an area in a tiled resource is being rendered to and within the render area multiple tiles are mapped to the same tile pool location, rendering results are undefined on those tiles.</span></span>

## <a name="data-compatibility-across-tiled-resources-sharing-tiles"></a><span data-ttu-id="1712c-133">跨磚資源分享磚的資料相容性</span><span class="sxs-lookup"><span data-stu-id="1712c-133">Data compatibility across tiled resources sharing tiles</span></span>

<span data-ttu-id="1712c-134">假設有多個並排顯示的資源對應至相同的磚集區位置，而每個資源都用來存取相同的資料。</span><span class="sxs-lookup"><span data-stu-id="1712c-134">Suppose multiple tiled resources have mappings to the same tile pool locations and each resource is used to access the same data.</span></span> <span data-ttu-id="1712c-135">這種情況只有在避免硬體優化結構發生問題的其他規則被避免、適當呼叫 [**ID3D11DeviceCoNtext2：： TiledResourceBarrier**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-tiledresourcebarrier) ，以及並排顯示的資源彼此相容時，才有效。</span><span class="sxs-lookup"><span data-stu-id="1712c-135">This scenario is only valid if the other rules about avoiding problems with hardware optimization structures are avoided, appropriate calls to [**ID3D11DeviceContext2::TiledResourceBarrier**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-tiledresourcebarrier) are made, and the tiled resources are compatible with each other.</span></span> <span data-ttu-id="1712c-136">在這裡會說明後者，以將共用磚的並排資源視為不相容的意義。</span><span class="sxs-lookup"><span data-stu-id="1712c-136">The latter is described here in terms of what it means for tiled resources sharing tiles to be incompatible.</span></span> <span data-ttu-id="1712c-137">存取重複磚對應之間相同資料的不相容情況是使用不同的表面維度或格式，或是資源上轉譯目標或深度樣板繫結旗標呈現的差異。</span><span class="sxs-lookup"><span data-stu-id="1712c-137">The incompatibility conditions of accessing the same data across duplicate tile mappings are the use of different surface dimensions or format, or differences in the presence of render target or depth stencil bind flags on the resources.</span></span> <span data-ttu-id="1712c-138">若您後續透過來自不相容資源的對應進行讀取或轉譯，則使用一種對應寫入記憶體會產生未定義的結果。</span><span class="sxs-lookup"><span data-stu-id="1712c-138">Writing to the memory with one type of mapping produces undefined results if you subsequently read or render via a mapping from an incompatible resource.</span></span> <span data-ttu-id="1712c-139">若另一個資源共用對應首先使用新資料初始化 (回收記憶體作為其他用途)，則後續讀取或轉譯作業會運作正常，因為資料不會在不相容的解譯間洩出。</span><span class="sxs-lookup"><span data-stu-id="1712c-139">If the other resource sharing mappings are first initialized with new data (recycling the memory for a different purpose), the subsequent read or render operation is fine since data isn't bleeding across incompatible interpretations.</span></span> <span data-ttu-id="1712c-140">但是，當您在存取像這樣的不相容對應之間切換時，必須呼叫 **TiledResourceBarrier** API。</span><span class="sxs-lookup"><span data-stu-id="1712c-140">But, you must call the **TiledResourceBarrier** API when you switch between accessing incompatible mappings like this.</span></span>

<span data-ttu-id="1712c-141">如果在任何資源共用對應上彼此都未設定轉譯目標或深度樣板繫結旗標，則限制大為降低。</span><span class="sxs-lookup"><span data-stu-id="1712c-141">If the render target or depth stencil bind flag isn't set on any of the resources sharing mappings with each other, there are far fewer restrictions.</span></span> <span data-ttu-id="1712c-142">只要格式及表面類型 (例如 Texture2D) 相同，即可共用磚。</span><span class="sxs-lookup"><span data-stu-id="1712c-142">As long as the format and surface types (for example, Texture2D) are the same, tiles can be shared.</span></span> <span data-ttu-id="1712c-143">不同的格式是相容的案例，例如 BC 介面 \* ，以及每個元件格式的相等大小未壓縮32位或16位，例如 BC6H 和 R32G32B32A32。</span><span class="sxs-lookup"><span data-stu-id="1712c-143">Different formats being compatible are cases such as BC\* surfaces and the equivalent sized uncompressed 32 bit or 16 bit per component format, like BC6H and R32G32B32A32.</span></span> <span data-ttu-id="1712c-144">許多32位的每個元素格式也可以使用 R32 來加上別名， \_ \* (R10G10B10A2 \_ \* 、R8G8B8A8 \_ \* 、B8G8R8A8 \_ \* 、B8G8R8X8 \_ \* 、R16G16 \_ \*) ; 這項作業一律允許用於非並排的資源。</span><span class="sxs-lookup"><span data-stu-id="1712c-144">Many 32 bit per element formats can be aliased with R32\_\* as well (R10G10B10A2\_\*, R8G8B8A8\_\*, B8G8R8A8\_\*,B8G8R8X8\_\*,R16G16\_\*); this operation has always been allowed for non-tiled resources.</span></span>

<span data-ttu-id="1712c-145">如果格式相容且磚會填入純色，則壓縮與非壓縮磚之間的共用會運作良好。</span><span class="sxs-lookup"><span data-stu-id="1712c-145">Sharing between packed and non-packed tiles is fine if the formats are compatible and the tiles are filled with solid color.</span></span>

<span data-ttu-id="1712c-146">最後，如果資源共用磚對應之間唯一的共同點是其皆不具轉譯目標或深度樣板繫結旗標，則僅可安全地共用填入 0 的記憶體；對應會顯示為任何 0 針對給定資源格式定義的解碼目標 (通常僅為 0)。</span><span class="sxs-lookup"><span data-stu-id="1712c-146">Finally, if nothing is common about the resources sharing tile mappings except that none have render target or depth stencil bind flags, only memory filled with 0 can be shared safely; the mapping will appear as whatever 0 decodes to for the definition of the given resource format (typically just 0).</span></span>

## <a name="related-topics"></a><span data-ttu-id="1712c-147">相關主題</span><span class="sxs-lookup"><span data-stu-id="1712c-147">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="1712c-148">磚資源的管線存取</span><span class="sxs-lookup"><span data-stu-id="1712c-148">Pipeline access to tiled resources</span></span>](pipeline-access-to-tiled-resources.md)
</dt> </dl>

 

 




