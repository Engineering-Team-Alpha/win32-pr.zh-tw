---
description: Windows 檔案總管提供 Shell 命名空間的圖形標記法，並結合了可讓使用者與 Shell 物件互動的工具。
ms.assetid: cc387338-15fa-4350-b039-61a0f1c5030a
title: 瞭解 Shell 命名空間延伸模組
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a0150092a25708c1f079160a9d106a7b8205e231
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "104973360"
---
# <a name="understanding-shell-namespace-extensions"></a>瞭解 Shell 命名空間延伸模組

Windows 檔案總管提供 Shell 命名空間的圖形標記法，並結合了可讓使用者與 Shell 物件互動的工具。 使用命名空間延伸模組時，您可以採用任何資料主體，並讓 Windows 檔案總管將其以虛擬資料夾的形式呈現給使用者。 當使用者流覽到這個資料夾時，您的資料會顯示為資料夾和檔案的樹狀結構化階層，與 Shell 命名空間的其餘部分很類似。 使用者和應用程式能夠與此虛擬資料夾的內容互動，與任何其他命名空間物件的方式大致相同。 本檔討論如何建立命名空間延伸模組。

-   [命名空間延伸模組的運作方式](#how-a-namespace-extension-works)
-   [預設的系統資料夾 View 物件 (DefView) ](#the-default-system-folder-view-object-defview)
-   [Windows 檔案總管如何與命名空間延伸模組互動](#how-windows-explorer-interacts-with-a-namespace-extension)
    -   [樹狀檢視](#tree-view)
    -   [資料夾檢視](#folder-view)
    -   [功能表列和工具列](#menu-bar-and-toolbars)
    -   [狀態列](#status-bar)

## <a name="how-a-namespace-extension-works"></a>命名空間延伸模組的運作方式

在幕後，Windows 檔案總管顯示的每個資料夾都會以元件物件模型表示， (COM) 物件，稱為 *資料夾物件*。 每次使用者與資料夾或其內容互動時，命令介面都會透過許多標準介面的其中一個來與相關聯的資料夾物件進行通訊。 資料夾物件接著會執行任何必要的動作來回應使用者的動作，而 Shell 會更新 Windows 檔案總管顯示。

使用者與其互動的大部分檔案和資料夾都是檔案系統或系統虛擬資料夾（例如資源回收筒）的一部分。 其他檔已討論過如何自訂這些標準資料夾的行為，藉由修改登錄或藉由執行 [Shell 擴充處理常式](handlers.md)，來滿足應用程式的需求。 不過，當您的資訊可立即以一般檔案系統檔案或資料夾的形式封裝時，以這些方式擴充 Shell 最有用。

有幾種情況下，將資料儲存為檔系統資料夾和檔案的集合，可能不需要或甚至根本不可能。 這類資料的一些範例包括：

-   最有效率地封裝在單一檔案（例如資料庫）中的專案集合。
-   儲存在沒有標準 Windows 檔案系統之遠端電腦上的專案集合。 這類資料的範例是儲存在個人數位助理 (PDA) 或數位相機的資訊。
-   不代表儲存資料的專案集合。 這類資料的範例是標準印表機資料夾所包含的印表機連結。

將這類資料呈現給使用者的其中一種方式是撰寫應用程式，讓使用者能夠查看各種專案並與其互動。 但是，如果您的資料可以呈現為資料夾/檔案階層，您需要執行的大部分功能都可能是 Windows 檔案總管已提供的使用者介面服務。 更有效率的方法是撰寫命名空間延伸，讓 Windows 檔案總管成為 GUI。

若要執行命名空間延伸，您的資訊必須組織成樹狀結構的命名空間。 您的 *命名空間根目錄* 會顯示為 Shell 命名空間中的虛擬資料夾。 根資料夾及其所有子資料夾和資料項目都會變成 Shell 命名空間的一部分，Windows 檔案總管則會變成您的使用者介面。 因此，您可以使用比自訂應用程式所需更少的 UI 程式設計，以熟悉且立即存取的方式向使用者呈現您的資訊。

命名空間延伸包含兩個基本元件：

-   資料管理員
-   資料管理員與 Windows 檔案總管之間的介面

清單中的第一個元件完全由您負責。 您可以用任何最有效的方式來儲存及管理資料。 第二個元件是將您的資料封裝為資料夾物件所需的程式碼，並處理與 Windows 檔案總管的互動。 Windows 檔案總管接著可以呼叫這些物件，讓使用者可以像是資料夾和檔案的集合一樣，查看資料並與其互動。 您的命名空間延伸的資料夾物件必須與 Windows 檔案總管互動，就像是一般資料夾一樣。 在嘗試執行命名空間延伸之前，您必須先瞭解 Windows 檔案總管如何處理資料夾物件。

## <a name="the-default-system-folder-view-object-defview"></a>預設的系統資料夾 View 物件 (DefView) 

Shell 會提供資料夾檢視的預設執行，堆疊稱為 DefView，如此您就可以避免執行自己的命名空間延伸模組的大部分工作。 由於某些視圖功能無法透過自訂視圖來達成，因此通常建議使用預設的系統資料夾 view 物件來取代自訂視圖。 如需詳細資訊，請參閱 [**SHCreateShellFolderView**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shcreateshellfolderview)。

## <a name="how-windows-explorer-interacts-with-a-namespace-extension"></a>Windows 檔案總管如何與命名空間延伸模組互動

Windows 檔案總管為使用者提供的 GUI 可讓他們執行各種不同的工作，包括：

-   [流覽](navigate.md) 命名空間階層，並查看資料夾的內容。
-   藉由移動、刪除和複製物件來[管理](manage.md)命名空間的內容。
-   [正在](folder-info.md) 抓取物件的各種相關資訊。
-   [啟動](launch.md) 應用程式。

Windows 檔案總管 GUI 有五個基本元件。 下圖會命名元件，並顯示它們通常顯示在 Windows 檔案總管中的位置。

![顯示 windows explorer 使用者介面元件的圖例 ](images/nse1.png)

當使用者在 Windows 檔案總管中顯示屬於命名空間延伸的資料夾時，資料夾物件對這五個區域的內容至少有部分的控制權。

### <a name="tree-view"></a>樹狀目錄檢視

樹狀檢視會提供命名空間的高階觀點。 此區域會裝載 [樹狀檢視控制項](../controls/tree-view-controls.md) ，以顯示每個命名空間資料夾和資料夾在命名空間階層中的位置。 使用者可以使用樹狀檢視區域執行數項作業，包括：

-   顯示或隱藏命名空間中的下一個層級。
-   複製、移動或刪除資料夾。
-   以滑鼠右鍵按一下資料夾，以顯示快捷方式功能表。
-   選取資料夾，並在資料夾檢視中查看其內容。

樹狀檢視主要透過其 [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) 介面與資料夾物件進行通訊。 例如，當使用者按一下資料夾圖示旁邊的加號 (+) 時，Windows 檔案總管會展開顯示，以顯示資料夾的子資料夾。 為了取得更新樹狀檢視所需的資訊，Shell 會對資料夾物件的 **IShellFolder** 介面進行數個呼叫，以執行下列動作：

-   要求資料夾的屬性。
-   列舉資料夾的內容。
-   要求每個子資料夾的顯示名稱。
-   要求顯示每個資料夾旁的圖示。

Windows 檔案總管接著會更新樹狀檢視，以顯示所選資料夾的子資料夾。 如果子資料夾有子資料夾，則會在其資料夾圖示旁邊顯示 ' + ' 字元。 使用者也可以使用樹狀檢視來執行一些更複雜的工作，包括：

-   使用剪貼簿剪下或複製資料夾，並將它貼入另一個資料夾。
-   使用拖放來剪下或複製資料夾，並將它放在另一個資料夾。
-   使用搜尋引擎來搜尋資料夾或其子資料夾中的專案。
-   修改資料夾的屬性。

如需命名空間延伸模組如何處理這些使用者動作的詳細討論，請參閱 [執行基本資料夾物件介面](nse-implement.md)。

### <a name="folder-view"></a>資料夾檢視

當使用者選取資料夾時，資料夾的內容會顯示在資料夾檢視中。 在某些程度上，資料夾檢視的一般功能會與樹狀檢視重迭。 使用者可以移動或複製資料夾、變更資料夾屬性、查看子資料夾的內容、顯示資料夾的快捷方式功能表等。 不過，樹狀檢視和資料夾檢視之間有一些不同的差異：

-   資料夾檢視只會顯示單一資料夾的內容，而不會顯示部分或所有的命名空間階層。
-   資料夾檢視會顯示檔案物件以及資料夾物件。
-   資料夾檢視可顯示與樹狀檢視更多的物件相關資訊。
-   資料夾檢視可讓命名空間延伸幾乎完全掌控所顯示的資訊和方法。 您只能修改樹狀檢視的小部分，例如資料夾圖示。

不同于樹狀檢視，Windows 檔案總管不會直接控制資料夾檢視的內容。 資料夾檢視是 Windows 檔案總管提供給資料夾物件的區域。 在資料夾檢視中顯示和管理資料夾的內容是資料夾物件的責任。 雖然大部分的資料夾檢視都遵循相當標準的格式，但實際上有一些限制可顯示或如何顯示。 極端的情況是，網際網路資料夾是功能完整的瀏覽器。

當使用者選取屬於您的命名空間延伸的資料夾時，您會建立視窗並將其控制碼傳遞至 Windows 檔案總管。 此視窗會成為資料夾檢視視窗的子系。 Windows 檔案總管提供資料夾檢視視窗的維度，但對子視窗的內容沒有任何限制。 然後，您可以使用子視窗來顯示資料夾的資料夾檢視。

命名空間延伸會使用下列兩種方法之一來建立資料夾檢視：

-   使用您的子視窗來裝載 [清單視圖](../controls/list-view-control-reference.md) 控制項。 此控制項可讓您以與 Windows 檔案總管 [傳統視圖](../lwef/web-view.md)相同的方式，顯示資料夾的內容。
-   您可以使用子視窗來裝載 [WebBrowser 控制項](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa752044(v=vs.85)) ，並使用動態 HTML (DHTML) 檔來顯示資料夾的內容。

這兩種方法都會顯示一個看起來像系統資料夾所顯示的資料夾檢視。 但是，如果您想要使用不同的顯示配置，您可以隨意執行。

### <a name="menu-bar-and-toolbars"></a>功能表列和工具列

和大部分的 Windows 應用程式一樣，Windows 檔案總管可為使用者提供一組工具。 您可以透過功能表列取得完整的工具選項。 工具列上的按鈕或編輯方塊也會以較常用的工具來表示。 和許多 Windows 應用程式不同的是，Windows 檔案總管的功能表列實際上是已自訂的 [工具列控制項](../controls/toolbar-control-reference.md) ，其行為就像傳統功能表一樣。 功能表列和工具列都會合並到 [Rebar 控制項](../controls/rebar-control-reference.md) 中，以允許使用者組織個別控制項以符合其需求。

根據預設，Windows 檔案總管支援一組標準的按鈕和功能表項目，例如 [複製] 和 [屬性]。 您的命名空間延伸模組可以藉由刪除標準工具和新增自訂工具，來自訂功能表列和工具列。 當您的資料夾 view 物件已初始化時，Windows 檔案總管會將指標傳遞至其 [**IShellBrowser**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) 介面。 此介面支援數個可供您呼叫的方法，以自訂功能表列和工具列。 當使用者選取您的其中一個自訂功能表項目或工具列按鈕時，Windows 檔案總管將 \_ 自訂功能表和工具列專案的 WM 命令訊息轉送至子視窗的視窗程式。

### <a name="status-bar"></a>狀態列

Windows 檔案總管狀態列會顯示目前所選物件的相關資訊。 您的命名空間延伸模組可以使用狀態列來顯示狀態資訊，例如文字字串。 您可以藉由呼叫 [**IShellBrowser**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellbrowser)來自訂狀態列。

 

 
