---
description: 在 Windows Vista 之前，您建立了一個 .dll 檔案，並將它命名為 cpl 副檔名來建立主控台專案。
ms.assetid: 258dae28-c054-4392-b0e9-99493f23c814
title: 使用 CPLApplet
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b1e59b29dd7c082822ed63d425dd4967a542b5d1
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104973112"
---
# <a name="using-cplapplet"></a><span data-ttu-id="42263-103">使用 CPLApplet</span><span class="sxs-lookup"><span data-stu-id="42263-103">Using CPLApplet</span></span>

<span data-ttu-id="42263-104">在 Windows Vista 之前，您建立了一個 .dll 檔案，並將它命名為 cpl 副檔名來建立主控台專案。</span><span class="sxs-lookup"><span data-stu-id="42263-104">Prior to Windows Vista, you created a Control Panel item by creating a .dll file and naming it with a .cpl extension.</span></span> <span data-ttu-id="42263-105">此檔案已匯出 [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) 函式。</span><span class="sxs-lookup"><span data-stu-id="42263-105">This file exported the [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) function.</span></span> <span data-ttu-id="42263-106">在 Windows Vista 和更新版本中仍支援此配置，本主題將討論此配置。</span><span class="sxs-lookup"><span data-stu-id="42263-106">This scheme is still supported in Windows Vista and later versions and is discussed in this topic.</span></span> <span data-ttu-id="42263-107">不過，新主控台專案的指導方針會建議更簡單的方法，並以使用工作流程配置的 .exe 檔案形式來建立主控台專案。</span><span class="sxs-lookup"><span data-stu-id="42263-107">However, the guidelines for new Control Panel items recommend a simpler approach with the Control Panel item built as a .exe file that uses a task flow layout.</span></span>

<span data-ttu-id="42263-108">當主控台載入 .dll (或 cpl) 檔案時，它會呼叫 [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) 函式來取得資訊，例如檔案所裝載的主控台專案數，以及每個專案的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="42263-108">When Control Panel loads a .dll (or .cpl) file, it calls the [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) function to get information such as the number of Control Panel items the file hosts, as well as information about each item.</span></span> <span data-ttu-id="42263-109">主控台也會在專案的視窗初始化、開啟或關閉時呼叫函式。</span><span class="sxs-lookup"><span data-stu-id="42263-109">Control Panel also calls the function when the item's window is initialized, opened, or closed.</span></span>

<span data-ttu-id="42263-110">當 Windows 第一次載入主控台專案時，它會抓取 [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) 函式的位址，並接著使用該位址呼叫函式並傳遞訊息。</span><span class="sxs-lookup"><span data-stu-id="42263-110">When Windows first loads the Control Panel item, it retrieves the address of the [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) function and subsequently uses that address to call the function and pass it messages.</span></span> <span data-ttu-id="42263-111">它可能會傳送下列訊息。</span><span class="sxs-lookup"><span data-stu-id="42263-111">It might send the following messages.</span></span>



| <span data-ttu-id="42263-112">訊息</span><span class="sxs-lookup"><span data-stu-id="42263-112">Message</span></span>                                     | <span data-ttu-id="42263-113">描述</span><span class="sxs-lookup"><span data-stu-id="42263-113">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|---------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="42263-114">**CPL \_ DBLCLK**</span><span class="sxs-lookup"><span data-stu-id="42263-114">**CPL\_DBLCLK**</span></span>](cpl-dblclk.md)           | <span data-ttu-id="42263-115">傳送以通知 [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) ，使用者已選擇與指定主控台專案相關聯的圖示。</span><span class="sxs-lookup"><span data-stu-id="42263-115">Sent to notify [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) that the user has chosen the icon associated with a given Control Panel item.</span></span> <span data-ttu-id="42263-116">**CPlApplet** 應該會顯示指定專案的對話方塊，並執行任何使用者指定的工作。</span><span class="sxs-lookup"><span data-stu-id="42263-116">**CPlApplet** should display the dialog box for the specified item and carry out any user-specified tasks.</span></span> <span data-ttu-id="42263-117">**CPlApplet** *lParam1* 參數是一個整數，代表主控台專案的以零為基底的索引。</span><span class="sxs-lookup"><span data-stu-id="42263-117">The **CPlApplet** *lParam1* parameter is an integer that represents the zero-based index of the Control Panel item.</span></span> <span data-ttu-id="42263-118">*LParam2* 參數是在 [**CPL \_ INQUIRE**](cpl-inquire.md)或 [**Cpl \_ NEWINQUIRE**](cpl-newinquire.md)訊息 [**的 CPLINFO**](/windows/win32/api/cpl/ns-cpl-cplinfo)或 [**NEWCPLINFO**](/windows/win32/api/cpl/ns-cpl-newcplinfoa)結構中傳回的 **lpData** 指標。</span><span class="sxs-lookup"><span data-stu-id="42263-118">The *lParam2* parameter is the **lpData** pointer returned in the [**CPLINFO**](/windows/win32/api/cpl/ns-cpl-cplinfo) or [**NEWCPLINFO**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) structure in the [**CPL\_INQUIRE**](cpl-inquire.md) or [**CPL\_NEWINQUIRE**](cpl-newinquire.md) message.</span></span> <span data-ttu-id="42263-119">傳回值會被忽略。</span><span class="sxs-lookup"><span data-stu-id="42263-119">The return value is ignored.</span></span>                                                                |
| [<span data-ttu-id="42263-120">**CPL \_ 結束**</span><span class="sxs-lookup"><span data-stu-id="42263-120">**CPL\_EXIT**</span></span>](cpl-exit.md)               | <span data-ttu-id="42263-121">在最後一個 CPL \_ 停止訊息之後傳送，而且在 Windows 使用 [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) 函式釋放包含主控台專案的 DLL 之前。</span><span class="sxs-lookup"><span data-stu-id="42263-121">Sent after the last CPL\_STOP message and immediately before Windows uses the [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) function to free the DLL that contains the Control Panel item.</span></span> <span data-ttu-id="42263-122">[**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) 應該釋放任何剩餘的記憶體，並準備關閉。</span><span class="sxs-lookup"><span data-stu-id="42263-122">[**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) should free any remaining memory and prepare to close.</span></span> <span data-ttu-id="42263-123">傳回值會被忽略。</span><span class="sxs-lookup"><span data-stu-id="42263-123">The return value is ignored.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                |
| [<span data-ttu-id="42263-124">**CPL \_ GETCOUNT**</span><span class="sxs-lookup"><span data-stu-id="42263-124">**CPL\_GETCOUNT**</span></span>](cpl-getcount.md)       | <span data-ttu-id="42263-125">在 CPL \_ INIT 訊息之後傳送，以 [**提示 CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) 傳回數位，指出它所支援的 subprograms 數目。</span><span class="sxs-lookup"><span data-stu-id="42263-125">Sent after the CPL\_INIT message to prompt [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) to return a number that indicates how many subprograms it supports.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| [<span data-ttu-id="42263-126">**CPL \_ INIT**</span><span class="sxs-lookup"><span data-stu-id="42263-126">**CPL\_INIT**</span></span>](cpl-init.md)               | <span data-ttu-id="42263-127">在載入包含主控台專案的 DLL 之後立即傳送。</span><span class="sxs-lookup"><span data-stu-id="42263-127">Sent immediately after the DLL that contains the Control Panel item is loaded.</span></span> <span data-ttu-id="42263-128">訊息會提示 [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) 執行初始化程式，包括記憶體配置。</span><span class="sxs-lookup"><span data-stu-id="42263-128">The message prompts [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) to perform initialization procedures, including memory allocation.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| [<span data-ttu-id="42263-129">**CPL \_ 查詢**</span><span class="sxs-lookup"><span data-stu-id="42263-129">**CPL\_INQUIRE**</span></span>](cpl-inquire.md)         | <span data-ttu-id="42263-130">在 CPL \_ GETCOUNT 訊息之後傳送，以提示 [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) 提供指定之 subprogram 的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="42263-130">Sent after the CPL\_GETCOUNT message to prompt [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) to provide information about a specified subprogram.</span></span> <span data-ttu-id="42263-131">*LParam1* 值是一個整數，代表所要求的資訊之 subprogram 的以零為基底的索引。</span><span class="sxs-lookup"><span data-stu-id="42263-131">The *lParam1* value is an integer that represents the zero-based index of the subprogram about which information is being requested.</span></span> <span data-ttu-id="42263-132">**CPlApplet** 的 *lParam2* 參數會指向 [**CPLINFO**](/windows/win32/api/cpl/ns-cpl-cplinfo)結構。</span><span class="sxs-lookup"><span data-stu-id="42263-132">The *lParam2* parameter of **CPlApplet** points to a [**CPLINFO**](/windows/win32/api/cpl/ns-cpl-cplinfo) structure.</span></span> <span data-ttu-id="42263-133">傳回值會被忽略。</span><span class="sxs-lookup"><span data-stu-id="42263-133">The return value is ignored.</span></span>                                                                                                                                                                                                                                                                                                    |
| [<span data-ttu-id="42263-134">**CPL \_ NEWINQUIRE**</span><span class="sxs-lookup"><span data-stu-id="42263-134">**CPL\_NEWINQUIRE**</span></span>](cpl-newinquire.md)   | <span data-ttu-id="42263-135">在 CPL \_ GETCOUNT 訊息之後傳送，以提示 [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) 提供指定主控台專案的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="42263-135">Sent after the CPL\_GETCOUNT message to prompt [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) to provide information about a specified Control Panel item.</span></span> <span data-ttu-id="42263-136">*LParam1* 值是一個整數，代表所要求的資訊之 subprogram 的以零為基底的索引。</span><span class="sxs-lookup"><span data-stu-id="42263-136">The *lParam1* value is an integer that represents the zero-based index of the subprogram about which information is being requested.</span></span> <span data-ttu-id="42263-137">*LParam2* 參數是指向 [**NEWCPLINFO**](/windows/win32/api/cpl/ns-cpl-newcplinfoa)結構的指標。</span><span class="sxs-lookup"><span data-stu-id="42263-137">The *lParam2* parameter is a pointer to a [**NEWCPLINFO**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) structure.</span></span> <span data-ttu-id="42263-138">\_通常應忽略 CPL NEWINQUIRE。</span><span class="sxs-lookup"><span data-stu-id="42263-138">CPL\_NEWINQUIRE normally should be ignored.</span></span> <span data-ttu-id="42263-139">您的應用程式應該只處理 \_ Windows 95、Microsoft Windows NT 4.0 和更新版本系統上的 cpl 查詢，因為當使用 CPL NEWINQUIRE 時，主控台的效能會受到影響 \_ 。</span><span class="sxs-lookup"><span data-stu-id="42263-139">Your application should process only CPL\_INQUIRE on Windows 95, Microsoft Windows NT 4.0, and later systems since Control Panel performance suffers when CPL\_NEWINQUIRE is used.</span></span> <span data-ttu-id="42263-140">這是因為無法快取傳回的字串和圖示。</span><span class="sxs-lookup"><span data-stu-id="42263-140">This is because the returned strings and icons cannot be cached.</span></span> <span data-ttu-id="42263-141">傳回值會被忽略。</span><span class="sxs-lookup"><span data-stu-id="42263-141">The return value is ignored.</span></span> |
| [<span data-ttu-id="42263-142">**CPL \_ 選取**</span><span class="sxs-lookup"><span data-stu-id="42263-142">**CPL\_SELECT**</span></span>](cpl-select.md)           | <span data-ttu-id="42263-143">已過時。</span><span class="sxs-lookup"><span data-stu-id="42263-143">Obsolete.</span></span> <span data-ttu-id="42263-144">目前的 Windows 版本不會傳送此訊息。</span><span class="sxs-lookup"><span data-stu-id="42263-144">Current versions of Windows do not send this message.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| [<span data-ttu-id="42263-145">**CPL \_ STARTWPARMS**</span><span class="sxs-lookup"><span data-stu-id="42263-145">**CPL\_STARTWPARMS**</span></span>](cpl-startwparms.md) | <span data-ttu-id="42263-146">傳送以通知 [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) ，使用者已選擇與指定對話方塊相關聯的圖示。</span><span class="sxs-lookup"><span data-stu-id="42263-146">Sent to notify [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) that the user has chosen the icon associated with a given dialog box.</span></span> <span data-ttu-id="42263-147">**CPlApplet** 應該會顯示對應的對話方塊，並執行任何使用者指定的工作。</span><span class="sxs-lookup"><span data-stu-id="42263-147">**CPlApplet** should display the corresponding dialog box and carry out any user-specified tasks.</span></span> <span data-ttu-id="42263-148">這則訊息類似于 CPL \_ DBLCLK，但可能會有一些額外的資訊。</span><span class="sxs-lookup"><span data-stu-id="42263-148">This message is similar to CPL\_DBLCLK, but there might be some additional information.</span></span> <span data-ttu-id="42263-149">*LParam1* 參數是主控台專案編號，而 *lParam2* 則是可能需要的任何額外方向的 **LPCTSTR** 。</span><span class="sxs-lookup"><span data-stu-id="42263-149">The *lParam1* parameter is the Control Panel item number and *lParam2* is an **LPCTSTR** to any extra directions that might be necessary.</span></span> <span data-ttu-id="42263-150">如果處理此訊息，則傳回 **TRUE** ;否則 **為 FALSE**。</span><span class="sxs-lookup"><span data-stu-id="42263-150">Return **TRUE** if this message is handled; otherwise, **FALSE**.</span></span> <span data-ttu-id="42263-151">此訊息適用于 [5.00 版](versions.md) 和更新版本的 Shell32.dll。</span><span class="sxs-lookup"><span data-stu-id="42263-151">This message is valid for [version 5.00](versions.md) and later of Shell32.dll.</span></span>                                                                                         |
| [<span data-ttu-id="42263-152">**CPL \_ 停止**</span><span class="sxs-lookup"><span data-stu-id="42263-152">**CPL\_STOP**</span></span>](cpl-stop.md)               | <span data-ttu-id="42263-153">在 Windows 卸載主控台擴充功能之前，為 cpl 檔中的每個主控台專案傳送一次。</span><span class="sxs-lookup"><span data-stu-id="42263-153">Sent once for each Control Panel item in the .cpl file before Windows unloads the Control Panel extension.</span></span> <span data-ttu-id="42263-154">[**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) 應該釋放與 *lParam1* 中提供之專案編號相關聯的任何記憶體。</span><span class="sxs-lookup"><span data-stu-id="42263-154">[**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) should free any memory associated with the item number provided in *lParam1*.</span></span> <span data-ttu-id="42263-155">*LParam2* 參數是在 [**CPL \_ INQUIRE**](cpl-inquire.md)或 [**Cpl \_ NEWINQUIRE**](cpl-newinquire.md)訊息的 [**CPLINFO**](/windows/win32/api/cpl/ns-cpl-cplinfo)或 [**NEWCPLINFO**](/windows/win32/api/cpl/ns-cpl-newcplinfoa)結構中傳回的 **lpData** 指標。</span><span class="sxs-lookup"><span data-stu-id="42263-155">The *lParam2* parameter is **lpData** pointer returned in the [**CPLINFO**](/windows/win32/api/cpl/ns-cpl-cplinfo) or [**NEWCPLINFO**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) structure in the [**CPL\_INQUIRE**](cpl-inquire.md) or [**CPL\_NEWINQUIRE**](cpl-newinquire.md) message.</span></span> <span data-ttu-id="42263-156">傳回值會被忽略。</span><span class="sxs-lookup"><span data-stu-id="42263-156">The return value is ignored.</span></span>                                                                                                                                                                                                       |



 

## <a name="related-topics"></a><span data-ttu-id="42263-157">相關主題</span><span class="sxs-lookup"><span data-stu-id="42263-157">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="42263-158">主控台專案</span><span class="sxs-lookup"><span data-stu-id="42263-158">Control Panel Items</span></span>](control-panel-applications.md)
</dt> <dt>

[<span data-ttu-id="42263-159">使用者體驗指南</span><span class="sxs-lookup"><span data-stu-id="42263-159">User Experience Guidelines</span></span>](user-experience-guidelines.md)
</dt> <dt>

[<span data-ttu-id="42263-160">註冊主控台專案</span><span class="sxs-lookup"><span data-stu-id="42263-160">Registering Control Panel Items</span></span>](registering-control-panel-items.md)
</dt> <dt>

[<span data-ttu-id="42263-161">主控台訊息處理</span><span class="sxs-lookup"><span data-stu-id="42263-161">Control Panel Message Processing</span></span>](message-processing.md)
</dt> <dt>

[<span data-ttu-id="42263-162">執行主控台專案</span><span class="sxs-lookup"><span data-stu-id="42263-162">Executing Control Panel Items</span></span>](executing-control-panel-items.md)
</dt> <dt>

[<span data-ttu-id="42263-163">擴充系統主控台專案</span><span class="sxs-lookup"><span data-stu-id="42263-163">Extending System Control Panel Items</span></span>](extending-system-control-panel-items.md)
</dt> <dt>

[<span data-ttu-id="42263-164">指派主控台分類</span><span class="sxs-lookup"><span data-stu-id="42263-164">Assigning Control Panel Categories</span></span>](assigning-control-panel-categories.md)
</dt> <dt>

[<span data-ttu-id="42263-165">建立主控台專案的可搜尋工作連結</span><span class="sxs-lookup"><span data-stu-id="42263-165">Creating Searchable Task Links for a Control Panel Item</span></span>](creating-searchable-task-links.md)
</dt> <dt>

[<span data-ttu-id="42263-166">在 Windows Vista 下存取安全模式下的主控台</span><span class="sxs-lookup"><span data-stu-id="42263-166">Accessing the Control Panel in Safe Mode under Windows Vista</span></span>](accessing-the-cp-in-safe-mode-under-vista.md)
</dt> </dl>

 

 
