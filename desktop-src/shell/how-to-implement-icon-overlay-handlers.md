---
description: 圖示重迭處理常式是以同進程元件物件模型 (COM) 物件，這些物件會實作為 Dll。
ms.assetid: ADF27BFD-CC96-43F9-9EBB-DEBE0DEA7B92
title: 如何實行圖示重迭處理常式
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e22c1057f65c50b31c6627846ec77103827a0283
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104973140"
---
# <a name="how-to-implement-icon-overlay-handlers"></a><span data-ttu-id="7fb4f-103">如何實行圖示重迭處理常式</span><span class="sxs-lookup"><span data-stu-id="7fb4f-103">How to Implement Icon Overlay Handlers</span></span>

<span data-ttu-id="7fb4f-104">圖示重迭處理常式是以同進程元件物件模型 (COM) 物件，這些物件會實作為 Dll。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-104">Icon overlay handlers are in-process Component Object Model (COM) objects, implemented as DLLs.</span></span> <span data-ttu-id="7fb4f-105">除了 [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown)： [**IShellIconOverlayIdentifier**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishelliconoverlayidentifier)之外，也會匯出一個介面。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-105">They export one interface in addition to [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown): [**IShellIconOverlayIdentifier**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishelliconoverlayidentifier).</span></span> <span data-ttu-id="7fb4f-106">這個介面有三個方法： [**IShellIconOverlayIdentifier：： GetOverlayInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getoverlayinfo)、 [**IShellIconOverlayIdentifier：： GetPriority**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getpriority)和 [**IShellIconOverlayIdentifier：： IsMemberOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-ismemberof)。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-106">This interface has three methods: [**IShellIconOverlayIdentifier::GetOverlayInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getoverlayinfo), [**IShellIconOverlayIdentifier::GetPriority**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getpriority), and [**IShellIconOverlayIdentifier::IsMemberOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-ismemberof).</span></span>

## <a name="instructions"></a><span data-ttu-id="7fb4f-107">指示</span><span class="sxs-lookup"><span data-stu-id="7fb4f-107">Instructions</span></span>

### <a name="step-1-implementing-getoverlayinfo"></a><span data-ttu-id="7fb4f-108">步驟1：執行 GetOverlayInfo</span><span class="sxs-lookup"><span data-stu-id="7fb4f-108">Step 1: Implementing GetOverlayInfo</span></span>

<span data-ttu-id="7fb4f-109">[**GetOverlayInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getoverlayinfo)方法會在初始化期間第一次呼叫。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-109">The [**GetOverlayInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getoverlayinfo) method is first called during initialization.</span></span> <span data-ttu-id="7fb4f-110">方法會傳回包含圖示重迭影像之檔案的完整路徑，以及檔案內以零為基底的索引。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-110">The method returns the fully qualified path of the file that contains the icon overlay image, and its zero-based index within the file.</span></span> <span data-ttu-id="7fb4f-111">然後，Shell 會將影像加入至系統映射清單。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-111">The Shell then adds the image to the system image list.</span></span> <span data-ttu-id="7fb4f-112">圖示重迭可以包含在任何標準檔案類型中，包括 .exe、.dll 和 .ico。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-112">Icon overlays can be contained in any of the standard file types, including .exe, .dll, and .ico.</span></span>

<span data-ttu-id="7fb4f-113">初始化完成之後，當 Shell 需要顯示處理常式的圖示重迭時，就會呼叫 [**GetOverlayInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getoverlayinfo) 。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-113">After initialization is complete, the Shell calls [**GetOverlayInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getoverlayinfo) when it needs to display the handler's icon overlay.</span></span> <span data-ttu-id="7fb4f-114">方法應該會傳回在初始化期間所執行的相同檔案名和索引。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-114">The method should return the same file name and index that it did during initialization.</span></span> <span data-ttu-id="7fb4f-115">雖然 Shell 使用系統映射清單中快取的影像，而不是從檔案載入影像，但仍會以檔案名和索引來識別圖示重迭。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-115">Although the Shell uses the image that is cached in the system image list rather than loading the image from the file, an icon overlay is still identified by its file name and index.</span></span>

### <a name="step-2-implementing-getpriority"></a><span data-ttu-id="7fb4f-116">步驟2：執行 GetPriority</span><span class="sxs-lookup"><span data-stu-id="7fb4f-116">Step 2: Implementing GetPriority</span></span>

<span data-ttu-id="7fb4f-117">[**GetPriority**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getpriority)方法只會在初始化期間呼叫。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-117">The [**GetPriority**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getpriority) method is called only during initialization.</span></span> <span data-ttu-id="7fb4f-118">它會將優先權值指派給處理常式的圖示重迭。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-118">It assigns a priority value to the handler's icon overlay.</span></span> <span data-ttu-id="7fb4f-119">值的範圍可以從零到100，其中100是最低優先權。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-119">The value can range from zero to 100, where 100 is the lowest priority.</span></span> <span data-ttu-id="7fb4f-120">這個優先權值的目的是要協助 Shell 解決針對單一物件指定多個圖示重迭時所發生的衝突。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-120">The purpose of this priority value is to help the Shell resolve the conflict that arises when multiple icon overlays are specified for a single object.</span></span> <span data-ttu-id="7fb4f-121">Shell 會先使用一組內部規則來判斷最高優先順序的圖示重迭。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-121">The Shell first uses an internal set of rules to determine the highest-priority icon overlay.</span></span> <span data-ttu-id="7fb4f-122">如果這些規則無法解決衝突，則依 **GetPriority** 指派給圖示重迭的值會決定優先順序。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-122">If these rules do not resolve the conflict, the values assigned to the icon overlays by **GetPriority** determine priority.</span></span>

<span data-ttu-id="7fb4f-123">[**GetPriority**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getpriority)所設定的優先順序值不是解決不相關之圖示重迭處理常式之間衝突的可靠方法。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-123">The priority value set by [**GetPriority**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getpriority) is not a reliable way to resolve conflicts between unrelated icon overlay handlers.</span></span> <span data-ttu-id="7fb4f-124">您的處理常式無法判斷其他處理常式所使用的優先順序值。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-124">There is no way for your handler to determine what priority values other handlers are using.</span></span> <span data-ttu-id="7fb4f-125">一般來說，您應該將值設為零。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-125">Normally, you should set the value to zero.</span></span> <span data-ttu-id="7fb4f-126">但是，當您已完成可要求相同物件之圖示重迭圖示的兩個或多個圖示重迭處理常式時，優先順序值會很有用。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-126">However, the priority value is useful when you have implemented two or more icon overlay handlers that can request icon overlay icons for the same object.</span></span> <span data-ttu-id="7fb4f-127">藉由適當地設定優先順序值，您可以指定所要求的圖示重迭將顯示哪些。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-127">By setting the priority values appropriately, you can specify which of the requested icon overlays will be displayed.</span></span>

### <a name="step-3-implementing-ismemberof"></a><span data-ttu-id="7fb4f-128">步驟3：執行 IsMemberOf</span><span class="sxs-lookup"><span data-stu-id="7fb4f-128">Step 3: Implementing IsMemberOf</span></span>

<span data-ttu-id="7fb4f-129">Shell 會呼叫 [**IsMemberOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-ismemberof) 方法，以判斷是否應該顯示特定物件的處理常式圖示重迭。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-129">The Shell calls the [**IsMemberOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-ismemberof) method to determine whether it should display a handler's icon overlay for a particular object.</span></span> <span data-ttu-id="7fb4f-130">Shell 會將物件的名稱傳遞給方法，以指定物件。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-130">The Shell specifies the object by passing its name to the method.</span></span> <span data-ttu-id="7fb4f-131">如果處理常式想要顯示其圖示重迭， **IsMemberOf** 會傳回 S \_ OK。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-131">If a handler wants to have its icon overlay displayed, **IsMemberOf** returns S\_OK.</span></span> <span data-ttu-id="7fb4f-132">如果沒有，則會傳回 \_ FALSE。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-132">If not, it returns S\_FALSE.</span></span>

<span data-ttu-id="7fb4f-133">圖示重迭處理常式通常用於處理特定的檔案群組。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-133">Icon overlay handlers are normally intended to work with a particular group of files.</span></span> <span data-ttu-id="7fb4f-134">一般範例是以特定的副檔名來識別的 [檔案類型](fa-file-types.md)。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-134">A typical example is a [file type](fa-file-types.md), identified by a specific file name extension.</span></span> <span data-ttu-id="7fb4f-135">圖示重迭處理常式可以要求所有檔案類型檔案的圖示重迭。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-135">An icon overlay handler can request an icon overlay for all files of the file type.</span></span> <span data-ttu-id="7fb4f-136">某些處理常式只有在檔案類型的檔案處於特定狀態時，才會要求圖示重迭。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-136">Some handlers request an icon overlay only if a file of the file type is in a particular state.</span></span> <span data-ttu-id="7fb4f-137">不過，圖示重迭處理常式可自由要求其所選物件的圖示重迭。</span><span class="sxs-lookup"><span data-stu-id="7fb4f-137">However, icon overlay handlers are free to request their icon overlay for any object that they choose.</span></span>

 

 
