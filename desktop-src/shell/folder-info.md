---
description: 取得資料夾的識別碼一節討論了兩種取得命名空間物件指標的方法， (PIDL) 的專案識別碼清單。
ms.assetid: c99a2f6c-3144-41ec-ad97-59a30bfec9ab
title: 取得資料夾內容的相關資訊
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f7eb26e9df28af4811e74f2878eebb7af9d5c92a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104991066"
---
# <a name="getting-information-about-the-contents-of-a-folder"></a><span data-ttu-id="7b4a3-103">取得資料夾內容的相關資訊</span><span class="sxs-lookup"><span data-stu-id="7b4a3-103">Getting Information About the Contents of a Folder</span></span>

<span data-ttu-id="7b4a3-104">[取得資料夾的](folder-id.md)識別碼一節討論了兩種取得命名空間物件指標的方法， (PIDL) 的專案識別碼清單。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-104">The [Getting a Folder's ID](folder-id.md) section discussed two approaches to getting a namespace object's pointer to an item identifier list (PIDL).</span></span> <span data-ttu-id="7b4a3-105">其中一個明顯的問題是： PIDL 之後，您可以用它來做什麼？</span><span class="sxs-lookup"><span data-stu-id="7b4a3-105">One obvious question is: Once you have a PIDL, what can you do with it?</span></span> <span data-ttu-id="7b4a3-106">相關的問題是：如果兩種方法都可行，或適用于您的應用程式，該怎麼辦？</span><span class="sxs-lookup"><span data-stu-id="7b4a3-106">A related question is: What if neither approach works, or is suitable for your application?</span></span> <span data-ttu-id="7b4a3-107">這兩個問題的答案都需要進一步瞭解命名空間的執行方式。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-107">The answer to both questions requires taking a closer look at how the namespace is implemented.</span></span> <span data-ttu-id="7b4a3-108">索引鍵是 [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) 介面。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-108">The key is the [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface.</span></span>

-   [<span data-ttu-id="7b4a3-109">使用 IShellFolder 介面</span><span class="sxs-lookup"><span data-stu-id="7b4a3-109">Using the IShellFolder Interface</span></span>](#using-the-ishellfolder-interface)
-   [<span data-ttu-id="7b4a3-110">列舉資料夾的內容</span><span class="sxs-lookup"><span data-stu-id="7b4a3-110">Enumerating the Contents of a Folder</span></span>](#enumerating-the-contents-of-a-folder)
-   [<span data-ttu-id="7b4a3-111">判斷顯示名稱和其他屬性</span><span class="sxs-lookup"><span data-stu-id="7b4a3-111">Determining Display Names and Other Properties</span></span>](#determining-display-names-and-other-properties)
-   [<span data-ttu-id="7b4a3-112">取得子資料夾 IShellFolder 介面的指標</span><span class="sxs-lookup"><span data-stu-id="7b4a3-112">Getting a Pointer to a Subfolder's IShellFolder Interface</span></span>](#getting-a-pointer-to-a-subfolders-ishellfolder-interface)
-   [<span data-ttu-id="7b4a3-113">判斷物件的父資料夾</span><span class="sxs-lookup"><span data-stu-id="7b4a3-113">Determining an Object's Parent Folder</span></span>](#determining-an-objects-parent-folder)

## <a name="using-the-ishellfolder-interface"></a><span data-ttu-id="7b4a3-114">使用 IShellFolder 介面</span><span class="sxs-lookup"><span data-stu-id="7b4a3-114">Using the IShellFolder Interface</span></span>

<span data-ttu-id="7b4a3-115">稍早在本檔中，命名空間資料夾稱為物件。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-115">Earlier in this documentation, namespace folders were referred to as objects.</span></span> <span data-ttu-id="7b4a3-116">雖然在該時間點使用的是很好用的詞彙，但其實也是絕對的意義。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-116">Although, at that point, the term was used in a loose sense, it is actually true in a strict sense as well.</span></span> <span data-ttu-id="7b4a3-117">每個命名空間資料夾都是由元件物件模型代表 (COM) 物件。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-117">Every namespace folder is represented by a Component Object Model (COM) object.</span></span> <span data-ttu-id="7b4a3-118">每個資料夾物件都會公開一些介面，這些介面可用於各種不同的工作。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-118">Each folder object exposes a number of interfaces that can be used for a wide variety of tasks.</span></span> <span data-ttu-id="7b4a3-119">某些選用介面可能無法由所有資料夾公開。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-119">Some interfaces that are optional may not be exposed by all folders.</span></span> <span data-ttu-id="7b4a3-120">不過，所有資料夾都必須公開 [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder)的基本介面。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-120">However, all folders must expose the fundamental interface, [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder).</span></span>

<span data-ttu-id="7b4a3-121">使用資料夾物件的第一個步驟是取得其 [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) 介面的指標。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-121">The first step in using a folder object is to retrieve a pointer to its [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface.</span></span> <span data-ttu-id="7b4a3-122">除了提供物件其他介面的存取權之外， **IShellFolder** 也會公開一組方法來處理許多常見的工作，本節會討論其中的幾個。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-122">In addition to providing access to the object's other interfaces, **IShellFolder** exposes a group of methods that handle a number of common tasks, several of which are discussed in this section.</span></span>

<span data-ttu-id="7b4a3-123">若要取得命名空間物件之 [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) 介面的指標，您必須先呼叫 [**SHGetDesktopFolder**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetdesktopfolder)。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-123">To retrieve a pointer to a namespace object's [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface, you must first call [**SHGetDesktopFolder**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetdesktopfolder).</span></span> <span data-ttu-id="7b4a3-124">此函式會傳回命名空間根目錄（即桌面） **IShellFolder** 介面的指標。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-124">This function returns a pointer to the **IShellFolder** interface of the namespace root, the desktop.</span></span> <span data-ttu-id="7b4a3-125">當您擁有桌面的 **IShellFolder** 介面之後，有各種不同的方式可繼續進行。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-125">Once you have the desktop's **IShellFolder** interface, there a variety of ways to proceed.</span></span>

<span data-ttu-id="7b4a3-126">如果您已經有感興趣的資料夾 PIDL （例如，藉由呼叫 [**SHGetFolderLocation**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetfolderlocation)），您可以藉由呼叫桌面的 [**IShellFolder：： BindToObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-bindtoobject)方法來取出其 [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder)介面。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-126">If you already have the PIDL of the folder you are interested in—for instance, by calling [**SHGetFolderLocation**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetfolderlocation)—you can retrieve its [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface by calling the desktop's [**IShellFolder::BindToObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-bindtoobject) method.</span></span> <span data-ttu-id="7b4a3-127">如果您有檔案系統物件的路徑，您必須先呼叫桌面的 [**IShellFolder：:P arsedisplayname**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-parsedisplayname) 方法，然後呼叫 **IShellFolder：： BindToObject**，以取得其 PIDL。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-127">If you have the path of a file system object, you must first obtain its PIDL by calling the desktop's [**IShellFolder::ParseDisplayName**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-parsedisplayname) method and then call **IShellFolder::BindToObject**.</span></span> <span data-ttu-id="7b4a3-128">如果這兩種方法都不適用，您可以使用其他 **IShellFolder** 方法來流覽命名空間。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-128">If neither of these approaches is applicable, you can use other **IShellFolder** methods to navigate the namespace.</span></span> <span data-ttu-id="7b4a3-129">如需詳細資訊，請參閱 [流覽命名空間](navigate.md)。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-129">For more information, see [Navigating the Namespace](navigate.md).</span></span>

## <a name="enumerating-the-contents-of-a-folder"></a><span data-ttu-id="7b4a3-130">列舉資料夾的內容</span><span class="sxs-lookup"><span data-stu-id="7b4a3-130">Enumerating the Contents of a Folder</span></span>

<span data-ttu-id="7b4a3-131">您通常會想要對資料夾執行的第一件事，就是了解它所包含的內容。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-131">The first thing you usually want to do with a folder is to find out what it contains.</span></span> <span data-ttu-id="7b4a3-132">您必須先呼叫資料夾的 [**IShellFolder：： EnumObjects**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-enumobjects) 方法。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-132">You must first call the folder's [**IShellFolder::EnumObjects**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-enumobjects) method.</span></span> <span data-ttu-id="7b4a3-133">此資料夾會建立標準的 OLE 列舉物件，並傳回其 [**IEnumIDList**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ienumidlist) 介面。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-133">The folder will create a standard OLE enumeration object and return its [**IEnumIDList**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ienumidlist) interface.</span></span> <span data-ttu-id="7b4a3-134">此介面會公開四個標準方法（[**Clone**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-clone)、 [**Next**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-next)、 [**Reset**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-reset)和 [**Skip**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-skip)），可用來列舉資料夾的內容。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-134">This interface exposes four standard methods—[**Clone**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-clone), [**Next**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-next), [**Reset**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-reset), and [**Skip**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-skip)—that can be used to enumerate the contents of the folder.</span></span>

<span data-ttu-id="7b4a3-135">列舉資料夾內容的基本程式如下：</span><span class="sxs-lookup"><span data-stu-id="7b4a3-135">The basic procedure for enumerating a folder's contents is:</span></span>

1.  <span data-ttu-id="7b4a3-136">呼叫 [**IShellFolder：： EnumObjects**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-enumobjects) 方法資料夾，以取得列舉物件之 [**IEnumIDList**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ienumidlist) 介面的指標。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-136">Call the folders [**IShellFolder::EnumObjects**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-enumobjects) method to retrieve a pointer to an enumeration object's [**IEnumIDList**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ienumidlist) interface.</span></span>
2.  <span data-ttu-id="7b4a3-137">將未配置的 PIDL 傳遞至 [**IEnumIDList：： Next**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-next)。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-137">Pass an unallocated PIDL to [**IEnumIDList::Next**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-next).</span></span> <span data-ttu-id="7b4a3-138">**接下來** 會負責配置 PIDL，但應用程式必須在不再需要時將其解除配置。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-138">**Next** takes care of allocating the PIDL, but the application must deallocate it when it is no longer needed.</span></span> <span data-ttu-id="7b4a3-139">當 **下一次** 傳回時，PIDL 只會包含物件的專案識別碼和終止的 **Null** 字元。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-139">When **Next** returns, the PIDL will contain just the object's item ID and the terminating **NULL** characters.</span></span> <span data-ttu-id="7b4a3-140">換句話說，它是相對於資料夾的單一層級 PIDL，而不是完整的 PIDL。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-140">In other words, it is a single-level PIDL, relative to the folder, not a fully qualified PIDL.</span></span>
3.  <span data-ttu-id="7b4a3-141">重複步驟2，直到 [**[下一步]**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-next) 傳回 \_ FALSE，表示所有專案都已列舉。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-141">Repeat step 2 until [**Next**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-next) returns S\_FALSE to indicate that all items have been enumerated.</span></span>
4.  <span data-ttu-id="7b4a3-142">呼叫 **IEnumIDList：： release** 以釋放列舉物件。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-142">Call **IEnumIDList::Release** to release the enumeration object.</span></span>

> [!Note]  
> <span data-ttu-id="7b4a3-143">請務必追蹤您是否正在使用完整或相對 PIDL。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-143">It is important to keep track of whether you are working with a full or relative PIDL.</span></span> <span data-ttu-id="7b4a3-144">某些函式和方法會接受，但其他函式和方法只會接受其中一種。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-144">Some functions and methods will accept either, but others will only take one or the other.</span></span>

 

<span data-ttu-id="7b4a3-145">如果您需要對資料夾進行重複的列舉，則其餘三個 [**IEnumIDList**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ienumidlist) 方法 ([**重設**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-reset)、 [**略過**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-skip)和 [**複製**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-clone)) 會很有用。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-145">The remaining three [**IEnumIDList**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ienumidlist) methods ([**Reset**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-reset), [**Skip**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-skip), and [**Clone**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-clone)) are useful if you need to do repeated enumerations of the folder.</span></span> <span data-ttu-id="7b4a3-146">它們可讓您重設列舉、略過一或多個物件，以及建立列舉物件的複本以保留其狀態。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-146">They allow you to reset the enumeration, skip one or more objects, and make a copy of the enumeration object to preserve its state.</span></span>

## <a name="determining-display-names-and-other-properties"></a><span data-ttu-id="7b4a3-147">判斷顯示名稱和其他屬性</span><span class="sxs-lookup"><span data-stu-id="7b4a3-147">Determining Display Names and Other Properties</span></span>

<span data-ttu-id="7b4a3-148">列舉出資料夾所包含的所有 Pidl 之後，您就可以找到它們所代表的物件類型。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-148">Once you have enumerated all the PIDLs that are contained by a folder, you can find out what sort of objects they represent.</span></span> <span data-ttu-id="7b4a3-149">[**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder)介面提供許多有用的方法，這裡有兩個討論。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-149">The [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface provides a number of useful methods, two of which are discussed here.</span></span> <span data-ttu-id="7b4a3-150">其他的 **IShellFolder** 方法和其他 Shell 資料夾介面稍後會討論。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-150">Other **IShellFolder** methods and other Shell folder interfaces are discussed later.</span></span>

<span data-ttu-id="7b4a3-151">其中一個最有用的屬性是物件的顯示名稱。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-151">One of the most useful properties is the object's display name.</span></span> <span data-ttu-id="7b4a3-152">若要取得物件的顯示名稱，請將其 PIDL 傳遞至 [**IShellFolder：： GetDisplayNameOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof)。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-152">To retrieve the display name of an object, pass its PIDL to [**IShellFolder::GetDisplayNameOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof).</span></span> <span data-ttu-id="7b4a3-153">雖然物件可以位於命名空間中父資料夾的任何位置，但其 PIDL 必須是資料夾的相對路徑。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-153">Although the object can be located anywhere below the parent folder in the namespace, its PIDL must be relative to the folder.</span></span>

<span data-ttu-id="7b4a3-154">[**IShellFolder：： GetDisplayNameOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof) 會傳回 [**STRRET**](/windows/desktop/api/Shtypes/ns-shtypes-strret) 結構一部分的顯示名稱。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-154">[**IShellFolder::GetDisplayNameOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof) returns the display name as part of of a [**STRRET**](/windows/desktop/api/Shtypes/ns-shtypes-strret) structure.</span></span> <span data-ttu-id="7b4a3-155">由於從 **STRRET** 結構中解壓縮顯示名稱可能有點複雜，因此 Shell 會提供兩個函式來為您 [**StrRetToStr**](/windows/desktop/api/Shlwapi/nf-shlwapi-strrettostra) 和 [**StrRetToBuf**](/windows/desktop/api/Shlwapi/nf-shlwapi-strrettobufa)作業。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-155">Because extracting the display name from a **STRRET** structure can be a little tricky, the Shell provides two functions that do the job for you, [**StrRetToStr**](/windows/desktop/api/Shlwapi/nf-shlwapi-strrettostra) and [**StrRetToBuf**](/windows/desktop/api/Shlwapi/nf-shlwapi-strrettobufa).</span></span> <span data-ttu-id="7b4a3-156">這兩個函式會採用 **STRRET** 結構，並以一般字串的形式傳回顯示名稱。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-156">Both functions take a **STRRET** structure, and return the display name as a normal string.</span></span> <span data-ttu-id="7b4a3-157">它們的差異只在於字串的配置方式。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-157">They differ only in how the string is allocated.</span></span>

<span data-ttu-id="7b4a3-158">除了其顯示名稱之外，物件可以有數個屬性，例如，它是資料夾或是否可以移動。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-158">In addition to its display name, an object can have a number of attributes, such as whether it is a folder or whether it can be moved.</span></span> <span data-ttu-id="7b4a3-159">您可以藉由將物件的 PIDL 傳遞至 [**IShellFolder：： GetAttributesOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getattributesof)，來取得物件的屬性。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-159">You can retrieve an object's attributes by passing its PIDL to [**IShellFolder::GetAttributesOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getattributesof).</span></span> <span data-ttu-id="7b4a3-160">屬性的完整清單相當大，因此您應該會看到詳細資料的參考。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-160">The complete list of attributes is quite large, so you should see the reference for details.</span></span> <span data-ttu-id="7b4a3-161">請注意，您傳遞至 **GetAttributesOf** 的 PIDL 必須是單一層級。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-161">Note that the PIDL that you pass to **GetAttributesOf** must be single-level.</span></span> <span data-ttu-id="7b4a3-162">尤其是， **IShellFolder：： GetAttributesOf** 會接受 [**IEnumIDList：： Next**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-next)所傳回的 pidl。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-162">In particular, **IShellFolder::GetAttributesOf** will accept the PIDLs returned by [**IEnumIDList::Next**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-next).</span></span> <span data-ttu-id="7b4a3-163">您可以傳入 Pidl 的陣列，而 **GetAttributesOf** 會傳回陣列中的所有物件都有共同的屬性。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-163">You can pass in an array of PIDLs, and **GetAttributesOf** will return those attributes that all objects in the array have in common.</span></span>

<span data-ttu-id="7b4a3-164">如果您有物件的完整路徑或 PIDL， [**SHGetFileInfo**](/windows/desktop/api/Shellapi/nf-shellapi-shgetfileinfoa) 會提供簡單的方法，讓您取得足以滿足許多用途之物件的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-164">If you have an object's fully qualified path or PIDL, [**SHGetFileInfo**](/windows/desktop/api/Shellapi/nf-shellapi-shgetfileinfoa) provides a simple way to retrieve information about an object that is sufficient for many purposes.</span></span> <span data-ttu-id="7b4a3-165">**SHGetFileInfo** 採用完整路徑或 PIDL，並傳回物件的各種資訊，包括：</span><span class="sxs-lookup"><span data-stu-id="7b4a3-165">**SHGetFileInfo** takes a fully qualified path or PIDL, and returns a variety of information about the object including:</span></span>

-   <span data-ttu-id="7b4a3-166">物件的顯示名稱</span><span class="sxs-lookup"><span data-stu-id="7b4a3-166">The object's display name</span></span>
-   <span data-ttu-id="7b4a3-167">物件的屬性</span><span class="sxs-lookup"><span data-stu-id="7b4a3-167">The object's attributes</span></span>
-   <span data-ttu-id="7b4a3-168">物件圖示的控制碼</span><span class="sxs-lookup"><span data-stu-id="7b4a3-168">Handles to the object's icons</span></span>
-   <span data-ttu-id="7b4a3-169">系統映射清單的控制碼</span><span class="sxs-lookup"><span data-stu-id="7b4a3-169">A handle to the system image list</span></span>
-   <span data-ttu-id="7b4a3-170">包含物件圖示的檔案路徑</span><span class="sxs-lookup"><span data-stu-id="7b4a3-170">The path of the file containing the object's icon</span></span>

## <a name="getting-a-pointer-to-a-subfolders-ishellfolder-interface"></a><span data-ttu-id="7b4a3-171">取得子資料夾 IShellFolder 介面的指標</span><span class="sxs-lookup"><span data-stu-id="7b4a3-171">Getting a Pointer to a Subfolder's IShellFolder Interface</span></span>

<span data-ttu-id="7b4a3-172">您可以藉由呼叫 [**IShellFolder：： GetAttributesOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getattributesof) ，並檢查是否 \_ 已設定 SFGAO 資料夾旗標，來判斷您的資料夾是否包含任何子資料夾。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-172">You can determine whether your folder contains any subfolders by calling [**IShellFolder::GetAttributesOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getattributesof) and checking to see if the SFGAO\_FOLDER flag is set.</span></span> <span data-ttu-id="7b4a3-173">如果物件是資料夾，您可以系結至它，它會為您提供其 [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) 介面的指標。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-173">If an object is a folder, you can bind to it, which provides you with a pointer to its [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface.</span></span>

<span data-ttu-id="7b4a3-174">若要系結至子資料夾，請呼叫父資料夾的 [**IShellFolder：： BindToObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-bindtoobject) 方法。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-174">To bind to a subfolder, call the parent folder's [**IShellFolder::BindToObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-bindtoobject) method.</span></span> <span data-ttu-id="7b4a3-175">這個方法會使用子資料夾的 PIDL，並將指標傳回至其 [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) 介面。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-175">This method takes the subfolder's PIDL and returns a pointer to its [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface.</span></span> <span data-ttu-id="7b4a3-176">有了這個指標之後，您就可以使用 **IShellFolder** 方法來列舉子資料夾內容、判斷它們的屬性等等。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-176">Once you have this pointer, you can use the **IShellFolder** methods to enumerate the subfolders contents, determine their properties, and so on.</span></span>

## <a name="determining-an-objects-parent-folder"></a><span data-ttu-id="7b4a3-177">判斷物件的父資料夾</span><span class="sxs-lookup"><span data-stu-id="7b4a3-177">Determining an Object's Parent Folder</span></span>

<span data-ttu-id="7b4a3-178">如果您有物件的 PIDL，您可能需要其父資料夾所公開的其中一個介面的控制碼。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-178">If you have an object's PIDL, you may need a handle to one of the interfaces exposed by its parent folder.</span></span> <span data-ttu-id="7b4a3-179">例如，如果您想要使用 [**IShellFolder：： GetDisplayNameOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof)來判斷與 PIDL 相關聯的顯示名稱，就必須先取得物件父系的 [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) 介面。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-179">For example, if you want to determine the display name associated with a PIDL by using [**IShellFolder::GetDisplayNameOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof), you must first retrieve the [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface of the object's parent.</span></span> <span data-ttu-id="7b4a3-180">您可以使用前幾節所討論的技術來完成這項作業。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-180">It is possible to do this with the techniques discussed in the previous sections.</span></span> <span data-ttu-id="7b4a3-181">不過，更簡單的方法是使用 Shell 函數 [**SHBindToParent**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shbindtoparent)。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-181">However, a much simpler approach is to use the Shell function, [**SHBindToParent**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shbindtoparent).</span></span> <span data-ttu-id="7b4a3-182">此函式會採用物件的完整 PIDL，並傳回父資料夾上的指定介面指標。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-182">This function takes the fully qualified PIDL of an object and returns a specified interface pointer on the parent folder.</span></span> <span data-ttu-id="7b4a3-183">此外，它也會傳回專案的單一層級 PIDL，以便在 [**IShellFolder：： GetAttributesOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getattributesof)之類的方法中使用。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-183">Optionally, it also returns the item's single-level PIDL for use in methods such as [**IShellFolder::GetAttributesOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getattributesof).</span></span>

<span data-ttu-id="7b4a3-184">下列範例主控台應用程式會抓取 System 特殊資料夾的 PIDL，並傳回其顯示名稱。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-184">The following sample console application retrieves the PIDL of the System special folder and returns its display name.</span></span>


```
#include <shlobj.h>
#include <shlwapi.h>
#include <iostream.h>
#include <objbase.h>

int main()
{
    IShellFolder *psfParent = NULL;
    LPITEMIDLIST pidlSystem = NULL;
    LPCITEMIDLIST pidlRelative = NULL;
    STRRET strDispName;
    TCHAR szDisplayName[MAX_PATH];
    HRESULT hr;

    hr = SHGetFolderLocation(NULL, CSIDL_SYSTEM, NULL, NULL, &pidlSystem);

    hr = SHBindToParent(pidlSystem, IID_IShellFolder, (void **) &psfParent, &pidlRelative);

    if(SUCCEEDED(hr))
    {
        hr = psfParent->GetDisplayNameOf(pidlRelative, SHGDN_NORMAL, &strDispName);
        hr = StrRetToBuf(&strDispName, pidlSystem, szDisplayName, sizeof(szDisplayName));
        cout << "SHGDN_NORMAL - " <<szDisplayName << '\n';
    }

    psfParent->Release();
    CoTaskMemFree(pidlSystem);

    return 0;
}
```



<span data-ttu-id="7b4a3-185">應用程式會先使用 [**SHGetFolderLocation**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetfolderlocation) 來取出系統資料夾的 PIDL。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-185">The application first uses [**SHGetFolderLocation**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetfolderlocation) to retrieve the System folder's PIDL.</span></span> <span data-ttu-id="7b4a3-186">然後，它會呼叫 [**SHBindToParent**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shbindtoparent)，它會傳回父資料夾的 [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) 介面的指標，以及相對於其父系的系統資料夾 PIDL。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-186">It then calls [**SHBindToParent**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shbindtoparent), which returns a pointer to the parent folder's [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface, and the System folder's PIDL relative to its parent.</span></span> <span data-ttu-id="7b4a3-187">然後，它會使用上層資料夾的 [**IShellFolder：： GetDisplayNameOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof) 方法來取出系統資料夾的顯示名稱。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-187">It then uses the parent folder's [**IShellFolder::GetDisplayNameOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof) method to retrieve the display name of the System folder.</span></span> <span data-ttu-id="7b4a3-188">由於 **GetDisplayNameOf** 會傳回 [**STRRET**](/windows/desktop/api/Shtypes/ns-shtypes-strret) 結構，因此會使用 [**StrRetToBuf**](/windows/desktop/api/Shlwapi/nf-shlwapi-strrettobufa) 將顯示名稱轉換成一般字串。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-188">Because **GetDisplayNameOf** returns a [**STRRET**](/windows/desktop/api/Shtypes/ns-shtypes-strret) structure, [**StrRetToBuf**](/windows/desktop/api/Shlwapi/nf-shlwapi-strrettobufa) is used to convert the display name into a normal string.</span></span> <span data-ttu-id="7b4a3-189">顯示名稱之後，會釋放介面指標並釋放系統 PIDL。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-189">After displaying the display name, the interface pointers are released and the System PIDL freed.</span></span> <span data-ttu-id="7b4a3-190">請注意，您不能釋放 **SHBindToParent** 所傳回的相對 PIDL。</span><span class="sxs-lookup"><span data-stu-id="7b4a3-190">Note that you must not free the relative PIDL returned by **SHBindToParent**.</span></span>

 

 
