---
description: 您可以使用登錄專案和 .ini 檔案來擴充 Shell 的功能。
ms.assetid: 74a81e4f-7357-4901-a118-ba44e8892f25
title: 建立 Shell 擴充功能處理常式
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 991f3c1684b7491e2ad29fae29f48164ffdd47cb
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104991574"
---
# <a name="creating-shell-extension-handlers"></a><span data-ttu-id="92f56-103">建立 Shell 擴充功能處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-103">Creating Shell Extension Handlers</span></span>

<span data-ttu-id="92f56-104">您可以使用登錄專案和 .ini 檔案來擴充 Shell 的功能。</span><span class="sxs-lookup"><span data-stu-id="92f56-104">The capabilities of the Shell can be extended with registry entries and .ini files.</span></span> <span data-ttu-id="92f56-105">雖然這種擴充 Shell 的方法很簡單，且適用于許多用途，但有限。</span><span class="sxs-lookup"><span data-stu-id="92f56-105">While this approach to extending the Shell is simple, and adequate for many purposes, it is limited.</span></span> <span data-ttu-id="92f56-106">例如，如果您使用登錄來指定檔案類型的自訂圖示，就會針對該類型的每個檔案顯示相同的圖示。</span><span class="sxs-lookup"><span data-stu-id="92f56-106">For example, if you use the registry to specify a custom icon for a file type, the same icon will appear for every file of that type.</span></span> <span data-ttu-id="92f56-107">使用登錄延伸 Shell 不允許您變更相同類型之不同檔案的圖示。</span><span class="sxs-lookup"><span data-stu-id="92f56-107">Extending the Shell with the registry does not allow you to vary the icon for different files of the same type.</span></span> <span data-ttu-id="92f56-108">Shell 的其他層面（例如，在檔案以滑鼠右鍵按一下時可顯示的 [ **屬性** ] 屬性工作表），無法透過登錄來修改。</span><span class="sxs-lookup"><span data-stu-id="92f56-108">Other aspects of the Shell, such as the **Properties** property sheet that can be displayed when a file is right-clicked, cannot be modified at all with the registry.</span></span>

<span data-ttu-id="92f56-109">擴充 Shell 的一個更強大且靈活的方法，就是執行 *shell 擴充處理常式*。</span><span class="sxs-lookup"><span data-stu-id="92f56-109">A more powerful and flexible approach to extending the Shell is to implement *shell extension handlers*.</span></span> <span data-ttu-id="92f56-110">您可以針對 Shell 可執行檔各種動作，執行這些處理常式。</span><span class="sxs-lookup"><span data-stu-id="92f56-110">These handlers can be implemented for a variety of actions that the Shell can perform.</span></span> <span data-ttu-id="92f56-111">在採取動作之前，Shell 會查詢延伸模組處理常式，讓它有機會修改動作。</span><span class="sxs-lookup"><span data-stu-id="92f56-111">Before taking the action, the Shell queries the extension handler, giving it the opportunity to modify the action.</span></span> <span data-ttu-id="92f56-112">常見的範例是快捷方式功能表延伸模組處理常式。</span><span class="sxs-lookup"><span data-stu-id="92f56-112">A common example is a shortcut menu extension handler.</span></span> <span data-ttu-id="92f56-113">如果是針對檔案類型所執行，則會在每次以滑鼠右鍵按一下其中一個檔案時進行查詢。</span><span class="sxs-lookup"><span data-stu-id="92f56-113">If one is implemented for a file type, it will be queried every time one of the files is right-clicked.</span></span> <span data-ttu-id="92f56-114">然後，處理常式可以依檔案逐一指定其他功能表項目，而不是對整個檔案類型使用相同的集合。</span><span class="sxs-lookup"><span data-stu-id="92f56-114">The handler can then specify additional menu items on a file-by-file basis, rather than having the same set for the entire file type.</span></span>

<span data-ttu-id="92f56-115">本檔將討論如何執行延伸模組處理常式，讓您修改各種 Shell 動作。</span><span class="sxs-lookup"><span data-stu-id="92f56-115">This document discusses how to implement the extension handlers that allow you to modify a variety of Shell actions.</span></span> <span data-ttu-id="92f56-116">下列處理常式會與特定檔案類型相關聯，並可讓您以檔案為基礎來指定：</span><span class="sxs-lookup"><span data-stu-id="92f56-116">The following handlers are associated with a particular file type and allow you to specify on a file-by-file basis:</span></span>



| <span data-ttu-id="92f56-117">處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-117">Handler</span></span>                                               | <span data-ttu-id="92f56-118">描述</span><span class="sxs-lookup"><span data-stu-id="92f56-118">Description</span></span>                                                                                                                                                                |
|-------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="92f56-119">快速鍵功能表處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-119">Shortcut menu handler</span></span>](context-menu-handlers.md)    | <span data-ttu-id="92f56-120">在顯示檔案的快捷方式功能表之前呼叫。</span><span class="sxs-lookup"><span data-stu-id="92f56-120">Called before a file's shortcut menu is displayed.</span></span> <span data-ttu-id="92f56-121">它可讓您依檔案逐一將專案新增至快捷方式功能表。</span><span class="sxs-lookup"><span data-stu-id="92f56-121">It enables you to add items to the shortcut menu on a file-by-file basis.</span></span>                                               |
| [<span data-ttu-id="92f56-122">資料處理程式</span><span class="sxs-lookup"><span data-stu-id="92f56-122">Data handler</span></span>](how-to-create-data-handlers.md)       | <span data-ttu-id="92f56-123">在 dragShell 物件上執行拖放作業時呼叫。</span><span class="sxs-lookup"><span data-stu-id="92f56-123">Called when a drag-and-drop operation is performed on dragShell objects.</span></span> <span data-ttu-id="92f56-124">它可讓您提供其他剪貼簿格式給放置目標。</span><span class="sxs-lookup"><span data-stu-id="92f56-124">It enables you to provide additional clipboard formats to the drop target.</span></span>                        |
| [<span data-ttu-id="92f56-125">捨棄處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-125">Drop handler</span></span>](how-to-create-drop-handlers.md)       | <span data-ttu-id="92f56-126">當資料物件在檔案上拖放或卸載時呼叫。</span><span class="sxs-lookup"><span data-stu-id="92f56-126">Called when a data object is dragged over or dropped on a file.</span></span> <span data-ttu-id="92f56-127">它可讓您將檔案放入放置目標。</span><span class="sxs-lookup"><span data-stu-id="92f56-127">It enables you to make a file into a drop target.</span></span>                                                          |
| [<span data-ttu-id="92f56-128">圖示處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-128">Icon handler</span></span>](how-to-create-icon-handlers.md)       | <span data-ttu-id="92f56-129">在顯示檔案的圖示之前呼叫。</span><span class="sxs-lookup"><span data-stu-id="92f56-129">Called before a file's icon is displayed.</span></span> <span data-ttu-id="92f56-130">它可讓您以檔案為基礎，以自訂圖示取代檔案的預設圖示。</span><span class="sxs-lookup"><span data-stu-id="92f56-130">It enables you to replace the file's default icon with a custom icon on a file-by-file basis.</span></span>                                    |
| [<span data-ttu-id="92f56-131">屬性工作表處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-131">Property sheet handler</span></span>](propsheet-handlers.md)      | <span data-ttu-id="92f56-132">在顯示物件的 [ **屬性** ] 屬性工作表之前呼叫。</span><span class="sxs-lookup"><span data-stu-id="92f56-132">Called before an object's **Properties** property sheet is displayed.</span></span> <span data-ttu-id="92f56-133">它可讓您新增或取代頁面。</span><span class="sxs-lookup"><span data-stu-id="92f56-133">It enables you to add or replace pages.</span></span>                                                              |
| [<span data-ttu-id="92f56-134">**縮圖影像處理常式**</span><span class="sxs-lookup"><span data-stu-id="92f56-134">**Thumbnail Image handler**</span></span>](/windows/desktop/api/Thumbcache/nn-thumbcache-ithumbnailprovider) | <span data-ttu-id="92f56-135">提供表示專案的影像。</span><span class="sxs-lookup"><span data-stu-id="92f56-135">Provides an image to represent the item.</span></span>                                                                                                                                   |
| [<span data-ttu-id="92f56-136">**資訊提示處理常式**</span><span class="sxs-lookup"><span data-stu-id="92f56-136">**Infotip handler**</span></span>](/windows/win32/api/shlobj_core/nn-shlobj_core-iqueryinfo)                 | <span data-ttu-id="92f56-137">當使用者將滑鼠指標移至物件上方時，提供快顯視窗。</span><span class="sxs-lookup"><span data-stu-id="92f56-137">Provides pop-up text when the user hovers the mouse pointer over the object.</span></span>                                                                                               |
| [<span data-ttu-id="92f56-138">**元資料處理程式**</span><span class="sxs-lookup"><span data-stu-id="92f56-138">**Metadata handler**</span></span>](/windows/win32/api/propsys/nn-propsys-ipropertystore)     | <span data-ttu-id="92f56-139">提供中繼資料的讀取和寫入存取 (屬性) 儲存在檔案中。</span><span class="sxs-lookup"><span data-stu-id="92f56-139">Provides read and write access to metadata (properties) stored in a file.</span></span> <span data-ttu-id="92f56-140">這可以用來擴充詳細資料檢視、提示、屬性頁和群組功能。</span><span class="sxs-lookup"><span data-stu-id="92f56-140">This can be used to extend the Details view, infotips, the property page, and grouping features.</span></span> |



 

<span data-ttu-id="92f56-141">其他處理常式不會與特定檔案類型相關聯，但會在某些 Shell 作業之前呼叫：</span><span class="sxs-lookup"><span data-stu-id="92f56-141">Other handlers are not associated with a particular file type but are called before some Shell operations:</span></span>



| <span data-ttu-id="92f56-142">處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-142">Handler</span></span>                                                            | <span data-ttu-id="92f56-143">描述</span><span class="sxs-lookup"><span data-stu-id="92f56-143">Description</span></span>                                                                                                                                  |
|--------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="92f56-144">資料行處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-144">Column handler</span></span>](../lwef/column-handlers.md)                             | <span data-ttu-id="92f56-145">由 Windows 檔案總管呼叫，然後才會顯示資料夾的詳細資料檢視。</span><span class="sxs-lookup"><span data-stu-id="92f56-145">Called by Windows Explorer before it displays the Details view of a folder.</span></span> <span data-ttu-id="92f56-146">它可讓您將自訂資料行新增至詳細資料檢視。</span><span class="sxs-lookup"><span data-stu-id="92f56-146">It enables you to add custom columns to the Details view.</span></span>        |
| [<span data-ttu-id="92f56-147">複製勾點處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-147">Copy hook handler</span></span>](how-to-create-copy-hook-handlers.md)          | <span data-ttu-id="92f56-148">當資料夾或印表機物件即將移動、複製、刪除或重新命名時呼叫。</span><span class="sxs-lookup"><span data-stu-id="92f56-148">Called when a folder or printer object is about to be moved, copied, deleted, or renamed.</span></span> <span data-ttu-id="92f56-149">它可讓您核准或拒絕此作業。</span><span class="sxs-lookup"><span data-stu-id="92f56-149">It enables you to approve or veto the operation.</span></span>   |
| [<span data-ttu-id="92f56-150">拖放功能處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-150">Drag-and-drop handler</span></span>](context-menu-handlers.md)                 | <span data-ttu-id="92f56-151">在使用滑鼠右鍵拖曳檔案時呼叫。</span><span class="sxs-lookup"><span data-stu-id="92f56-151">Called when a file is dragged with the right mouse button.</span></span> <span data-ttu-id="92f56-152">它可讓您修改所顯示的快捷方式功能表。</span><span class="sxs-lookup"><span data-stu-id="92f56-152">It enables you to modify the shortcut menu that is displayed.</span></span>                     |
| [<span data-ttu-id="92f56-153">圖示重迭處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-153">Icon Overlay handler</span></span>](how-to-implement-icon-overlay-handlers.md) | <span data-ttu-id="92f56-154">在顯示檔案的圖示之前呼叫。</span><span class="sxs-lookup"><span data-stu-id="92f56-154">Called before a file's icon is displayed.</span></span> <span data-ttu-id="92f56-155">它可讓您指定檔案圖示的覆迭。</span><span class="sxs-lookup"><span data-stu-id="92f56-155">It enables you to specify an overlay for the file's icon.</span></span>                                          |
| [<span data-ttu-id="92f56-156">搜尋處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-156">Search handler</span></span>](../lwef/search-handlers.md)                             | <span data-ttu-id="92f56-157">呼叫以啟動搜尋引擎。</span><span class="sxs-lookup"><span data-stu-id="92f56-157">Called to launch a search engine.</span></span> <span data-ttu-id="92f56-158">它可讓您執行可從 [ **開始** ] 功能表或 Windows 檔案總管存取的自訂搜尋引擎。</span><span class="sxs-lookup"><span data-stu-id="92f56-158">It enables you to implement a custom search engine accessible from the **Start** menu or Windows Explorer.</span></span> |



 

<span data-ttu-id="92f56-159">上述各節將說明如何執行特定延伸模組處理常式的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="92f56-159">The details of how to implement specific extension handlers are covered in the sections listed above.</span></span> <span data-ttu-id="92f56-160">本檔的其餘部分涵蓋所有 Shell 延伸模組處理常式通用的一些執行問題。</span><span class="sxs-lookup"><span data-stu-id="92f56-160">The remainder of this document covers some implementation issues that are common to all Shell extension handlers.</span></span>

-   [<span data-ttu-id="92f56-161">執行 Shell 延伸模組處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-161">Implementing Shell Extension Handlers</span></span>](#implementing-shell-extension-handlers)
    -   [<span data-ttu-id="92f56-162">執行 IPersistFile</span><span class="sxs-lookup"><span data-stu-id="92f56-162">Implementing IPersistFile</span></span>](#implementing-ipersistfile)
    -   [<span data-ttu-id="92f56-163">執行 IShellExtInit</span><span class="sxs-lookup"><span data-stu-id="92f56-163">Implementing IShellExtInit</span></span>](#implementing-ishellextinit)
    -   [<span data-ttu-id="92f56-164">提示自訂</span><span class="sxs-lookup"><span data-stu-id="92f56-164">Infotip Customization</span></span>](#infotip-customization)
-   [<span data-ttu-id="92f56-165">使用 Shell 擴充處理常式增強 Windows Search</span><span class="sxs-lookup"><span data-stu-id="92f56-165">Enhancing Windows Search with Shell Extension Handlers</span></span>](#enhancing-windows-search-with-shell-extension-handlers)
-   [<span data-ttu-id="92f56-166">註冊 Shell 延伸模組處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-166">Registering Shell Extension Handlers</span></span>](#registering-shell-extension-handlers)
    -   [<span data-ttu-id="92f56-167">處理常式名稱</span><span class="sxs-lookup"><span data-stu-id="92f56-167">Handler Names</span></span>](#handler-names)
    -   [<span data-ttu-id="92f56-168">預先定義的 Shell 物件</span><span class="sxs-lookup"><span data-stu-id="92f56-168">Predefined Shell Objects</span></span>](#predefined-shell-objects)
    -   [<span data-ttu-id="92f56-169">擴充處理常式註冊的範例</span><span class="sxs-lookup"><span data-stu-id="92f56-169">Example of an Extension Handler Registration</span></span>](#example-of-an-extension-handler-registration)
-   [<span data-ttu-id="92f56-170">相關主題</span><span class="sxs-lookup"><span data-stu-id="92f56-170">Related topics</span></span>](#related-topics)

## <a name="implementing-shell-extension-handlers"></a><span data-ttu-id="92f56-171">執行 Shell 延伸模組處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-171">Implementing Shell Extension Handlers</span></span>

<span data-ttu-id="92f56-172">Shell 擴充處理常式物件的許多實作為相依于其型別。</span><span class="sxs-lookup"><span data-stu-id="92f56-172">Much of the implementation of a Shell extension handler object depends on its type.</span></span> <span data-ttu-id="92f56-173">不過，有一些常見的元素。</span><span class="sxs-lookup"><span data-stu-id="92f56-173">There are, however, some common elements.</span></span> <span data-ttu-id="92f56-174">本節將討論所有 Shell 延伸模組處理常式所共用的執行層面。</span><span class="sxs-lookup"><span data-stu-id="92f56-174">This section discusses those aspects of implementation that are shared by all Shell extension handlers.</span></span>

<span data-ttu-id="92f56-175">許多 Shell 擴充處理常式都是同進程元件物件模型 (COM) 物件。</span><span class="sxs-lookup"><span data-stu-id="92f56-175">Many Shell extension handlers are in-process Component Object Model (COM) objects.</span></span> <span data-ttu-id="92f56-176">您必須將 GUID 指派給它們，如註冊 Shell 擴充處理常式中所述。</span><span class="sxs-lookup"><span data-stu-id="92f56-176">They must be assigned a GUID and registered as described in Registering Shell Extension Handlers.</span></span> <span data-ttu-id="92f56-177">它們會實作為 Dll，而且必須匯出下列標準函式：</span><span class="sxs-lookup"><span data-stu-id="92f56-177">They are implemented as DLLs and must export the following standard functions:</span></span>

-   <span data-ttu-id="92f56-178">[**DllMain**](../dlls/dllmain.md)。</span><span class="sxs-lookup"><span data-stu-id="92f56-178">[**DllMain**](../dlls/dllmain.md).</span></span> <span data-ttu-id="92f56-179">DLL 的標準進入點。</span><span class="sxs-lookup"><span data-stu-id="92f56-179">The standard entry point to the DLL.</span></span>
-   <span data-ttu-id="92f56-180">[**DllGetClassObject**](/windows/win32/api/combaseapi/nf-combaseapi-dllgetclassobject)。</span><span class="sxs-lookup"><span data-stu-id="92f56-180">[**DllGetClassObject**](/windows/win32/api/combaseapi/nf-combaseapi-dllgetclassobject).</span></span> <span data-ttu-id="92f56-181">公開物件的 class factory。</span><span class="sxs-lookup"><span data-stu-id="92f56-181">Exposes the object's class factory.</span></span>
-   <span data-ttu-id="92f56-182">[**DllCanUnloadNow**](/windows/win32/api/combaseapi/nf-combaseapi-dllcanunloadnow)。</span><span class="sxs-lookup"><span data-stu-id="92f56-182">[**DllCanUnloadNow**](/windows/win32/api/combaseapi/nf-combaseapi-dllcanunloadnow).</span></span> <span data-ttu-id="92f56-183">COM 會呼叫這個函式，以判斷物件是否為任何用戶端提供服務。</span><span class="sxs-lookup"><span data-stu-id="92f56-183">COM calls this function to determine whether the object is serving any clients.</span></span> <span data-ttu-id="92f56-184">如果不是，則系統可以卸載 DLL 並釋放相關聯的記憶體。</span><span class="sxs-lookup"><span data-stu-id="92f56-184">If not, the system can unload the DLL and free the associated memory.</span></span>

<span data-ttu-id="92f56-185">Shell 擴充處理常式和所有 COM 物件一樣，都必須執行 [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) 介面和 [class factory](../com/implementing-iclassfactory.md)。</span><span class="sxs-lookup"><span data-stu-id="92f56-185">Like all COM objects, Shell extension handlers must implement an [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) interface and a [class factory](../com/implementing-iclassfactory.md).</span></span> <span data-ttu-id="92f56-186">大部分的延伸模組處理常式也都必須在 Windows XP 或更早版本中執行 [**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile) 或 [**IShellExtInit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit) 介面。</span><span class="sxs-lookup"><span data-stu-id="92f56-186">Most extension handlers must also implement either an [**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile) or [**IShellExtInit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit) interface in Windows XP or earlier.</span></span> <span data-ttu-id="92f56-187">這些已由 Windows Vista 中的 [**IInitializeWithStream**](/windows/desktop/api/Propsys/nn-propsys-iinitializewithstream)、 [**IInitializeWithItem**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-iinitializewithitem) 和 [**IInitializeWithFile**](/windows/desktop/api/Propsys/nn-propsys-iinitializewithfile) 取代。</span><span class="sxs-lookup"><span data-stu-id="92f56-187">These were replaced by [**IInitializeWithStream**](/windows/desktop/api/Propsys/nn-propsys-iinitializewithstream), [**IInitializeWithItem**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-iinitializewithitem) and [**IInitializeWithFile**](/windows/desktop/api/Propsys/nn-propsys-iinitializewithfile) in Windows Vista.</span></span> <span data-ttu-id="92f56-188">Shell 會使用這些介面來初始化處理常式。</span><span class="sxs-lookup"><span data-stu-id="92f56-188">The Shell uses these interfaces to initialize the handler.</span></span>

<span data-ttu-id="92f56-189">[**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile)介面必須由下列各項執行：</span><span class="sxs-lookup"><span data-stu-id="92f56-189">The [**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile) interface must be implemented by the following:</span></span>

-   <span data-ttu-id="92f56-190">資料處理程式</span><span class="sxs-lookup"><span data-stu-id="92f56-190">Data handlers</span></span>
-   <span data-ttu-id="92f56-191">捨棄處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-191">Drop handlers</span></span>

<span data-ttu-id="92f56-192">在過去，也需要圖示處理常式來執行 [**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile)，但這已不再成立。</span><span class="sxs-lookup"><span data-stu-id="92f56-192">In the past, icon handlers were also required to implement [**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile), but this is no longer true.</span></span> <span data-ttu-id="92f56-193">針對圖示處理常式， **IPersistFile** 現在是選擇性的，而其他介面（例如 [**IInitializeWithItem**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-iinitializewithitem) ）則是慣用的。</span><span class="sxs-lookup"><span data-stu-id="92f56-193">For icon handlers, **IPersistFile** is now optional and other interfaces such as [**IInitializeWithItem**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-iinitializewithitem) are preferred.</span></span>

<span data-ttu-id="92f56-194">[**IShellExtInit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit)介面必須由下列各項執行：</span><span class="sxs-lookup"><span data-stu-id="92f56-194">The [**IShellExtInit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit) interface must be implemented by the following:</span></span>

-   <span data-ttu-id="92f56-195">快速鍵功能表處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-195">Shortcut menu handlers</span></span>
-   <span data-ttu-id="92f56-196">拖放處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-196">Drag-and-drop handlers</span></span>
-   <span data-ttu-id="92f56-197">屬性工作表處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-197">Property sheet handlers</span></span>

### <a name="implementing-ipersistfile"></a><span data-ttu-id="92f56-198">執行 IPersistFile</span><span class="sxs-lookup"><span data-stu-id="92f56-198">Implementing IPersistFile</span></span>

<span data-ttu-id="92f56-199">[**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile)介面的目的是要允許將物件載入或儲存到磁片檔案。</span><span class="sxs-lookup"><span data-stu-id="92f56-199">The [**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile) interface is intended to permit an object to be loaded from or saved to a disk file.</span></span> <span data-ttu-id="92f56-200">除了 [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown)、其本身的五個方法，以及它繼承自 [**IPersist**](/windows/win32/api/objidl/nn-objidl-ipersist)的 [**GetClassID**](/windows/win32/api/objidl/nf-objidl-ipersist-getclassid)方法之外，它還有六個方法。</span><span class="sxs-lookup"><span data-stu-id="92f56-200">It has six methods in addition to [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown), five of its own, and the [**GetClassID**](/windows/win32/api/objidl/nf-objidl-ipersist-getclassid) method that it inherits from [**IPersist**](/windows/win32/api/objidl/nn-objidl-ipersist).</span></span> <span data-ttu-id="92f56-201">使用 Shell 擴充功能時， **IPersist** 只會用來初始化 Shell 擴充處理常式物件。</span><span class="sxs-lookup"><span data-stu-id="92f56-201">With Shell extensions, **IPersist** is used only to initialize a Shell extension handler object.</span></span> <span data-ttu-id="92f56-202">因為通常不需要讀取或寫入磁片，所以只有 **GetClassID** 和 [**Load**](/windows/win32/api/objidl/nf-objidl-ipersistfile-load) 方法需要 nontoken 執行。</span><span class="sxs-lookup"><span data-stu-id="92f56-202">Because there is typically no need to read from or write to the disk, only the **GetClassID** and [**Load**](/windows/win32/api/objidl/nf-objidl-ipersistfile-load) methods require a nontoken implementation.</span></span>

<span data-ttu-id="92f56-203">Shell 會先呼叫 [**GetClassID**](/windows/win32/api/objidl/nf-objidl-ipersist-getclassid) ，函式會傳回擴充處理常式物件 (CLSID) 的類別識別碼。</span><span class="sxs-lookup"><span data-stu-id="92f56-203">The Shell calls [**GetClassID**](/windows/win32/api/objidl/nf-objidl-ipersist-getclassid) first, and the function returns the class identifier (CLSID) of the extension handler object.</span></span> <span data-ttu-id="92f56-204">然後，Shell 會呼叫 [**Load**](/windows/win32/api/objidl/nf-objidl-ipersistfile-load) 並以兩個值傳遞。</span><span class="sxs-lookup"><span data-stu-id="92f56-204">The Shell then calls [**Load**](/windows/win32/api/objidl/nf-objidl-ipersistfile-load) and passes in two values.</span></span> <span data-ttu-id="92f56-205">第一個 *>pszfilename* 是 Unicode 字串，其中包含 Shell 即將操作的檔案或資料夾的名稱。</span><span class="sxs-lookup"><span data-stu-id="92f56-205">The first, *pszFileName*, is a Unicode string with the name of the file or folder that Shell is about to operate on.</span></span> <span data-ttu-id="92f56-206">第二個是 *dwMode*，表示檔案存取模式。</span><span class="sxs-lookup"><span data-stu-id="92f56-206">The second is *dwMode*, which indicates the file access mode.</span></span> <span data-ttu-id="92f56-207">因為通常不需要存取檔案， *dwMode* 通常是零。</span><span class="sxs-lookup"><span data-stu-id="92f56-207">Because there is typically no need to access files, *dwMode* is usually zero.</span></span> <span data-ttu-id="92f56-208">方法會視需要儲存這些值以供稍後參考。</span><span class="sxs-lookup"><span data-stu-id="92f56-208">The method stores these values as needed for later reference.</span></span>

<span data-ttu-id="92f56-209">下列程式碼片段說明一般 Shell 擴充處理常式如何執行 [**GetClassID**](/windows/win32/api/objidl/nf-objidl-ipersist-getclassid) 和 [**載入**](/windows/win32/api/objidl/nf-objidl-ipersistfile-load) 方法。</span><span class="sxs-lookup"><span data-stu-id="92f56-209">The following code fragment illustrates how a typical Shell extension handler implements the [**GetClassID**](/windows/win32/api/objidl/nf-objidl-ipersist-getclassid) and [**Load**](/windows/win32/api/objidl/nf-objidl-ipersistfile-load) methods.</span></span> <span data-ttu-id="92f56-210">它是設計來處理 ANSI 或 Unicode。</span><span class="sxs-lookup"><span data-stu-id="92f56-210">It is designed to handle either ANSI or Unicode.</span></span> <span data-ttu-id="92f56-211">CLSID \_ SampleExtHandler 是延伸模組處理常式物件的 GUID，而 CSampleExtHandler 是用來執行介面的類別名稱。</span><span class="sxs-lookup"><span data-stu-id="92f56-211">CLSID\_SampleExtHandler is the extension handler object's GUID, and CSampleExtHandler is the name of the class used to implement the interface.</span></span> <span data-ttu-id="92f56-212">**M \_ szFileName** 和 **m \_ dwMode** 變數是私用變數，用來儲存檔案的名稱和存取旗標。</span><span class="sxs-lookup"><span data-stu-id="92f56-212">The **m\_szFileName** and **m\_dwMode** variables are private variables that are used to store the file's name and access flags.</span></span>


```C++
wchar_t m_szFileName[MAX_PATH];    // The file name
DWORD m_dwMode;                  // The file access mode

CSampleExtHandler::GetClassID(CLSID *pCLSID)
{
    *pCLSID = CLSID_SampleExtHandler;
}

CSampleExtHandler::Load(PCWSTR pszFile, DWORD dwMode)
{
    m_dwMode = dwMode;
    return StringCchCopy(_szFileName, ARRAYSIZE(m_szFileName), pszFile);
}
```

### <a name="implementing-ishellextinit"></a><span data-ttu-id="92f56-213">執行 IShellExtInit</span><span class="sxs-lookup"><span data-stu-id="92f56-213">Implementing IShellExtInit</span></span>

<span data-ttu-id="92f56-214">[**IShellExtInit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit)介面除了 [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown)之外，只有一個方法 [**IShellExtInit：： Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize)。</span><span class="sxs-lookup"><span data-stu-id="92f56-214">The [**IShellExtInit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit) interface has only one method, [**IShellExtInit::Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize), in addition to [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown).</span></span> <span data-ttu-id="92f56-215">方法有三個參數，可供 Shell 用來傳入各種類型的資訊。</span><span class="sxs-lookup"><span data-stu-id="92f56-215">The method has three parameters that the Shell can use to pass in various types of information.</span></span> <span data-ttu-id="92f56-216">傳入的值取決於處理常式的類型，而部分可以設定為 **Null**。</span><span class="sxs-lookup"><span data-stu-id="92f56-216">The values passed in depend on the type of handler, and some can be set to **NULL**.</span></span>

-   <span data-ttu-id="92f56-217">*pIDFolder* 會保留資料夾的 (PIDL) 專案識別碼清單的指標。</span><span class="sxs-lookup"><span data-stu-id="92f56-217">*pIDFolder* holds a folder's pointer to an item identifier list (PIDL).</span></span> <span data-ttu-id="92f56-218">若為屬性工作表延伸，則為 **Null**。</span><span class="sxs-lookup"><span data-stu-id="92f56-218">For property sheet extensions, it is **NULL**.</span></span> <span data-ttu-id="92f56-219">如果是快捷方式功能表延伸，則是包含要顯示其快捷方式功能表之專案的資料夾 PIDL。</span><span class="sxs-lookup"><span data-stu-id="92f56-219">For shortcut menu extensions, it is the PIDL of the folder that contains the item whose shortcut menu is being displayed.</span></span> <span data-ttu-id="92f56-220">若是非預設的拖放處理常式，則為目的檔案夾的 PIDL。</span><span class="sxs-lookup"><span data-stu-id="92f56-220">For nondefault drag-and-drop handlers, it is the PIDL of the target folder.</span></span>
-   <span data-ttu-id="92f56-221">*pDataObject* 會保留資料物件的 [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) 介面指標。</span><span class="sxs-lookup"><span data-stu-id="92f56-221">*pDataObject* holds a pointer to a data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface.</span></span> <span data-ttu-id="92f56-222">資料物件會以 [CF \_ HDROP](dragdrop.md) 格式保存一或多個檔案名。</span><span class="sxs-lookup"><span data-stu-id="92f56-222">The data object holds one or more file names in [CF\_HDROP](dragdrop.md) format.</span></span>
-   <span data-ttu-id="92f56-223">*hRegKey* 會保留檔案物件或資料夾類型的登錄機碼。</span><span class="sxs-lookup"><span data-stu-id="92f56-223">*hRegKey* holds a registry key for the file object or folder type.</span></span>

<span data-ttu-id="92f56-224">[**IShellExtInit：： Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize)方法會視需要儲存檔案名、 [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject)指標和登錄機碼，以供稍後使用。</span><span class="sxs-lookup"><span data-stu-id="92f56-224">The [**IShellExtInit::Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) method stores the file name, [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) pointer, and registry key as needed for later use.</span></span> <span data-ttu-id="92f56-225">下列程式碼片段說明 **IShellExtInit：： Initialize** 的實作為。</span><span class="sxs-lookup"><span data-stu-id="92f56-225">The following code fragment illustrates an implementation of **IShellExtInit::Initialize**.</span></span> <span data-ttu-id="92f56-226">為了簡單起見，此範例假設資料物件只包含單一檔案。</span><span class="sxs-lookup"><span data-stu-id="92f56-226">For simplicity, this example assumes that the data object contains only a single file.</span></span> <span data-ttu-id="92f56-227">一般情況下，它可能會包含多個需要解壓縮的檔案。</span><span class="sxs-lookup"><span data-stu-id="92f56-227">In general, it might contain multiple files that will each need to be extracted.</span></span>


```C++
LPCITEMIDLIST  m_pIDFolder;           //The folder's PIDL
wchar_t        m_szFile[MAX_PATH];    //The file name
IDataObject   *m_pDataObj;            //The IDataObject pointer
HKEY           m_hRegKey;             //The file or folder's registry key

STDMETHODIMP CShellExt::Initialize(LPCITEMIDLIST pIDFolder, 
                                   IDataObject *pDataObj, 
                                   HKEY hRegKey) 
{ 
    // If Initialize has already been called, release the old PIDL
    ILFree(m_pIDFolder);
    m_pIDFolder = nullptr;

    // Store the new PIDL.
    if (pIDFolder)
    {
        m_pIDFolder = ILClone(pIDFolder);
    }
    
    // If Initialize has already been called, release the old
    // IDataObject pointer.
    if (m_pDataObj)
    { 
        m_pDataObj->Release(); 
    }
     
    // If a data object pointer was passed in, save it and
    // extract the file name. 
    if (pDataObj) 
    { 
        m_pDataObj = pDataObj; 
        pDataObj->AddRef(); 
      
        STGMEDIUM   medium;
        FORMATETC   fe = {CF_HDROP, NULL, DVASPECT_CONTENT, -1, TYMED_HGLOBAL};
        UINT        uCount;

        if (SUCCEEDED(m_pDataObj->GetData(&fe, &medium)))
        {
            // Get the count of files dropped.
            uCount = DragQueryFile((HDROP)medium.hGlobal, (UINT)-1, NULL, 0);

            // Get the first file name from the CF_HDROP.
            if (uCount)
                DragQueryFile((HDROP)medium.hGlobal, 0, m_szFile, 
                              sizeof(m_szFile)/sizeof(TCHAR));

            ReleaseStgMedium(&medium);
        }
    }

    // Duplicate the registry handle. 
    if (hRegKey) 
        RegOpenKeyEx(hRegKey, nullptr, 0L, MAXIMUM_ALLOWED, &m_hRegKey); 
    return S_OK; 
}
```

<span data-ttu-id="92f56-228">CSampleExtHandler 是用來執行介面之類別的名稱。</span><span class="sxs-lookup"><span data-stu-id="92f56-228">CSampleExtHandler is the name of the class used to implement the interface.</span></span> <span data-ttu-id="92f56-229">**M \_ pIDFolder**、 **m \_ pDataObject**、 **m \_ szFileName** 和 **m \_ hRegKey** 變數是用來儲存傳入資訊的私用變數。</span><span class="sxs-lookup"><span data-stu-id="92f56-229">The **m\_pIDFolder**, **m\_pDataObject**, **m\_szFileName**, and **m\_hRegKey** variables are private variables used to store the information that is passed in.</span></span> <span data-ttu-id="92f56-230">為了簡單起見，此範例假設資料物件只會保留一個檔案名。</span><span class="sxs-lookup"><span data-stu-id="92f56-230">For simplicity, this example assumes that only one file name will be held by the data object.</span></span> <span data-ttu-id="92f56-231">從資料物件中取出 [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) 結構之後，就會使用 [**DragQueryFile**](/windows/desktop/api/Shellapi/nf-shellapi-dragqueryfilea) 從 **FORMATETC** 結構的 **medium. hGlobal** 成員解壓縮檔案名。</span><span class="sxs-lookup"><span data-stu-id="92f56-231">After the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure is retrieved from the data object, [**DragQueryFile**](/windows/desktop/api/Shellapi/nf-shellapi-dragqueryfilea) is used to extract the file name from the **FORMATETC** structure's **medium.hGlobal** member.</span></span> <span data-ttu-id="92f56-232">如果傳入登錄機碼，方法會使用 [**RegOpenKeyEx**](/windows/win32/api/winreg/nf-winreg-regopenkeyexa) 開啟金鑰，並將控制碼指派給 **m \_ hRegKey**。</span><span class="sxs-lookup"><span data-stu-id="92f56-232">If a registry key is passed in, the method uses [**RegOpenKeyEx**](/windows/win32/api/winreg/nf-winreg-regopenkeyexa) to open the key and assigns the handle to **m\_hRegKey**.</span></span>

### <a name="infotip-customization"></a><span data-ttu-id="92f56-233">提示自訂</span><span class="sxs-lookup"><span data-stu-id="92f56-233">Infotip Customization</span></span>

<span data-ttu-id="92f56-234">有兩種方式可以自訂提示：</span><span class="sxs-lookup"><span data-stu-id="92f56-234">There are two ways to customize infotips:</span></span>

-   <span data-ttu-id="92f56-235">執行支援 [**IQueryInfo**](/windows/win32/api/shlobj_core/nn-shlobj_core-iqueryinfo) 的物件，然後在登錄中的適當子機碼下註冊該物件 (請參閱) 下方 [註冊 Shell 擴充處理常式](#registering-shell-extension-handlers) 。</span><span class="sxs-lookup"><span data-stu-id="92f56-235">Implement an object that supports [**IQueryInfo**](/windows/win32/api/shlobj_core/nn-shlobj_core-iqueryinfo) and then register that object under the proper subkey in the registry (see [Registering Shell Extension Handlers](#registering-shell-extension-handlers) below).</span></span>
-   <span data-ttu-id="92f56-236">指定要顯示的固定字串或特定檔案屬性的清單。</span><span class="sxs-lookup"><span data-stu-id="92f56-236">Specify a fixed string or a list of specific file properties to be displayed.</span></span>

<span data-ttu-id="92f56-237">若要顯示命名空間延伸的固定字串，請 `InfoTip` 在命名空間延伸模組的 *{CLSID}* 機碼中建立名為的專案。</span><span class="sxs-lookup"><span data-stu-id="92f56-237">To display a fixed string for a namespace extension, create an entry called `InfoTip` in the *{CLSID}* key of your namespace extension.</span></span> <span data-ttu-id="92f56-238">將該專案的值設定為您想要顯示的常值字串（如本範例所示），或將該資源中指定資源和索引的間接字串設定為當地語系化用途) 的 (。</span><span class="sxs-lookup"><span data-stu-id="92f56-238">Set the value of that entry to be either the literal string you want to display, as shown in this example, or an indirect string that specifies a resource and index within that resource (for localization purposes).</span></span>

```
HKEY_CLASSES_ROOT
   CLSID
      {CLSID}
         InfoTip = InfoTip string for your namespace extension
```

<span data-ttu-id="92f56-239">若要顯示檔案類型的固定字串，請 `InfoTip` 在該檔案類型的 *ProgID* 機碼中建立名為的專案。</span><span class="sxs-lookup"><span data-stu-id="92f56-239">To display a fixed string for a file type, create an entry called `InfoTip` in the *ProgID* key of that file type.</span></span> <span data-ttu-id="92f56-240">將該專案的值設為您想要顯示的常值字串，或將該 (資源中指定資源和索引的間接字串設定為當地語系化用途) ，如此範例所示。</span><span class="sxs-lookup"><span data-stu-id="92f56-240">Set the value of that entry to be either the literal string you want to display or an indirect string that specifies a resource and index within that resource (for localization purposes), as shown in this example.</span></span>

```
HKEY_CLASSES_ROOT
   ProgID
      InfoTip = Resource.dll, 3
```

<span data-ttu-id="92f56-241">如果您希望 Shell 在特定檔案類型的提示中顯示特定檔案屬性，請在該 `InfoTip` 檔案類型的 *ProgID* 機碼中建立呼叫的專案。</span><span class="sxs-lookup"><span data-stu-id="92f56-241">If you want the Shell to display specific file properties in the infotip for a specific file type, create an entry called `InfoTip` in the *ProgID* key for that file type.</span></span> <span data-ttu-id="92f56-242">將該專案的值設定為以分號分隔的標準屬性名稱清單、格式識別碼 (FMTID) /property 識別碼 (PID) 組或兩者。</span><span class="sxs-lookup"><span data-stu-id="92f56-242">Set the value of that entry to be a semicolon-delineated list of canonical property names, format identifier (FMTID)/property identifier (PID) pairs, or both.</span></span> <span data-ttu-id="92f56-243">此值必須以 "property：" 開頭，以將它識別為屬性清單字串。</span><span class="sxs-lookup"><span data-stu-id="92f56-243">This value must begin with "prop:" to identify it as a property list string.</span></span> <span data-ttu-id="92f56-244">如果您省略 "a："，則會將值視為常值字串，並顯示為此。</span><span class="sxs-lookup"><span data-stu-id="92f56-244">If you omit "prop:", the value is seen as a literal string and displayed as such.</span></span>

<span data-ttu-id="92f56-245">在下列範例中， *propname* 是標準的屬性名稱 (例如 System. Date) 和 *{fmtid}，pid* 是 [**fmtid/pid**](./objects.md) 組。</span><span class="sxs-lookup"><span data-stu-id="92f56-245">In the following example, *propname* is a canonical property name (such as System.Date) and *{fmtid},pid* is an [**FMTID/PID**](./objects.md) pair.</span></span>

```
HKEY_CLASSES_ROOT
   ProgID
      InfoTip = prop:propname;propname;{fmtid},pid;{fmtid},pid
```

<span data-ttu-id="92f56-246">您可以使用下列屬性名稱：</span><span class="sxs-lookup"><span data-stu-id="92f56-246">The following property names can be used:</span></span>



| <span data-ttu-id="92f56-247">屬性名稱</span><span class="sxs-lookup"><span data-stu-id="92f56-247">Property Name</span></span>    | <span data-ttu-id="92f56-248">描述</span><span class="sxs-lookup"><span data-stu-id="92f56-248">Description</span></span>                   | <span data-ttu-id="92f56-249">取出來源</span><span class="sxs-lookup"><span data-stu-id="92f56-249">Retrieved From</span></span>                                                                             |
|------------------|-------------------------------|--------------------------------------------------------------------------------------------|
| <span data-ttu-id="92f56-250">作者</span><span class="sxs-lookup"><span data-stu-id="92f56-250">Author</span></span>           | <span data-ttu-id="92f56-251">檔作者</span><span class="sxs-lookup"><span data-stu-id="92f56-251">Author of the document</span></span>        | [<span data-ttu-id="92f56-252">**PIDSI \_ 作者**</span><span class="sxs-lookup"><span data-stu-id="92f56-252">**PIDSI\_AUTHOR**</span></span>](../stg/the-summary-information-property-set.md)                              |
| <span data-ttu-id="92f56-253">標題</span><span class="sxs-lookup"><span data-stu-id="92f56-253">Title</span></span>            | <span data-ttu-id="92f56-254">檔的標題</span><span class="sxs-lookup"><span data-stu-id="92f56-254">Title of the document</span></span>         | [<span data-ttu-id="92f56-255">**PIDSI \_ 標題**</span><span class="sxs-lookup"><span data-stu-id="92f56-255">**PIDSI\_TITLE**</span></span>](../stg/the-summary-information-property-set.md)                               |
| <span data-ttu-id="92f56-256">主體</span><span class="sxs-lookup"><span data-stu-id="92f56-256">Subject</span></span>          | <span data-ttu-id="92f56-257">主題摘要</span><span class="sxs-lookup"><span data-stu-id="92f56-257">Subject summary</span></span>               | [<span data-ttu-id="92f56-258">**PIDSI \_ 主旨**</span><span class="sxs-lookup"><span data-stu-id="92f56-258">**PIDSI\_SUBJECT**</span></span>](../stg/the-summary-information-property-set.md)                             |
| <span data-ttu-id="92f56-259">註解</span><span class="sxs-lookup"><span data-stu-id="92f56-259">Comment</span></span>          | <span data-ttu-id="92f56-260">檔批註</span><span class="sxs-lookup"><span data-stu-id="92f56-260">Document comments</span></span>             | <span data-ttu-id="92f56-261">[**PIDSI \_批註**](../stg/the-summary-information-property-set.md) 或資料夾/驅動程式屬性</span><span class="sxs-lookup"><span data-stu-id="92f56-261">[**PIDSI\_COMMENT**](../stg/the-summary-information-property-set.md) or folder/driver properties</span></span> |
| <span data-ttu-id="92f56-262">PageCount</span><span class="sxs-lookup"><span data-stu-id="92f56-262">PageCount</span></span>        | <span data-ttu-id="92f56-263">頁面數目</span><span class="sxs-lookup"><span data-stu-id="92f56-263">Number of pages</span></span>               | [<span data-ttu-id="92f56-264">**PIDSI \_ PAGECOUNT**</span><span class="sxs-lookup"><span data-stu-id="92f56-264">**PIDSI\_PAGECOUNT**</span></span>](../stg/the-summary-information-property-set.md)                           |
| <span data-ttu-id="92f56-265">Name</span><span class="sxs-lookup"><span data-stu-id="92f56-265">Name</span></span>             | <span data-ttu-id="92f56-266">易記名稱</span><span class="sxs-lookup"><span data-stu-id="92f56-266">Friendly name</span></span>                 | <span data-ttu-id="92f56-267">標準資料夾檢視</span><span class="sxs-lookup"><span data-stu-id="92f56-267">Standard folder view</span></span>                                                                       |
| <span data-ttu-id="92f56-268">OriginalLocation</span><span class="sxs-lookup"><span data-stu-id="92f56-268">OriginalLocation</span></span> | <span data-ttu-id="92f56-269">原始檔案的位置</span><span class="sxs-lookup"><span data-stu-id="92f56-269">Location of original file</span></span>     | <span data-ttu-id="92f56-270">[公事包] 資料夾和資源回收筒資料夾</span><span class="sxs-lookup"><span data-stu-id="92f56-270">Briefcase folder and Recycle Bin folder</span></span>                                                    |
| <span data-ttu-id="92f56-271">DateDeleted</span><span class="sxs-lookup"><span data-stu-id="92f56-271">DateDeleted</span></span>      | <span data-ttu-id="92f56-272">資料檔案已刪除</span><span class="sxs-lookup"><span data-stu-id="92f56-272">Date file was deleted</span></span>         | <span data-ttu-id="92f56-273">資源回收筒資料夾</span><span class="sxs-lookup"><span data-stu-id="92f56-273">Recycle Bin folder</span></span>                                                                         |
| <span data-ttu-id="92f56-274">類型</span><span class="sxs-lookup"><span data-stu-id="92f56-274">Type</span></span>             | <span data-ttu-id="92f56-275">檔案類型</span><span class="sxs-lookup"><span data-stu-id="92f56-275">Type of file</span></span>                  | <span data-ttu-id="92f56-276">標準資料夾詳細資料檢視</span><span class="sxs-lookup"><span data-stu-id="92f56-276">Standard folder details view</span></span>                                                               |
| <span data-ttu-id="92f56-277">大小</span><span class="sxs-lookup"><span data-stu-id="92f56-277">Size</span></span>             | <span data-ttu-id="92f56-278">檔案大小</span><span class="sxs-lookup"><span data-stu-id="92f56-278">Size of file</span></span>                  | <span data-ttu-id="92f56-279">標準資料夾詳細資料檢視</span><span class="sxs-lookup"><span data-stu-id="92f56-279">Standard folder details view</span></span>                                                               |
| <span data-ttu-id="92f56-280">SyncCopyIn</span><span class="sxs-lookup"><span data-stu-id="92f56-280">SyncCopyIn</span></span>       | <span data-ttu-id="92f56-281">與 OriginalLocation 相同</span><span class="sxs-lookup"><span data-stu-id="92f56-281">Same as OriginalLocation</span></span>      | <span data-ttu-id="92f56-282">與 OriginalLocation 相同</span><span class="sxs-lookup"><span data-stu-id="92f56-282">Same as OriginalLocation</span></span>                                                                   |
| <span data-ttu-id="92f56-283">修改日期</span><span class="sxs-lookup"><span data-stu-id="92f56-283">Modified</span></span>         | <span data-ttu-id="92f56-284">上次修改日期</span><span class="sxs-lookup"><span data-stu-id="92f56-284">Date last modified</span></span>            | <span data-ttu-id="92f56-285">標準資料夾詳細資料檢視</span><span class="sxs-lookup"><span data-stu-id="92f56-285">Standard folder details view</span></span>                                                               |
| <span data-ttu-id="92f56-286">建立時間</span><span class="sxs-lookup"><span data-stu-id="92f56-286">Created</span></span>          | <span data-ttu-id="92f56-287">建立日期</span><span class="sxs-lookup"><span data-stu-id="92f56-287">Date created</span></span>                  | <span data-ttu-id="92f56-288">標準資料夾詳細資料檢視</span><span class="sxs-lookup"><span data-stu-id="92f56-288">Standard folder details view</span></span>                                                               |
| <span data-ttu-id="92f56-289">訪問</span><span class="sxs-lookup"><span data-stu-id="92f56-289">Accessed</span></span>         | <span data-ttu-id="92f56-290">上次存取日期</span><span class="sxs-lookup"><span data-stu-id="92f56-290">Date last accessed</span></span>            | <span data-ttu-id="92f56-291">標準資料夾詳細資料檢視</span><span class="sxs-lookup"><span data-stu-id="92f56-291">Standard folder details view</span></span>                                                               |
| <span data-ttu-id="92f56-292">InFolder</span><span class="sxs-lookup"><span data-stu-id="92f56-292">InFolder</span></span>         | <span data-ttu-id="92f56-293">包含檔案的目錄</span><span class="sxs-lookup"><span data-stu-id="92f56-293">Directory containing the file</span></span> | <span data-ttu-id="92f56-294">檔搜尋結果</span><span class="sxs-lookup"><span data-stu-id="92f56-294">Document search results</span></span>                                                                    |
| <span data-ttu-id="92f56-295">排名</span><span class="sxs-lookup"><span data-stu-id="92f56-295">Rank</span></span>             | <span data-ttu-id="92f56-296">搜尋符合品質</span><span class="sxs-lookup"><span data-stu-id="92f56-296">Quality of search match</span></span>       | <span data-ttu-id="92f56-297">檔搜尋結果</span><span class="sxs-lookup"><span data-stu-id="92f56-297">Document search results</span></span>                                                                    |
| <span data-ttu-id="92f56-298">FreeSpace</span><span class="sxs-lookup"><span data-stu-id="92f56-298">FreeSpace</span></span>        | <span data-ttu-id="92f56-299">可用的儲存空間</span><span class="sxs-lookup"><span data-stu-id="92f56-299">Available storage space</span></span>       | <span data-ttu-id="92f56-300">磁碟機</span><span class="sxs-lookup"><span data-stu-id="92f56-300">Disk drives</span></span>                                                                                |
| <span data-ttu-id="92f56-301">NumberOfVisits</span><span class="sxs-lookup"><span data-stu-id="92f56-301">NumberOfVisits</span></span>   | <span data-ttu-id="92f56-302">瀏覽次數</span><span class="sxs-lookup"><span data-stu-id="92f56-302">Number of visits</span></span>              | <span data-ttu-id="92f56-303">我的最愛資料夾</span><span class="sxs-lookup"><span data-stu-id="92f56-303">Favorites folder</span></span>                                                                           |
| <span data-ttu-id="92f56-304">屬性</span><span class="sxs-lookup"><span data-stu-id="92f56-304">Attributes</span></span>       | <span data-ttu-id="92f56-305">檔案屬性</span><span class="sxs-lookup"><span data-stu-id="92f56-305">File Attributes</span></span>               | <span data-ttu-id="92f56-306">標準資料夾詳細資料檢視</span><span class="sxs-lookup"><span data-stu-id="92f56-306">Standard folder details view</span></span>                                                               |
| <span data-ttu-id="92f56-307">公司</span><span class="sxs-lookup"><span data-stu-id="92f56-307">Company</span></span>          | <span data-ttu-id="92f56-308">公司名稱</span><span class="sxs-lookup"><span data-stu-id="92f56-308">Company name</span></span>                  | [<span data-ttu-id="92f56-309">**PIDDSI \_ 公司**</span><span class="sxs-lookup"><span data-stu-id="92f56-309">**PIDDSI\_COMPANY**</span></span>](../stg/the-documentsummaryinformation-and-userdefined-property-sets.md)    |
| <span data-ttu-id="92f56-310">類別</span><span class="sxs-lookup"><span data-stu-id="92f56-310">Category</span></span>         | <span data-ttu-id="92f56-311">檔類別</span><span class="sxs-lookup"><span data-stu-id="92f56-311">Document category</span></span>             | [<span data-ttu-id="92f56-312">**PIDDSI \_ 類別**</span><span class="sxs-lookup"><span data-stu-id="92f56-312">**PIDDSI\_CATEGORY**</span></span>](../stg/the-documentsummaryinformation-and-userdefined-property-sets.md)   |
| <span data-ttu-id="92f56-313">著作權</span><span class="sxs-lookup"><span data-stu-id="92f56-313">Copyright</span></span>        | <span data-ttu-id="92f56-314">媒體著作權</span><span class="sxs-lookup"><span data-stu-id="92f56-314">Media copyright</span></span>               | [<span data-ttu-id="92f56-315">**PIDMSI \_ 著作權**</span><span class="sxs-lookup"><span data-stu-id="92f56-315">**PIDMSI\_COPYRIGHT**</span></span>](../stg/the-documentsummaryinformation-and-userdefined-property-sets.md)  |
| <span data-ttu-id="92f56-316">HTMLInfoTipFile</span><span class="sxs-lookup"><span data-stu-id="92f56-316">HTMLInfoTipFile</span></span>  | <span data-ttu-id="92f56-317">HTML 提示檔</span><span class="sxs-lookup"><span data-stu-id="92f56-317">HTML InfoTip file</span></span>             | <span data-ttu-id="92f56-318">資料夾的 Desktop.ini 檔案</span><span class="sxs-lookup"><span data-stu-id="92f56-318">Desktop.ini file for folder</span></span>                                                                |



 

## <a name="enhancing-windows-search-with-shell-extension-handlers"></a><span data-ttu-id="92f56-319">使用 Shell 擴充處理常式增強 Windows Search</span><span class="sxs-lookup"><span data-stu-id="92f56-319">Enhancing Windows Search with Shell Extension Handlers</span></span>

<span data-ttu-id="92f56-320">Shell 擴充處理常式可以用來增強 Windows Search 通訊協定處理常式所提供的使用者體驗。</span><span class="sxs-lookup"><span data-stu-id="92f56-320">Shell extension handlers may be used to enhance the user experience provided by a Windows Search protocol handler.</span></span> <span data-ttu-id="92f56-321">若要啟用這類增強功能，支援的 Shell 擴充處理常式必須設計成與搜尋通訊協定處理常式整合，以作為資料來源。</span><span class="sxs-lookup"><span data-stu-id="92f56-321">To enable such enhancements, the supporting Shell extension handler must be designed to integrate with the search protocol handler as a data source.</span></span> <span data-ttu-id="92f56-322">如需有關如何透過與 Shell 擴充處理常式整合來增強 Windows Search 通訊協定處理常式的詳細資訊，請參閱 [加入圖示、預覽和快捷方式功能表](../search/-search-3x-wds-ph-ui-extensions.md)。</span><span class="sxs-lookup"><span data-stu-id="92f56-322">For information about how to enhance a Windows Search protocol handler through integration with a Shell extension handler, see [Adding Icons, Previews and Shortcut Menus](../search/-search-3x-wds-ph-ui-extensions.md).</span></span> <span data-ttu-id="92f56-323">如需 Windows Search 通訊協定處理常式的詳細資訊，請參閱 [開發通訊協定處理常式](../search/-search-3x-wds-phaddins.md)。</span><span class="sxs-lookup"><span data-stu-id="92f56-323">For more information about Windows Search protocol handlers, see [Developing Protocol Handlers](../search/-search-3x-wds-phaddins.md).</span></span>

## <a name="registering-shell-extension-handlers"></a><span data-ttu-id="92f56-324">註冊 Shell 延伸模組處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-324">Registering Shell Extension Handlers</span></span>

<span data-ttu-id="92f56-325">您必須先註冊 Shell 擴充處理常式物件，Shell 才能使用它。</span><span class="sxs-lookup"><span data-stu-id="92f56-325">A Shell extension handler object must be registered before the Shell can use it.</span></span> <span data-ttu-id="92f56-326">本節是如何註冊 Shell 延伸模組處理常式的一般討論。</span><span class="sxs-lookup"><span data-stu-id="92f56-326">This section is a general discussion of how to register a Shell extension handler.</span></span>

<span data-ttu-id="92f56-327">每當您建立或變更 Shell 延伸模組處理常式時，請務必使用 [**SHChangeNotify**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shchangenotify)來通知系統您已進行變更，並指定 **SHCNE \_ ASSOCCHANGED** 事件。</span><span class="sxs-lookup"><span data-stu-id="92f56-327">Any time you create or change a Shell extension handler, it is important to notify the system that you have made a change with [**SHChangeNotify**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shchangenotify), specifying the **SHCNE\_ASSOCCHANGED** event.</span></span> <span data-ttu-id="92f56-328">如果您未呼叫 **SHChangeNotify**，在系統重新開機之前，可能無法辨識變更。</span><span class="sxs-lookup"><span data-stu-id="92f56-328">If you do not call **SHChangeNotify**, the change might not be recognized until the system is rebooted.</span></span>

<span data-ttu-id="92f56-329">如同所有 COM 物件，您必須使用 UUIDGEN.exe 之類的工具來建立處理常式的 GUID。</span><span class="sxs-lookup"><span data-stu-id="92f56-329">As with all COM objects, you must create a GUID for the handler using a tool such as UUIDGEN.exe.</span></span> <span data-ttu-id="92f56-330">在 **HKEY \_ 類別 \_ 根目錄** CLSID 下建立索引鍵， \\ 其名稱是 GUID 的字串形式。</span><span class="sxs-lookup"><span data-stu-id="92f56-330">Create a key under **HKEY\_CLASSES\_ROOT**\\**CLSID** whose name is the string form of the GUID.</span></span> <span data-ttu-id="92f56-331">由於 Shell 擴充處理常式是同進程伺服器，因此您必須在 GUID 索引鍵下建立 **InProcServer32** 索引鍵，並將預設值設定為處理常式 DLL 的路徑。</span><span class="sxs-lookup"><span data-stu-id="92f56-331">Because Shell extension handlers are in-process servers, you must create an **InProcServer32** key under the GUID key with the default value set to the path of the handler's DLL.</span></span> <span data-ttu-id="92f56-332">使用單元執行緒模型。</span><span class="sxs-lookup"><span data-stu-id="92f56-332">Use the Apartment threading model.</span></span>

<span data-ttu-id="92f56-333">每當 Shell 採取的動作都可能牽涉到 Shell 擴充處理常式時，就會檢查適當的登錄機碼。</span><span class="sxs-lookup"><span data-stu-id="92f56-333">Any time the Shell takes an action that can involve a Shell extension handler, it checks the appropriate registry key.</span></span> <span data-ttu-id="92f56-334">用來註冊擴充處理常式的索引鍵，因此將會控制其呼叫的時間。</span><span class="sxs-lookup"><span data-stu-id="92f56-334">The key under which an extension handler is registered thus controls when it will be called.</span></span> <span data-ttu-id="92f56-335">比方說，當 Shell 針對 [檔案類型](fa-file-types.md)的成員顯示快捷方式功能表時，會呼叫快捷方式功能表處理常式，是常見的作法。</span><span class="sxs-lookup"><span data-stu-id="92f56-335">For instance, it is a common practice to have a shortcut menu handler called when the Shell displays a shortcut menu for a member of a [file type](fa-file-types.md).</span></span> <span data-ttu-id="92f56-336">在此情況下，必須在檔案類型的 **ProgID** 索引鍵下註冊處理常式。</span><span class="sxs-lookup"><span data-stu-id="92f56-336">In this case, the handler must be registered under the file type's **ProgID** key.</span></span>

### <a name="handler-names"></a><span data-ttu-id="92f56-337">處理常式名稱</span><span class="sxs-lookup"><span data-stu-id="92f56-337">Handler Names</span></span>

<span data-ttu-id="92f56-338">若要啟用 Shell 延伸模組處理常式，請使用處理程式子機碼名稱來建立子機碼 (在 [檔) 類型] 的 **ProgID** (的 [ **ShellEx** ] 子機碼下) ，或 ([預先定義之 shell 物件](#predefined-shell-objects)的 [shell 物件類型名稱) ]。</span><span class="sxs-lookup"><span data-stu-id="92f56-338">To enable a Shell extension handler, create a subkey with the handler subkey name (see below) under the **ShellEx** subkey of either the **ProgID** (for file types) or the Shell object type name (for [Predefined Shell Objects](#predefined-shell-objects)).</span></span>

<span data-ttu-id="92f56-339">例如，如果您想要註冊 Myprogram.exe 的快捷方式功能表延伸模組處理常式，您必須先建立下列子機碼：</span><span class="sxs-lookup"><span data-stu-id="92f56-339">For example, if you wanted to register a shortcut menu extension handler for MyProgram.1, you would begin by creating the following subkey:</span></span>

```
HKEY_CLASSES_ROOT
   MyProgram.1
      ShellEx
         ContextMenuHandlers
```

<span data-ttu-id="92f56-340">針對下列處理常式，在「處理常式子機碼名稱」機碼底下建立子機碼，其名稱是 Shell 擴充的 CLSID 的字串版本。</span><span class="sxs-lookup"><span data-stu-id="92f56-340">For the following handlers, create a subkey underneath the "Handler Subkey name" key whose name is the string version of the CLSID of the Shell extension.</span></span> <span data-ttu-id="92f56-341">藉由建立多個子機碼，可以在處理常式子機碼名稱索引鍵下註冊多個擴充功能。</span><span class="sxs-lookup"><span data-stu-id="92f56-341">Multiple extensions can be registered under the handler subkey name key by creating multiple subkeys.</span></span>



| <span data-ttu-id="92f56-342">處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-342">Handler</span></span>                                               | <span data-ttu-id="92f56-343">介面</span><span class="sxs-lookup"><span data-stu-id="92f56-343">Interface</span></span>          | <span data-ttu-id="92f56-344">處理常式子機碼名稱</span><span class="sxs-lookup"><span data-stu-id="92f56-344">Handler Subkey Name</span></span>       |
|-------------------------------------------------------|--------------------|---------------------------|
| <span data-ttu-id="92f56-345">快速鍵功能表處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-345">Shortcut menu handler</span></span>                                 | <span data-ttu-id="92f56-346">ICoNtextMenu</span><span class="sxs-lookup"><span data-stu-id="92f56-346">IContextMenu</span></span>       | <span data-ttu-id="92f56-347">**CoNtextMenuHandlers**</span><span class="sxs-lookup"><span data-stu-id="92f56-347">**ContextMenuHandlers**</span></span>   |
| <span data-ttu-id="92f56-348">Copyhook 處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-348">Copyhook handler</span></span>                                      | <span data-ttu-id="92f56-349">ICopyHook</span><span class="sxs-lookup"><span data-stu-id="92f56-349">ICopyHook</span></span>          | <span data-ttu-id="92f56-350">**CopyHookHandlers**</span><span class="sxs-lookup"><span data-stu-id="92f56-350">**CopyHookHandlers**</span></span>      |
| <span data-ttu-id="92f56-351">拖放功能處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-351">Drag-and-drop handler</span></span>                                 | <span data-ttu-id="92f56-352">ICoNtextMenu</span><span class="sxs-lookup"><span data-stu-id="92f56-352">IContextMenu</span></span>       | <span data-ttu-id="92f56-353">**DragDropHandlers**</span><span class="sxs-lookup"><span data-stu-id="92f56-353">**DragDropHandlers**</span></span>      |
| <span data-ttu-id="92f56-354">屬性工作表處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-354">Property sheet handler</span></span>                                | <span data-ttu-id="92f56-355">IShellPropSheetExt</span><span class="sxs-lookup"><span data-stu-id="92f56-355">IShellPropSheetExt</span></span> | <span data-ttu-id="92f56-356">**PropertySheetHandlers**</span><span class="sxs-lookup"><span data-stu-id="92f56-356">**PropertySheetHandlers**</span></span> |
| <span data-ttu-id="92f56-357">Windows Vista) 中的資料行提供者處理常式 (已淘汰</span><span class="sxs-lookup"><span data-stu-id="92f56-357">Column provider handler (deprecated in Windows Vista)</span></span> | <span data-ttu-id="92f56-358">IColumnProvider</span><span class="sxs-lookup"><span data-stu-id="92f56-358">IColumnProvider</span></span>    | <span data-ttu-id="92f56-359">**ColumnHandlers**</span><span class="sxs-lookup"><span data-stu-id="92f56-359">**ColumnHandlers**</span></span>        |



 

<span data-ttu-id="92f56-360">針對下列處理常式，「處理常式子機碼名稱」索引鍵的預設值是 Shell 延伸模組之 CLSID 的字串版本。</span><span class="sxs-lookup"><span data-stu-id="92f56-360">For the following handlers, the default value of the "Handler Subkey Name" key is the string version of the CLSID of the Shell extension.</span></span> <span data-ttu-id="92f56-361">您只能為這些處理常式註冊一個擴充功能。</span><span class="sxs-lookup"><span data-stu-id="92f56-361">Only one extension can be registered for these handlers.</span></span>



| <span data-ttu-id="92f56-362">處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-362">Handler</span></span>                 | <span data-ttu-id="92f56-363">介面</span><span class="sxs-lookup"><span data-stu-id="92f56-363">Interface</span></span>                                         | <span data-ttu-id="92f56-364">處理常式子機碼名稱</span><span class="sxs-lookup"><span data-stu-id="92f56-364">Handler Subkey Name</span></span>                        |
|-------------------------|---------------------------------------------------|--------------------------------------------|
| <span data-ttu-id="92f56-365">資料處理程式</span><span class="sxs-lookup"><span data-stu-id="92f56-365">Data handler</span></span>            | <span data-ttu-id="92f56-366">IDataObject</span><span class="sxs-lookup"><span data-stu-id="92f56-366">IDataObject</span></span>                                       | <span data-ttu-id="92f56-367">**DataHandler**</span><span class="sxs-lookup"><span data-stu-id="92f56-367">**DataHandler**</span></span>                            |
| <span data-ttu-id="92f56-368">捨棄處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-368">Drop handler</span></span>            | <span data-ttu-id="92f56-369">IDropTarget</span><span class="sxs-lookup"><span data-stu-id="92f56-369">IDropTarget</span></span>                                       | <span data-ttu-id="92f56-370">**DropHandler**</span><span class="sxs-lookup"><span data-stu-id="92f56-370">**DropHandler**</span></span>                            |
| <span data-ttu-id="92f56-371">圖示處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-371">Icon handler</span></span>            | <span data-ttu-id="92f56-372">IExtractIconA/W</span><span class="sxs-lookup"><span data-stu-id="92f56-372">IExtractIconA/W</span></span>                                   | <span data-ttu-id="92f56-373">**IconHandler**</span><span class="sxs-lookup"><span data-stu-id="92f56-373">**IconHandler**</span></span>                            |
| <span data-ttu-id="92f56-374">影像處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-374">Image handler</span></span>           | <span data-ttu-id="92f56-375">IExtractImage</span><span class="sxs-lookup"><span data-stu-id="92f56-375">IExtractImage</span></span>                                     | <span data-ttu-id="92f56-376">**{BB2E617C-0920-11d1-9A0B-00C04FC2D6C1}**</span><span class="sxs-lookup"><span data-stu-id="92f56-376">**{BB2E617C-0920-11d1-9A0B-00C04FC2D6C1}**</span></span> |
| <span data-ttu-id="92f56-377">縮圖影像處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-377">Thumbnail image handler</span></span> | <span data-ttu-id="92f56-378">IThumbnailProvider</span><span class="sxs-lookup"><span data-stu-id="92f56-378">IThumbnailProvider</span></span>                                | <span data-ttu-id="92f56-379">**{E357FCCD-A995-4576-B01F-234630154E96}**</span><span class="sxs-lookup"><span data-stu-id="92f56-379">**{E357FCCD-A995-4576-B01F-234630154E96}**</span></span> |
| <span data-ttu-id="92f56-380">資訊提示處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-380">Infotip handler</span></span>         | <span data-ttu-id="92f56-381">IQueryInfo</span><span class="sxs-lookup"><span data-stu-id="92f56-381">IQueryInfo</span></span>                                        | <span data-ttu-id="92f56-382">**{00021500-0000-0000-C000-000000000046}**</span><span class="sxs-lookup"><span data-stu-id="92f56-382">**{00021500-0000-0000-C000-000000000046}**</span></span> |
| <span data-ttu-id="92f56-383"> (ANSI ) 的 Shell 連結</span><span class="sxs-lookup"><span data-stu-id="92f56-383">Shell link (ANSI )</span></span>      | <span data-ttu-id="92f56-384">IShellLinkA</span><span class="sxs-lookup"><span data-stu-id="92f56-384">IShellLinkA</span></span>                                       | <span data-ttu-id="92f56-385">**{000214EE-0000-0000-C000-000000000046}**</span><span class="sxs-lookup"><span data-stu-id="92f56-385">**{000214EE-0000-0000-C000-000000000046}**</span></span> |
| <span data-ttu-id="92f56-386">Shell 連結 (UNICODE) </span><span class="sxs-lookup"><span data-stu-id="92f56-386">Shell link (UNICODE)</span></span>    | <span data-ttu-id="92f56-387">IShellLinkW</span><span class="sxs-lookup"><span data-stu-id="92f56-387">IShellLinkW</span></span>                                       | <span data-ttu-id="92f56-388">**{000214F9-0000-0000-C000-000000000046}**</span><span class="sxs-lookup"><span data-stu-id="92f56-388">**{000214F9-0000-0000-C000-000000000046}**</span></span> |
| <span data-ttu-id="92f56-389">結構化儲存體</span><span class="sxs-lookup"><span data-stu-id="92f56-389">Structured storage</span></span>      | <span data-ttu-id="92f56-390">IStorage</span><span class="sxs-lookup"><span data-stu-id="92f56-390">IStorage</span></span>                                          | <span data-ttu-id="92f56-391">**{0000000B-0000-0000-C000-000000000046}**</span><span class="sxs-lookup"><span data-stu-id="92f56-391">**{0000000B-0000-0000-C000-000000000046}**</span></span> |
| <span data-ttu-id="92f56-392">中繼資料</span><span class="sxs-lookup"><span data-stu-id="92f56-392">Metadata</span></span>                | <span data-ttu-id="92f56-393">IPropertyStore</span><span class="sxs-lookup"><span data-stu-id="92f56-393">IPropertyStore</span></span>                                    | <span data-ttu-id="92f56-394">**PropertyHandler**</span><span class="sxs-lookup"><span data-stu-id="92f56-394">**PropertyHandler**</span></span>                        |
| <span data-ttu-id="92f56-395">中繼資料</span><span class="sxs-lookup"><span data-stu-id="92f56-395">Metadata</span></span>                | <span data-ttu-id="92f56-396">IPropertySetStorage (已在 Windows Vista) 中淘汰</span><span class="sxs-lookup"><span data-stu-id="92f56-396">IPropertySetStorage (deprecated in Windows Vista)</span></span> | <span data-ttu-id="92f56-397">**PropertyHandler**</span><span class="sxs-lookup"><span data-stu-id="92f56-397">**PropertyHandler**</span></span>                        |
| <span data-ttu-id="92f56-398">釘選到開始功能表</span><span class="sxs-lookup"><span data-stu-id="92f56-398">Pin to Start Menu</span></span>       | <span data-ttu-id="92f56-399">IStartMenuPinnedList</span><span class="sxs-lookup"><span data-stu-id="92f56-399">IStartMenuPinnedList</span></span>                              | <span data-ttu-id="92f56-400">**{a2a9545d-a0c2-42b4-9708-a0b2badd77c8}**</span><span class="sxs-lookup"><span data-stu-id="92f56-400">**{a2a9545d-a0c2-42b4-9708-a0b2badd77c8}**</span></span> |
| <span data-ttu-id="92f56-401">釘選到工作列</span><span class="sxs-lookup"><span data-stu-id="92f56-401">Pin to Taskbar</span></span>          |                                                   | <span data-ttu-id="92f56-402">**{90AA3A4E-1CBA-4233-B8BB-535773D48449}**</span><span class="sxs-lookup"><span data-stu-id="92f56-402">**{90AA3A4E-1CBA-4233-B8BB-535773D48449}**</span></span> |



 

<span data-ttu-id="92f56-403">只有包含 [IsShortCut](./links.md)專案的檔案類型才需要指定的子機碼，以將 [釘選到 **開始] 功能表** 和 [**釘選到工作列**] 新增至專案的快捷方式功能表。</span><span class="sxs-lookup"><span data-stu-id="92f56-403">The subkeys specified to add **Pin to Start Menu** and **Pin to Taskbar** to an item's shortcut menu are only required for file types that include the [IsShortCut](./links.md) entry.</span></span>

<span data-ttu-id="92f56-404">在 Windows Vista 中已移除對資料行提供者處理常式的支援。</span><span class="sxs-lookup"><span data-stu-id="92f56-404">Support for column provider handlers was removed in Windows Vista.</span></span> <span data-ttu-id="92f56-405">此外，從 Windows Vista 起， [**IPropertySetStorage**](/windows/win32/api/propidl/nn-propidl-ipropertysetstorage) 已被取代為 [**IPropertyStore**](/windows/win32/api/propsys/nn-propsys-ipropertystore)。</span><span class="sxs-lookup"><span data-stu-id="92f56-405">Also, as of Windows Vista, [**IPropertySetStorage**](/windows/win32/api/propidl/nn-propidl-ipropertysetstorage) has been deprecated in favor of [**IPropertyStore**](/windows/win32/api/propsys/nn-propsys-ipropertystore).</span></span>

<span data-ttu-id="92f56-406">雖然仍支援 [**IExtractImage**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-iextractimage) ，但 Windows Vista 和更新版本的建議是 [**IThumbnailProvider**](/windows/desktop/api/Thumbcache/nn-thumbcache-ithumbnailprovider) 。</span><span class="sxs-lookup"><span data-stu-id="92f56-406">While [**IExtractImage**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-iextractimage) remains supported, [**IThumbnailProvider**](/windows/desktop/api/Thumbcache/nn-thumbcache-ithumbnailprovider) is preferred for Windows Vista and later.</span></span>

### <a name="predefined-shell-objects"></a><span data-ttu-id="92f56-407">預先定義的 Shell 物件</span><span class="sxs-lookup"><span data-stu-id="92f56-407">Predefined Shell Objects</span></span>

<span data-ttu-id="92f56-408">Shell 會在 **HKEY \_ 類別 \_ 根目錄** 下定義其他物件，其可透過與檔案類型相同的方式來擴充。</span><span class="sxs-lookup"><span data-stu-id="92f56-408">The Shell defines additional objects under **HKEY\_CLASSES\_ROOT** which can be extended in the same way as file types.</span></span> <span data-ttu-id="92f56-409">例如，若要加入所有檔案的屬性工作表處理常式，您可以在 **PropertySheetHandlers** 索引鍵下註冊。</span><span class="sxs-lookup"><span data-stu-id="92f56-409">For example, to add a property sheet handler for all files, you can register under the **PropertySheetHandlers** key.</span></span>

```
HKEY_CLASSES_ROOT
   *
      shellex
         PropertySheetHandlers
```

<span data-ttu-id="92f56-410">下表提供 **HKEY \_ 類別 \_ 根目錄** 的各種子機碼，您可以在這些子機碼下註冊擴充處理常式。</span><span class="sxs-lookup"><span data-stu-id="92f56-410">The following table gives the various subkeys of **HKEY\_CLASSES\_ROOT** under which extension handlers can be registered.</span></span> <span data-ttu-id="92f56-411">請注意，許多擴充程式處理常式無法在所有列出的子機碼下註冊。</span><span class="sxs-lookup"><span data-stu-id="92f56-411">Note that many extension handlers cannot be registered under all of the listed subkeys.</span></span> <span data-ttu-id="92f56-412">如需進一步的詳細資料，請參閱特定處理常式的檔。</span><span class="sxs-lookup"><span data-stu-id="92f56-412">For further details, see the specific handler's documentation.</span></span>



| <span data-ttu-id="92f56-413">子機碼</span><span class="sxs-lookup"><span data-stu-id="92f56-413">Subkey</span></span>                    | <span data-ttu-id="92f56-414">Description</span><span class="sxs-lookup"><span data-stu-id="92f56-414">Description</span></span>                                                          | <span data-ttu-id="92f56-415">可能的處理常式</span><span class="sxs-lookup"><span data-stu-id="92f56-415">Possible Handlers</span></span>                                | <span data-ttu-id="92f56-416">版本</span><span class="sxs-lookup"><span data-stu-id="92f56-416">Version</span></span> |
|---------------------------|----------------------------------------------------------------------|--------------------------------------------------|---------|
| <span data-ttu-id="92f56-417">\**\** _</span><span class="sxs-lookup"><span data-stu-id="92f56-417">\**\** _</span></span>                    | <span data-ttu-id="92f56-418">所有檔案</span><span class="sxs-lookup"><span data-stu-id="92f56-418">All files</span></span>                                                            | <span data-ttu-id="92f56-419">快速鍵功能表、屬性工作表、動詞 (請參閱以下) </span><span class="sxs-lookup"><span data-stu-id="92f56-419">Shortcut Menu, Property Sheet, Verbs (see below)</span></span> | <span data-ttu-id="92f56-420">全部</span><span class="sxs-lookup"><span data-stu-id="92f56-420">All</span></span>     |
| <span data-ttu-id="92f56-421">_ *AllFileSystemObjects*\*</span><span class="sxs-lookup"><span data-stu-id="92f56-421">_ *AllFileSystemObjects*\*</span></span>  | <span data-ttu-id="92f56-422">所有檔案和檔案資料夾</span><span class="sxs-lookup"><span data-stu-id="92f56-422">All files and file folders</span></span>                                           | <span data-ttu-id="92f56-423">快速鍵功能表、屬性工作表、動詞</span><span class="sxs-lookup"><span data-stu-id="92f56-423">Shortcut Menu, Property Sheet, Verbs</span></span>             | <span data-ttu-id="92f56-424">4.71</span><span class="sxs-lookup"><span data-stu-id="92f56-424">4.71</span></span>    |
| <span data-ttu-id="92f56-425">**資料夾**</span><span class="sxs-lookup"><span data-stu-id="92f56-425">**Folder**</span></span>                | <span data-ttu-id="92f56-426">全部資料夾</span><span class="sxs-lookup"><span data-stu-id="92f56-426">All folders</span></span>                                                          | <span data-ttu-id="92f56-427">快速鍵功能表、屬性工作表、動詞</span><span class="sxs-lookup"><span data-stu-id="92f56-427">Shortcut Menu, Property Sheet, Verbs</span></span>             | <span data-ttu-id="92f56-428">全部</span><span class="sxs-lookup"><span data-stu-id="92f56-428">All</span></span>     |
| <span data-ttu-id="92f56-429">**目錄**</span><span class="sxs-lookup"><span data-stu-id="92f56-429">**Directory**</span></span>             | <span data-ttu-id="92f56-430">資料夾</span><span class="sxs-lookup"><span data-stu-id="92f56-430">File folders</span></span>                                                         | <span data-ttu-id="92f56-431">快速鍵功能表、屬性工作表、動詞</span><span class="sxs-lookup"><span data-stu-id="92f56-431">Shortcut Menu, Property Sheet, Verbs</span></span>             | <span data-ttu-id="92f56-432">全部</span><span class="sxs-lookup"><span data-stu-id="92f56-432">All</span></span>     |
| <span data-ttu-id="92f56-433">**目錄 \\ 背景**</span><span class="sxs-lookup"><span data-stu-id="92f56-433">**Directory\\Background**</span></span> | <span data-ttu-id="92f56-434">檔案資料夾背景</span><span class="sxs-lookup"><span data-stu-id="92f56-434">File folder background</span></span>                                               | <span data-ttu-id="92f56-435">僅快捷方式功能表</span><span class="sxs-lookup"><span data-stu-id="92f56-435">Shortcut Menu only</span></span>                               | <span data-ttu-id="92f56-436">4.71</span><span class="sxs-lookup"><span data-stu-id="92f56-436">4.71</span></span>    |
| <span data-ttu-id="92f56-437">**磁碟機**</span><span class="sxs-lookup"><span data-stu-id="92f56-437">**Drive**</span></span>                 | <span data-ttu-id="92f56-438">MyComputer 中的所有磁片磁碟機，例如 "C： \\ "</span><span class="sxs-lookup"><span data-stu-id="92f56-438">All drives in MyComputer, such as "C:\\"</span></span>                             | <span data-ttu-id="92f56-439">快速鍵功能表、屬性工作表、動詞</span><span class="sxs-lookup"><span data-stu-id="92f56-439">Shortcut Menu, Property Sheet, Verbs</span></span>             | <span data-ttu-id="92f56-440">全部</span><span class="sxs-lookup"><span data-stu-id="92f56-440">All</span></span>     |
| <span data-ttu-id="92f56-441">**Network**</span><span class="sxs-lookup"><span data-stu-id="92f56-441">**Network**</span></span>               | <span data-ttu-id="92f56-442">網路下的整個網路 () </span><span class="sxs-lookup"><span data-stu-id="92f56-442">Entire network (under My Network Places)</span></span>                             | <span data-ttu-id="92f56-443">快速鍵功能表、屬性工作表、動詞</span><span class="sxs-lookup"><span data-stu-id="92f56-443">Shortcut Menu, Property Sheet, Verbs</span></span>             | <span data-ttu-id="92f56-444">全部</span><span class="sxs-lookup"><span data-stu-id="92f56-444">All</span></span>     |
| <span data-ttu-id="92f56-445">**網路 \\ 類型\\\#**</span><span class="sxs-lookup"><span data-stu-id="92f56-445">**Network\\Type\\\#**</span></span>     | <span data-ttu-id="92f56-446"> (類型的所有物件 \# 如下所示) </span><span class="sxs-lookup"><span data-stu-id="92f56-446">All objects of type \# (see below)</span></span>                                   | <span data-ttu-id="92f56-447">快速鍵功能表、屬性工作表、動詞</span><span class="sxs-lookup"><span data-stu-id="92f56-447">Shortcut menu, Property Sheet, Verbs</span></span>             | <span data-ttu-id="92f56-448">4.71</span><span class="sxs-lookup"><span data-stu-id="92f56-448">4.71</span></span>    |
| <span data-ttu-id="92f56-449">**NetShare**</span><span class="sxs-lookup"><span data-stu-id="92f56-449">**NetShare**</span></span>              | <span data-ttu-id="92f56-450">所有網路共用</span><span class="sxs-lookup"><span data-stu-id="92f56-450">All network shares</span></span>                                                   | <span data-ttu-id="92f56-451">快速鍵功能表、屬性工作表、動詞</span><span class="sxs-lookup"><span data-stu-id="92f56-451">Shortcut menu, Property Sheet, Verbs</span></span>             | <span data-ttu-id="92f56-452">4.71</span><span class="sxs-lookup"><span data-stu-id="92f56-452">4.71</span></span>    |
| <span data-ttu-id="92f56-453">**NetServer**</span><span class="sxs-lookup"><span data-stu-id="92f56-453">**NetServer**</span></span>             | <span data-ttu-id="92f56-454">所有網路伺服器</span><span class="sxs-lookup"><span data-stu-id="92f56-454">All network servers</span></span>                                                  | <span data-ttu-id="92f56-455">快速鍵功能表、屬性工作表、動詞</span><span class="sxs-lookup"><span data-stu-id="92f56-455">Shortcut menu, Property Sheet, Verbs</span></span>             | <span data-ttu-id="92f56-456">4.71</span><span class="sxs-lookup"><span data-stu-id="92f56-456">4.71</span></span>    |
| <span data-ttu-id="92f56-457">*網路 \_ 提供者 \_ 名稱*</span><span class="sxs-lookup"><span data-stu-id="92f56-457">*network\_provider\_name*</span></span> | <span data-ttu-id="92f56-458">網路提供者「*網路 \_ 提供者 \_ 名稱*」提供的所有物件</span><span class="sxs-lookup"><span data-stu-id="92f56-458">All objects provided by network provider "*network\_provider\_name*"</span></span> | <span data-ttu-id="92f56-459">快速鍵功能表、屬性工作表、動詞</span><span class="sxs-lookup"><span data-stu-id="92f56-459">Shortcut menu, Property Sheet, Verbs</span></span>             | <span data-ttu-id="92f56-460">全部</span><span class="sxs-lookup"><span data-stu-id="92f56-460">All</span></span>     |
| <span data-ttu-id="92f56-461">**印表機**</span><span class="sxs-lookup"><span data-stu-id="92f56-461">**Printers**</span></span>              | <span data-ttu-id="92f56-462">所有印表機</span><span class="sxs-lookup"><span data-stu-id="92f56-462">All printers</span></span>                                                         | <span data-ttu-id="92f56-463">快速鍵功能表，屬性工作表</span><span class="sxs-lookup"><span data-stu-id="92f56-463">Shortcut Menu, Property Sheet</span></span>                    | <span data-ttu-id="92f56-464">全部</span><span class="sxs-lookup"><span data-stu-id="92f56-464">All</span></span>     |
| <span data-ttu-id="92f56-465">**AudioCD**</span><span class="sxs-lookup"><span data-stu-id="92f56-465">**AudioCD**</span></span>               | <span data-ttu-id="92f56-466">CD 光碟機中的音訊 CD</span><span class="sxs-lookup"><span data-stu-id="92f56-466">Audio CD in CD drive</span></span>                                                 | <span data-ttu-id="92f56-467">僅限動詞</span><span class="sxs-lookup"><span data-stu-id="92f56-467">Verbs only</span></span>                                       | <span data-ttu-id="92f56-468">全部</span><span class="sxs-lookup"><span data-stu-id="92f56-468">All</span></span>     |
| <span data-ttu-id="92f56-469">**Dvd**</span><span class="sxs-lookup"><span data-stu-id="92f56-469">**DVD**</span></span>                   | <span data-ttu-id="92f56-470">DVD 光碟機 (Windows 2000) </span><span class="sxs-lookup"><span data-stu-id="92f56-470">DVD drive (Windows 2000)</span></span>                                             | <span data-ttu-id="92f56-471">快速鍵功能表、屬性工作表、動詞</span><span class="sxs-lookup"><span data-stu-id="92f56-471">Shortcut Menu, Property Sheet, Verbs</span></span>             | <span data-ttu-id="92f56-472">4.71</span><span class="sxs-lookup"><span data-stu-id="92f56-472">4.71</span></span>    |



 

<span data-ttu-id="92f56-473">注意：</span><span class="sxs-lookup"><span data-stu-id="92f56-473">Notes:</span></span>

-   <span data-ttu-id="92f56-474">您可以用滑鼠右鍵按一下檔案資料夾，而不是在資料夾的任何內容中，來存取檔案資料夾背景快捷方式功能表。</span><span class="sxs-lookup"><span data-stu-id="92f56-474">The file folder background shortcut menu is accessed by right-clicking within a file folder, but not over any of the folder's contents.</span></span>
-   <span data-ttu-id="92f56-475">「動詞」是在 **HKEY \_ 類別 \_ 根** 子機碼 \\  \\ **Shell** \\ **動詞** 命令下註冊的特殊命令。</span><span class="sxs-lookup"><span data-stu-id="92f56-475">"Verbs" are special commands registered under **HKEY\_CLASSES\_ROOT**\\*Subkey*\\**Shell**\\**Verb** .</span></span>
-   <span data-ttu-id="92f56-476">針對 **網路** \\ **類型** \\ **\#** ，" \# " 是十進位中的網路提供者類型代碼。</span><span class="sxs-lookup"><span data-stu-id="92f56-476">For **Network**\\**Type**\\**\#** , "\#" is a network provider type code in decimal.</span></span> <span data-ttu-id="92f56-477">網路提供者類型代碼是網路類型的最高文字。</span><span class="sxs-lookup"><span data-stu-id="92f56-477">The network provider type code is the high word of a network type.</span></span> <span data-ttu-id="92f56-478">網路類型清單是在 Winnetwk 中提供的， (WNNC \_ NET \_ \* values) 。</span><span class="sxs-lookup"><span data-stu-id="92f56-478">The list of network types is given in the Winnetwk.h header file (WNNC\_NET\_\* values).</span></span> <span data-ttu-id="92f56-479">例如，WNNC \_ NET \_ SHIVA 是0x00330000，因此對應的型別索引鍵會是 **HKEY 類別的 \_ \_ 根** \\ **網路** \\ **類型** \\ **51** 。</span><span class="sxs-lookup"><span data-stu-id="92f56-479">For example, WNNC\_NET\_SHIVA is 0x00330000, so the corresponding type key would be **HKEY\_CLASSES\_ROOT**\\**Network**\\**Type**\\**51** .</span></span>
-   <span data-ttu-id="92f56-480">「*網路 \_ 提供者 \_ 名稱*」是 [**WNetGetProviderName**](/windows/win32/api/winnetwk/nf-winnetwk-wnetgetprovidernamea)所指定的網路提供者名稱，並已將空格轉換成底線。</span><span class="sxs-lookup"><span data-stu-id="92f56-480">"*network\_provider\_name*" is a network provider name as specified by [**WNetGetProviderName**](/windows/win32/api/winnetwk/nf-winnetwk-wnetgetprovidernamea), with the spaces converted into underscores.</span></span> <span data-ttu-id="92f56-481">例如，如果已安裝 Microsoft 網路網路提供者，其提供者名稱為「Microsoft Windows 網路」，而對應的 *網路 \_ 提供者 \_ 名稱* 為 **Microsoft \_ windows \_ network**。</span><span class="sxs-lookup"><span data-stu-id="92f56-481">For example, if the Microsoft Networking network provider is installed, its provider name is "Microsoft Windows Network", and the corresponding *network\_provider\_name* is **Microsoft\_Windows\_Network**.</span></span>

### <a name="example-of-an-extension-handler-registration"></a><span data-ttu-id="92f56-482">擴充處理常式註冊的範例</span><span class="sxs-lookup"><span data-stu-id="92f56-482">Example of an Extension Handler Registration</span></span>

<span data-ttu-id="92f56-483">若要啟用特定處理常式，請使用處理程式的名稱，在擴充處理常式類型索引鍵下建立子機碼。</span><span class="sxs-lookup"><span data-stu-id="92f56-483">To enable a particular handler, create a subkey under the extension handler type key with the name of the handler.</span></span> <span data-ttu-id="92f56-484">Shell 不會使用處理程式的名稱，但它必須與該類型子機碼下的所有其他名稱不同。</span><span class="sxs-lookup"><span data-stu-id="92f56-484">The Shell does not use the handler's name, but it must be different from all other names under that type subkey.</span></span> <span data-ttu-id="92f56-485">將名稱子機碼的預設值設定為處理常式 GUID 的字串形式。</span><span class="sxs-lookup"><span data-stu-id="92f56-485">Set the default value of the name subkey to the string form of the handler's GUID.</span></span>

<span data-ttu-id="92f56-486">下列範例說明使用 myp 檔案類型啟用快捷方式功能表和屬性工作表延伸模組處理常式的登錄專案：</span><span class="sxs-lookup"><span data-stu-id="92f56-486">The following example illustrates registry entries that enable shortcut menu and property sheet extension handlers, using an example .myp file type:</span></span>

```
HKEY_CLASSES_ROOT
   .myp
      (Default) = MyProgram.1
   CLSID
      {00000000-1111-2222-3333-444444444444}
         InProcServer32
            (Default) = C:\MyDir\MyCommand.dll
            ThreadingModel = Apartment
      {11111111-2222-3333-4444-555555555555}
         InProcServer32
            (Default) = C:\MyDir\MyPropSheet.dll
            ThreadingModel = Apartment
   MyProgram.1
      (Default) = MyProgram Application
      Shellex
         ContextMenuHandler
            MyCommand
               (Default) = {00000000-1111-2222-3333-444444444444}
         PropertySheetHandlers
            MyPropSheet
               (Default) = {11111111-2222-3333-4444-555555555555}
```

<span data-ttu-id="92f56-487">本章節中討論的註冊程式必須遵循所有的 Windows 系統。</span><span class="sxs-lookup"><span data-stu-id="92f56-487">The registration procedure discussed in this section must be followed for all Windows systems.</span></span>

## <a name="related-topics"></a><span data-ttu-id="92f56-488">相關主題</span><span class="sxs-lookup"><span data-stu-id="92f56-488">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="92f56-489">執行擴充功能的指引 In-Process</span><span class="sxs-lookup"><span data-stu-id="92f56-489">Guidance for Implementing In-Process Extensions</span></span>](shell-and-managed-code.md)
</dt> </dl>

 

 
