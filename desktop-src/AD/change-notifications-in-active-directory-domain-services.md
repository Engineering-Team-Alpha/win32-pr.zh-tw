---
title: Active Directory Domain Services 中的變更通知
description: Active Directory Domain Services 提供一種機制，讓用戶端應用程式向網域控制站註冊以接收變更通知。
ms.assetid: 27f6c7c1-b32e-457a-9be5-47836d097ab1
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ee564727cfbcb2bfdb367f822fdc137bca7c4e37
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/17/2020
ms.locfileid: "104023286"
---
# <a name="change-notifications-in-active-directory-domain-services"></a>Active Directory Domain Services 中的變更通知

Active Directory Domain Services 提供一種機制，讓用戶端應用程式向網域控制站註冊以接收變更通知。 若要這樣做，用戶端會在非同步 LDAP 搜尋操作中指定 LDAP 變更通知控制項。 用戶端也會指定下列搜尋參數。



| 參數             | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|-----------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 影響範圍<br/>      | 請指定 **ldap \_ 範圍 \_ 基底** 來監視物件，或指定 **ldap \_ 範圍 \_ ONELEVEL** 來監視物件的直屬子系，而不是包含物件本身。 請勿指定 **LDAP \_ 範圍 \_ 子樹**。 雖然基底物件是命名內容的根目錄時，支援子樹範圍，但其使用可能會嚴重影響伺服器效能，因為它會在每次修改命名內容中的物件時，產生 LDAP 搜尋結果訊息。 您無法為任意子樹指定 **LDAP \_ 範圍 \_ 子樹** 。<br/> |
| 篩選<br/>     | 指定 " (objectclass =) " 的搜尋篩選 \* ，這表示您會收到指定範圍中任何物件之變更的通知。<br/>                                                                                                                                                                                                                                                                                                                                                                                                                |
| 屬性<br/> | 指定發生變更時要傳回的屬性清單。 請注意，您會在修改任何屬性時接收通知，而不只是指定的屬性。<br/>                                                                                                                                                                                                                                                                                                                                                                               |



 

您最多可以在單一 LDAP 連接上註冊五個通知要求。 您必須擁有可等候通知的專用線程，並能快速處理它們。 當您呼叫 ldap \_ 搜尋 ext 函式 \_ 來註冊通知要求時，函式會傳回識別該要求的訊息識別碼。 然後，您可以使用 [**ldap \_ 結果**](/previous-versions/windows/desktop/api/winldap/nf-winldap-ldap_result) 函式來等候變更通知。 發生變更時，伺服器會傳送 LDAP 訊息給您，其中包含產生通知之通知要求的訊息識別碼。 這會導致 **ldap \_ 結果** 函式傳回，以識別已變更之物件的搜尋結果。

用戶端應用程式必須決定受監視物件的初始狀態。 若要這樣做，您必須先註冊通知要求，然後再讀取目前的狀態。

用戶端應用程式也必須判斷變更的原因。 如果是基底層級搜尋，當任何屬性變更時，或是當物件被刪除或移動時，就會發生通知。 若為單一層級的搜尋，則會在建立、刪除、移動或修改子物件時，進行通知。 請注意，在目標物件上方的階層中移動或重新命名物件，並不會產生通知，即使目標的辨別名稱變更為結果也一樣。 例如，如果監視容器中子物件的變更，如果容器本身已移動或重新命名，您就不會收到通知。

當用戶端處理搜尋結果時，它可以使用 ldap \_ get dn 函式 \_ 來取得已變更之物件的分辨名稱。 請勿依賴辨別名稱來識別所追蹤的物件，因為分辨名稱可能會變更。 相反地，請將 **objectGUID** 屬性包含在要取出的屬性清單中。 無論在企業樹系中移動物件的位置為何，每個物件的 **objectGUID** 都會保持不變。

如果已刪除搜尋範圍內的物件，用戶端會收到變更通知，而物件的 **isDeleted** 屬性會設定為 **TRUE**。 在此情況下，搜尋結果會在其資料分割的 Deleted Objects 容器中報告物件的新分辨名稱。 不需要將標記控制項指定 ([LDAP \_ 伺服器會 \_ 顯示 \_ 已刪除的 \_ OID](/previous-versions/windows/desktop/ldap/ldap-server-show-deleted-oid)) 來取得物件刪除的通知。 如需詳細資訊，請參閱 [取出已刪除的物件](retrieving-deleted-objects.md)。

當用戶端註冊通知要求時，用戶端會繼續接收通知，直到連線中斷，或用戶端藉由呼叫 ldap 放棄功能來放棄搜尋 \_ 。 例如，如果用戶端或伺服器中斷連線（例如，如果伺服器失敗），就會終止通知要求。 當用戶端重新連線時，它必須再次註冊通知，如果用戶端已中斷連線，就會讀取感興趣物件的目前狀態。

用戶端可以使用物件的 **uSNChanged** 屬性值，判斷伺服器上物件目前的狀態是否會反映用戶端所收到的最新變更。 當移動或修改物件時，系統會增加物件的 **uSNChanged** 屬性。 例如，如果伺服器失敗並從備份還原目錄分割，則伺服器的物件複本可能不會反映先前回報給用戶端的變更，在此情況下，伺服器上的 **uSNChanged** 值將會低於用戶端所儲存的值。

如需在非同步 LDAP 搜尋作業中使用 LDAP 變更通知控制項的詳細資訊和程式碼範例，請參閱 [接收變更通知的範例程式碼](example-code-for-receiving-change-notifications.md)。

如需有關何時使用 LDAP 變更通知控制項的詳細資訊，請參閱 [變更追蹤技術的總覽](overview-of-change-tracking-techniques.md)。

 

