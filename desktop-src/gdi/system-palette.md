---
description: 系統會為每個使用調色板的裝置維護一個系統元件。
ms.assetid: 4c93ce8c-6b3a-4016-bb47-786c25b93374
title: 系統元件
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6d8738cf63eef0b77f2d184f2cf95b6550b81053
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/07/2021
ms.locfileid: "104991511"
---
# <a name="system-palette"></a><span data-ttu-id="6539a-103">系統元件</span><span class="sxs-lookup"><span data-stu-id="6539a-103">System Palette</span></span>

<span data-ttu-id="6539a-104">系統會為每個使用調色板的裝置維護一個 *系統元件* 。</span><span class="sxs-lookup"><span data-stu-id="6539a-104">The system maintains a *system palette* for each device that uses palettes.</span></span> <span data-ttu-id="6539a-105">系統選擇區包含目前可由裝置顯示或繪製的所有色彩的色彩值。</span><span class="sxs-lookup"><span data-stu-id="6539a-105">The system palette contains the color values for all colors that can currently be displayed or drawn by the device.</span></span> <span data-ttu-id="6539a-106">除了查看系統元件的內容之外，應用程式無法直接存取系統調色板。</span><span class="sxs-lookup"><span data-stu-id="6539a-106">Other than viewing the contents of the system palette, applications cannot access the system palette directly.</span></span> <span data-ttu-id="6539a-107">相反地，系統會完全掌控系統元件，並只允許透過使用邏輯調色板來存取。</span><span class="sxs-lookup"><span data-stu-id="6539a-107">Instead, the system has complete control of the system palette and permits access only through the use of logical palettes.</span></span>

<span data-ttu-id="6539a-108">應用程式可以使用 [**GetSystemPaletteEntries**](/windows/desktop/api/Wingdi/nf-wingdi-getsystempaletteentries) 函數來查看系統元件的內容。</span><span class="sxs-lookup"><span data-stu-id="6539a-108">An application can view the contents of the system palette by using the [**GetSystemPaletteEntries**](/windows/desktop/api/Wingdi/nf-wingdi-getsystempaletteentries) function.</span></span> <span data-ttu-id="6539a-109">此函式會抓取一或多個專案的內容，最多可達系統選擇區中的總專案數。</span><span class="sxs-lookup"><span data-stu-id="6539a-109">This function retrieves the contents of one or more entries, up to the total number of entries in the system palette.</span></span> <span data-ttu-id="6539a-110">Total 永遠等於 [**GetDeviceCaps**](/windows/desktop/api/Wingdi/nf-wingdi-getdevicecaps) 函式針對 SIZEPALETTE 值傳回的數位，與任何指定之邏輯調色板的大小上限相同。</span><span class="sxs-lookup"><span data-stu-id="6539a-110">The total is always equal to the number returned for the SIZEPALETTE value by the [**GetDeviceCaps**](/windows/desktop/api/Wingdi/nf-wingdi-getdevicecaps) function and is the same as the maximum size for any given logical palette.</span></span>

<span data-ttu-id="6539a-111">雖然應用程式無法直接變更系統調色板中的色彩，但它們可能會在實現邏輯調色板時造成變更。</span><span class="sxs-lookup"><span data-stu-id="6539a-111">Although applications cannot change colors in the system palette directly, they may cause changes when realizing logical palettes.</span></span> <span data-ttu-id="6539a-112">為了實現調色板，系統會檢查每個要求的色彩，並嘗試在包含完全相符專案的系統元件中尋找專案。</span><span class="sxs-lookup"><span data-stu-id="6539a-112">To realize a palette, the system examines each requested color and attempts to find an entry in the system palette that contains an exact match.</span></span> <span data-ttu-id="6539a-113">如果系統找到相符的色彩，則會將邏輯調色板索引對應至對應的系統元件索引。</span><span class="sxs-lookup"><span data-stu-id="6539a-113">If the system finds a matching color, it maps the logical palette index to the corresponding system palette index.</span></span> <span data-ttu-id="6539a-114">如果系統找不到完全相符的專案，它會在對應索引之前將要求的色彩複製到未使用的系統元件專案。</span><span class="sxs-lookup"><span data-stu-id="6539a-114">If the system does not find an exact match, it copies the requested color to an unused system palette entry before mapping the indexes.</span></span> <span data-ttu-id="6539a-115">如果所有的系統調色板專案都在使用中，系統會將邏輯調色板索引對應到最符合所要求色彩的系統調色板專案。</span><span class="sxs-lookup"><span data-stu-id="6539a-115">If all system palette entries are in use, the system maps the logical palette index to the system palette entry whose color most closely matches the requested color.</span></span> <span data-ttu-id="6539a-116">設定此對應之後，應用程式就無法覆寫它。</span><span class="sxs-lookup"><span data-stu-id="6539a-116">After this mapping is set, applications cannot override it.</span></span> <span data-ttu-id="6539a-117">例如，應用程式無法使用系統調色板索引來指定色彩;只允許邏輯調色板索引。</span><span class="sxs-lookup"><span data-stu-id="6539a-117">For example, applications cannot use system palette indexes to specify colors; only logical palette indexes are permitted.</span></span>

<span data-ttu-id="6539a-118">應用程式可以藉由將 [**PALETTEENTRY**](/previous-versions//dd162769(v=vs.85))結構的 **peFlags** 成員設定為建立邏輯選擇區時選取的值，來修改對應的索引方式。</span><span class="sxs-lookup"><span data-stu-id="6539a-118">Applications can modify the way indexes are mapped by setting the **peFlags** member of the [**PALETTEENTRY**](/previous-versions//dd162769(v=vs.85)) structure to selected values when creating the logical palette.</span></span> <span data-ttu-id="6539a-119">例如，電腦 \_ NOCOLLAPSE 旗標會指示系統立即將要求的色彩複製到未使用的系統調色板專案，不論系統調色板專案是否已包含該色彩。</span><span class="sxs-lookup"><span data-stu-id="6539a-119">For example, the PC\_NOCOLLAPSE flag directs the system to immediately copy the requested color to an unused system palette entry regardless of whether a system palette entry already contains that color.</span></span> <span data-ttu-id="6539a-120">此外，電腦 \_ 明確旗標會指示系統將邏輯調色板索引對應至明確指定的系統調色板索引。</span><span class="sxs-lookup"><span data-stu-id="6539a-120">Also, the PC\_EXPLICIT flag directs the system to map the logical palette index to an explicitly given system palette index.</span></span> <span data-ttu-id="6539a-121"> (應用程式會在 **PALETTEENTRY** 結構的低序位字組中提供系統調色板索引。 ) </span><span class="sxs-lookup"><span data-stu-id="6539a-121">(The application gives the system palette index in the low-order word of the **PALETTEENTRY** structure.)</span></span>

<span data-ttu-id="6539a-122">您可以分別針對 [**SelectPalette**](/windows/desktop/api/Wingdi/nf-wingdi-selectpalette)函式中的 *BForceBackground* 參數指定 **TRUE** 或 **FALSE** ，以將調色板視為背景調色板或前景調色板。</span><span class="sxs-lookup"><span data-stu-id="6539a-122">Palettes can be realized as either a background palette or a foreground palette by specifying **TRUE** or **FALSE** respectively for the *bForceBackground* parameter in the [**SelectPalette**](/windows/desktop/api/Wingdi/nf-wingdi-selectpalette) function.</span></span> <span data-ttu-id="6539a-123">系統中一次只能有一個前景調色板。</span><span class="sxs-lookup"><span data-stu-id="6539a-123">There can be only one foreground palette in the system at a time.</span></span> <span data-ttu-id="6539a-124">如果視窗是目前使用中視窗或目前使用中視窗的子系，則可以實現前景調色板。</span><span class="sxs-lookup"><span data-stu-id="6539a-124">If the window is the currently active window or a descendent of the currently active window, it can realize a foreground palette.</span></span> <span data-ttu-id="6539a-125">否則，不論 *bForceBackground* 參數的值為何，都能將調色板視為背景調色板。</span><span class="sxs-lookup"><span data-stu-id="6539a-125">Otherwise the palette is realized as a background palette regardless of the value of the *bForceBackground* parameter.</span></span> <span data-ttu-id="6539a-126">前景調色板的重要屬性是，在實現時，它可以覆寫所有專案 (除了系統元件中) 的靜態專案以外。</span><span class="sxs-lookup"><span data-stu-id="6539a-126">The critical property of a foreground palette is that, when realized, it can overwrite all entries (except for the static entries) in the system palette.</span></span> <span data-ttu-id="6539a-127">系統會將系統選擇區中非靜態的所有專案標示為在前景調色板的實現之前未使用，藉此完成此工作，藉此排除所有使用的專案。</span><span class="sxs-lookup"><span data-stu-id="6539a-127">The system accomplishes this by marking all of the entries that are not static in the system palette as unused before the realization of a foreground palette, thereby eliminating all of the used entries.</span></span> <span data-ttu-id="6539a-128">系統調色板上不會發生前置處理，以提供背景調色板。</span><span class="sxs-lookup"><span data-stu-id="6539a-128">No preprocessing occurs on the system palette for a background palette realization.</span></span> <span data-ttu-id="6539a-129">前景調色板會設定所有可能的非靜態色彩。</span><span class="sxs-lookup"><span data-stu-id="6539a-129">The foreground palette sets all of the possible nonstatic colors.</span></span> <span data-ttu-id="6539a-130">背景調色板只能設定保持開啟狀態，並以先進先出的方式設定優先順序。</span><span class="sxs-lookup"><span data-stu-id="6539a-130">Background palettes can set only what remains open and are prioritized in a first-come, first-serve manner.</span></span> <span data-ttu-id="6539a-131">一般而言，應用程式會使用適用于子視窗的背景調色板，以實現自己的個別調色板。</span><span class="sxs-lookup"><span data-stu-id="6539a-131">Typically, applications use background palettes for child windows which realize their own individual palettes.</span></span> <span data-ttu-id="6539a-132">這有助於將系統調色板所發生的變更數目降至最低。</span><span class="sxs-lookup"><span data-stu-id="6539a-132">This helps minimize the number of changes that occur to the system palette.</span></span>

<span data-ttu-id="6539a-133">未使用的系統調色板專案是指任何未保留且不含靜態色彩的專案。</span><span class="sxs-lookup"><span data-stu-id="6539a-133">An unused system palette entry is any entry that is not reserved and does not contain a static color.</span></span> <span data-ttu-id="6539a-134">保留的專案會明確標示電腦 \_ 保留值。</span><span class="sxs-lookup"><span data-stu-id="6539a-134">Reserved entries are explicitly marked with the PC\_RESERVED value.</span></span> <span data-ttu-id="6539a-135">當應用程式發現適用于調色板動畫的邏輯元件時，就會建立這些專案。</span><span class="sxs-lookup"><span data-stu-id="6539a-135">These entries are created when an application realizes a logical palette for palette animation.</span></span> <span data-ttu-id="6539a-136">靜態色彩專案是由系統建立，並且對應至預設調色板中的色彩。</span><span class="sxs-lookup"><span data-stu-id="6539a-136">Static color entries are created by the system and correspond to the colors in the default palette.</span></span> <span data-ttu-id="6539a-137">[**GetDeviceCaps**](/windows/desktop/api/Wingdi/nf-wingdi-getdevicecaps)函式可用來取得 NUMRESERVED 值，此值會指定保留給靜態色彩的系統調色板專案數目。</span><span class="sxs-lookup"><span data-stu-id="6539a-137">The [**GetDeviceCaps**](/windows/desktop/api/Wingdi/nf-wingdi-getdevicecaps) function can be used to retrieve the NUMRESERVED value, which specifies the number of system palette entries reserved for static colors.</span></span>

<span data-ttu-id="6539a-138">由於系統選擇區的專案數目有限，因此選取並實現指定裝置的邏輯調色板可能會影響與相同裝置的其他邏輯調色板相關聯的色彩。</span><span class="sxs-lookup"><span data-stu-id="6539a-138">Because the system palette has a limited number of entries, selecting and realizing a logical palette for a given device may affect the colors associated with other logical palettes for the same device.</span></span> <span data-ttu-id="6539a-139">這些色彩變更在顯示器上出現時特別明顯。</span><span class="sxs-lookup"><span data-stu-id="6539a-139">These color changes are especially dramatic when they occur on the display.</span></span> <span data-ttu-id="6539a-140">應用程式可以在每次使用時重設調色板，以確保其目前選取的邏輯調色板使用合理的色彩。</span><span class="sxs-lookup"><span data-stu-id="6539a-140">An application can make sure that reasonable colors are used for its currently selected logical palette by resetting the palette before each use.</span></span> <span data-ttu-id="6539a-141">應用程式會藉由呼叫 [**UnrealizeObject**](/windows/desktop/api/Wingdi/nf-wingdi-unrealizeobject) 和 [**RealizePalette**](/windows/desktop/api/Wingdi/nf-wingdi-realizepalette) 函式重設調色板。</span><span class="sxs-lookup"><span data-stu-id="6539a-141">An application resets the palette by calling the [**UnrealizeObject**](/windows/desktop/api/Wingdi/nf-wingdi-unrealizeobject) and [**RealizePalette**](/windows/desktop/api/Wingdi/nf-wingdi-realizepalette) functions.</span></span> <span data-ttu-id="6539a-142">使用這些函式會導致系統將邏輯調色板中的色彩重新對應到系統調色板中合理的色彩。</span><span class="sxs-lookup"><span data-stu-id="6539a-142">Using these functions causes the system to remap the colors in the logical palette to reasonable colors in the system palette.</span></span>

 

 
