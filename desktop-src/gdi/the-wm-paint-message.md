---
description: 一般而言，應用程式會在視窗中繪製以回應 WM \_ 繪製訊息。
ms.assetid: b2317ce9-e775-450e-91f5-00f735f256a3
title: WM_PAINT 訊息
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a69f7dab736972d8b7226890144efd8763de856a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/08/2021
ms.locfileid: "104991783"
---
# <a name="the-wm_paint-message"></a><span data-ttu-id="51680-103">WM \_ 油漆訊息</span><span class="sxs-lookup"><span data-stu-id="51680-103">The WM\_PAINT Message</span></span>

<span data-ttu-id="51680-104">一般而言，應用程式會在視窗中繪製以回應 [**WM \_ 繪製**](wm-paint.md) 訊息。</span><span class="sxs-lookup"><span data-stu-id="51680-104">Typically, an application draws in a window in response to a [**WM\_PAINT**](wm-paint.md) message.</span></span> <span data-ttu-id="51680-105">當視窗的變更已改變工作區的內容時，系統會將此訊息傳送至視窗程式。</span><span class="sxs-lookup"><span data-stu-id="51680-105">The system sends this message to a window procedure when changes to the window have altered the content of the client area.</span></span> <span data-ttu-id="51680-106">只有當應用程式訊息佇列中沒有其他訊息時，系統才會傳送訊息。</span><span class="sxs-lookup"><span data-stu-id="51680-106">The system sends the message only if there are no other messages in the application message queue.</span></span>

<span data-ttu-id="51680-107">收到 [**WM \_ 油漆**](wm-paint.md) 訊息時，應用程式可以呼叫 [**BeginPaint**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) 來取得工作區的顯示裝置內容，並在 GDI 函式的呼叫中使用它來執行更新工作區所需的任何繪製作業。</span><span class="sxs-lookup"><span data-stu-id="51680-107">Upon receiving a [**WM\_PAINT**](wm-paint.md) message, an application can call [**BeginPaint**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) to retrieve the display device context for the client area and use it in calls to GDI functions to carry out whatever drawing operations are necessary to update the client area.</span></span> <span data-ttu-id="51680-108">完成繪圖作業之後，應用程式會呼叫 [**EndPaint**](/windows/desktop/api/Winuser/nf-winuser-endpaint) 函式來釋放顯示裝置內容。</span><span class="sxs-lookup"><span data-stu-id="51680-108">After completing the drawing operations, the application calls the [**EndPaint**](/windows/desktop/api/Winuser/nf-winuser-endpaint) function to release the display device context.</span></span>

<span data-ttu-id="51680-109">在 [**BeginPaint**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) 傳回顯示裝置內容之前，系統會為指定的視窗準備裝置內容。</span><span class="sxs-lookup"><span data-stu-id="51680-109">Before [**BeginPaint**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) returns the display device context, the system prepares the device context for the specified window.</span></span> <span data-ttu-id="51680-110">它會先將裝置內容的裁剪區域設定為等於需要更新之視窗部分的交集，以及使用者可以看見的部分。</span><span class="sxs-lookup"><span data-stu-id="51680-110">It first sets the clipping region for the device context to be equal to the intersection of the portion of the window that needs updating and the portion that is visible to the user.</span></span> <span data-ttu-id="51680-111">只有已變更之視窗的部分會重繪。</span><span class="sxs-lookup"><span data-stu-id="51680-111">Only those portions of the window that have changed are redrawn.</span></span> <span data-ttu-id="51680-112">在此區域外部繪製的嘗試會遭到裁剪，而且不會出現在畫面上。</span><span class="sxs-lookup"><span data-stu-id="51680-112">Attempts to draw outside this region are clipped and do not appear on the screen.</span></span>

<span data-ttu-id="51680-113">系統也可以在 [**BeginPaint**](/windows/desktop/api/Winuser/nf-winuser-beginpaint)傳回之前，將 [**Wm \_ NCPAINT**](wm-ncpaint.md)和 [**WM \_ ERASEBKGND**](../winmsg/wm-erasebkgnd.md)訊息傳送至視窗程式。</span><span class="sxs-lookup"><span data-stu-id="51680-113">The system can also send [**WM\_NCPAINT**](wm-ncpaint.md) and [**WM\_ERASEBKGND**](../winmsg/wm-erasebkgnd.md) messages to the window procedure before [**BeginPaint**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) returns.</span></span> <span data-ttu-id="51680-114">這些訊息會指示應用程式繪製非工作區和視窗背景。</span><span class="sxs-lookup"><span data-stu-id="51680-114">These messages direct the application to draw the nonclient area and window background.</span></span> <span data-ttu-id="51680-115">*非工作區* 是位於工作區之外之視窗的一部分。</span><span class="sxs-lookup"><span data-stu-id="51680-115">The *nonclient area* is the part of a window that is outside of the client area.</span></span> <span data-ttu-id="51680-116">此區域包含標題列、視窗功能表 (也稱為 **系統** 功能表) 和捲軸等功能。</span><span class="sxs-lookup"><span data-stu-id="51680-116">The area includes features such as the title bar, window menu (also known as the **System** menu), and scroll bars.</span></span> <span data-ttu-id="51680-117">大部分的應用程式都依賴預設視窗函式 [**DefWindowProc**](/windows/desktop/api/winuser/nf-winuser-defwindowproca)，以繪製此區域，因此會將 **WM \_ NCPAINT** 訊息傳遞至此函式。</span><span class="sxs-lookup"><span data-stu-id="51680-117">Most applications rely on the default window function, [**DefWindowProc**](/windows/desktop/api/winuser/nf-winuser-defwindowproca), to draw this area and therefore pass the **WM\_NCPAINT** message to this function.</span></span> <span data-ttu-id="51680-118">*視窗背景* 是在其他繪圖作業開始之前，填滿視窗的色彩或模式。</span><span class="sxs-lookup"><span data-stu-id="51680-118">The *window background* is the color or pattern that a window is filled with before other drawing operations begin.</span></span> <span data-ttu-id="51680-119">背景涵蓋了先前在視窗中或視窗下畫面上的任何影像。</span><span class="sxs-lookup"><span data-stu-id="51680-119">The background covers any images previously in the window or on the screen under the window.</span></span> <span data-ttu-id="51680-120">如果視窗屬於具有類別背景筆刷的視窗類別，則 **DefWindowProc** 函式會自動繪製視窗背景。</span><span class="sxs-lookup"><span data-stu-id="51680-120">If a window belongs to a window class having a class background brush, the **DefWindowProc** function draws the window background automatically.</span></span>

<span data-ttu-id="51680-121">[**BeginPaint**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) 會填滿 [**PAINTSTRUCT**](/windows/win32/api/winuser/ns-winuser-paintstruct) 結構，其中包含要更新之視窗部分的維度，以及指出是否已繪製視窗背景的旗標。</span><span class="sxs-lookup"><span data-stu-id="51680-121">[**BeginPaint**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) fills a [**PAINTSTRUCT**](/windows/win32/api/winuser/ns-winuser-paintstruct) structure with information such as the dimensions of the portion of the window to be updated and a flag indicating whether the window background has been drawn.</span></span> <span data-ttu-id="51680-122">應用程式可以使用此資訊來優化繪圖。</span><span class="sxs-lookup"><span data-stu-id="51680-122">The application can use this information to optimize drawing.</span></span> <span data-ttu-id="51680-123">例如，它可以使用 **rcPaint** 成員所指定之更新區域的維度，將只繪製到需要更新之視窗的部分。</span><span class="sxs-lookup"><span data-stu-id="51680-123">For example, it can use the dimensions of the update region, specified by the **rcPaint** member, to limit drawing to only those portions of the window that need updating.</span></span> <span data-ttu-id="51680-124">如果應用程式有非常簡單的輸出，它可以忽略更新區域，然後在整個視窗中繪製，依賴系統來捨棄 (的剪輯) 任何不需要的輸出。</span><span class="sxs-lookup"><span data-stu-id="51680-124">If an application has very simple output, it can ignore the update region and draw in the entire window, relying on the system to discard (clip) any unneeded output.</span></span> <span data-ttu-id="51680-125">由於系統剪輯繪圖是延伸在裁剪區域外部，因此只會顯示位於更新區域中的繪圖。</span><span class="sxs-lookup"><span data-stu-id="51680-125">Because the system clips drawing that extends outside the clipping region, only drawing that is in the update region is visible.</span></span>

<span data-ttu-id="51680-126">[**BeginPaint**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) 會將視窗的更新區域設定為 **Null**。</span><span class="sxs-lookup"><span data-stu-id="51680-126">[**BeginPaint**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) sets the update region of a window to **NULL**.</span></span> <span data-ttu-id="51680-127">這會清除區域，使其無法產生後續的 [**WM \_ 繪製**](wm-paint.md) 訊息。</span><span class="sxs-lookup"><span data-stu-id="51680-127">This clears the region, preventing it from generating subsequent [**WM\_PAINT**](wm-paint.md) messages.</span></span> <span data-ttu-id="51680-128">如果應用程式處理 **WM \_ 油漆** 訊息，但未呼叫 **BeginPaint** 或清除更新區域，則只要區域不是空的，應用程式就會繼續接收 **WM \_ 油漆** 訊息。</span><span class="sxs-lookup"><span data-stu-id="51680-128">If an application processes a **WM\_PAINT** message but does not call **BeginPaint** or otherwise clear the update region, the application continues to receive **WM\_PAINT** messages as long as the region is not empty.</span></span> <span data-ttu-id="51680-129">在所有情況下，應用程式都必須先清除更新區域，再從 **WM \_ 油漆** 訊息傳回。</span><span class="sxs-lookup"><span data-stu-id="51680-129">In all cases, an application must clear the update region before returning from the **WM\_PAINT** message.</span></span>

<span data-ttu-id="51680-130">在應用程式完成繪製之後，它應該呼叫 [**EndPaint**](/windows/desktop/api/Winuser/nf-winuser-endpaint)。</span><span class="sxs-lookup"><span data-stu-id="51680-130">After the application finishes drawing, it should call [**EndPaint**](/windows/desktop/api/Winuser/nf-winuser-endpaint).</span></span> <span data-ttu-id="51680-131">針對大部分的 windows， **EndPaint** 會釋出顯示裝置內容，使其可供其他視窗使用。</span><span class="sxs-lookup"><span data-stu-id="51680-131">For most windows, **EndPaint** releases the display device context, making it available to other windows.</span></span> <span data-ttu-id="51680-132">**EndPaint** 也會顯示插入號（如果先前已由 [**BeginPaint**](/windows/desktop/api/Winuser/nf-winuser-beginpaint)隱藏）。</span><span class="sxs-lookup"><span data-stu-id="51680-132">**EndPaint** also shows the caret, if it was previously hidden by [**BeginPaint**](/windows/desktop/api/Winuser/nf-winuser-beginpaint).</span></span> <span data-ttu-id="51680-133">**BeginPaint** 會隱藏插入號，以防止繪圖作業損毀。</span><span class="sxs-lookup"><span data-stu-id="51680-133">**BeginPaint** hides the caret to prevent drawing operations from corrupting it.</span></span>

-   [<span data-ttu-id="51680-134">更新區域</span><span class="sxs-lookup"><span data-stu-id="51680-134">The Update Region</span></span>](the-update-region.md)
-   [<span data-ttu-id="51680-135">使更新區域失效並進行驗證</span><span class="sxs-lookup"><span data-stu-id="51680-135">Invalidating and Validating the Update Region</span></span>](invalidating-and-validating-the-update-region.md)
-   [<span data-ttu-id="51680-136">正在抓取更新區域</span><span class="sxs-lookup"><span data-stu-id="51680-136">Retrieving the Update Region</span></span>](retrieving-the-update-region.md)
-   [<span data-ttu-id="51680-137">排除更新區域</span><span class="sxs-lookup"><span data-stu-id="51680-137">Excluding the Update Region</span></span>](excluding-the-update-region.md)
-   [<span data-ttu-id="51680-138">同步和非同步繪圖</span><span class="sxs-lookup"><span data-stu-id="51680-138">Synchronous and Asynchronous Drawing</span></span>](synchronous-and-asynchronous-drawing.md)

 

 
